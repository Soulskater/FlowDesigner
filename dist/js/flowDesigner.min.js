angular.module("FlowDesigner",["Svg.Directive","Touch.Directive","Common.Directive"]).constant("types",{text:"Text",bool:"Bool",number:"Number"}).constant("status",{notrun:"notrun",running:"running",failed:"failed",succeeded:"succeeded"}).constant("direction",{input:"input",output:"output"}).directive("designer",["$timeout","FlowDesigner.PathService",function(e,t){return{restrict:"AE",transclude:!1,replace:!0,templateUrl:t.templatesBaseUrl+"designer.tmpl.html",scope:{autoSize:"=",items:"=",selectedChanged:"&",sizeChanged:"="},controller:"designerCtrl",link:function(e,t){var n=function(){e.size={width:t.width(),height:t.height()}},i=function(){e.offset={x:t.offset().left,y:t.offset().top}};n(),i();new ResizeSensor($(t).parent().parent(),function(){n(),i()})}}}]),angular.module("Common.Directive",[]).directive("ngMousewheel",[function(){return{restrict:"A",require:"?ngModel",replace:!0,scope:!1,link:function(e,t,n){t.mousewheel(function(t){e.$apply(function(){e.$eval(n.ngMousewheel,{event:t})})})}}}]),angular.module("FlowDesigner").controller("connectorCtrl",["$scope","types","direction",function(e,t,n){e.$direction=n,e.newReference=null,e.selectedReference=null,e.hasReference=function(){return e.property.Direction===n.input?null!==e.property.Reference:null!==e.property.References&&0!==e.property.References.length},e.setStyle=function(){return{string:e.property.PropertyValueType===t.string,bool:e.property.PropertyValueType===t.bool,number:e.property.PropertyValueType===t.number,"no-value":!(e.hasReference()||e.property.Value&&""!==e.property.Value)}},e.selectReference=function(t){e.selectedReference=t},e.drag=function(e){r(e.clientX,e.clientY),e.stopPropagation()},e.dragStart=function(e){r(e.clientX,e.clientY),e.stopPropagation()},e.dragEnd=function(t){var n=$(t.target)[0].getAttribute("data-item-id"),r=$(t.target)[0].getAttribute("data-property-name");if(!n||!r)return void(e.newReference=null);var o=e.designer.getItem(n),c=e.designer.getProperty(o,r);return c.Direction===e.property.Direction||n===e.itemData.Id?void(e.newReference=null):(i(e.property,c,o),e.newReference=null,void t.stopPropagation())};var i=function(t,i,r){t.Direction===n.input?(t.Reference={TaskId:r.Id,ReferencedProperty:i.PropertyName},i.References.push({TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName})):(i.Reference={TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName},t.References.push({TaskId:r.Id,ReferencedProperty:i.PropertyName}))},r=function(t,n){e.newReference={x:(t-e.designer.getOffset().x)*(1/e.designer.getScale().x)+e.designer.getViewBox().x-1,y:(n-e.designer.getOffset().y)*(1/e.designer.getScale().y)+e.designer.getViewBox().y-1}};e.$on("$destroy",function(){})}]),angular.module("FlowDesigner").directive("connector",["types","direction","FlowDesigner.PathService",function(e,t,n){return{restrict:"AE",replace:!0,require:"^designer",templateUrl:n.templatesBaseUrl+"connector.tmpl.html",controller:"connectorCtrl",scope:{itemData:"=",property:"=",index:"=",offset:"="},link:function(e,n,i,r){e.designer=r,e.property.calculatePosition=function(){var n=e.property.Direction===t.input?e.itemData.InputProperties:e.itemData.OutputProperties;return{x:e.property.Direction===t.input?e.itemData.Position.X:e.itemData.Position.X+250,y:e.itemData.Position.Y+e.offset+(170-e.offset)/(n.length+1)*(e.index+1)}},e.property.removeReference=function(n,i){var r=e.designer.getItem(n),o=e.designer.getProperty(r,i);if(e.property.Direction===t.input){if(null===e.property.Reference)return;e.property.Reference=null}else{if(0===e.property.References.length)return;linq(e.property.References).remove(function(e){return e.TaskId===n&&e.ReferencedProperty===i})}o.removeReference(e.itemData.Id,e.property.PropertyName)};var o=angular.element(n.children());n.replaceWith(o)}}}]),angular.module("FlowDesigner").controller("designerCtrl",["$scope","direction",function(e){function t(){e.viewBox.width=e.size.width/e.scale.x,e.viewBox.height=e.size.height/e.scale.y}var n=this;e.size={width:0,height:0},e.scale={x:1,y:1},e.viewBox={x:0,y:0,width:0,height:0},e.moving=!1,this.getScale=function(){return e.scale},this.getOffset=function(){return{x:e.offset.x,y:e.offset.y}},this.getViewBox=function(){return e.viewBox},this.getItem=function(t){return linq(e.items).first(function(e){return e.Id===t})},this.getProperty=function(e,t){var n=linq(e.InputProperties).firstOrDefault(function(e){return e.PropertyName===t});return n?n:linq(e.OutputProperties).firstOrDefault(function(e){return e.PropertyName===t})},this.getReferencedProperty=function(e){var t=n.getItem(e.TaskId),i=n.getProperty(t,e.ReferencedProperty);return i},this.selectItem=function(t){linq(e.items).forEach(function(e){e.selected=!1}),t.selected=!0,e.selectedChanged({item:t})},this.removeItem=function(t){linq(t.InputProperties).forEach(function(e){e.Reference&&e.removeReference(e.Reference.TaskId,e.Reference.ReferencedProperty)}),linq(t.OutputProperties).forEach(function(e){linq(e.References).forEach(function(t){e.removeReference(t.TaskId,t.ReferencedProperty)})}),linq(e.items).remove(t)},e.onMouseWheel=function(t){var n=.1;if(-1===t.deltaY){if(e.scale.x-n<=0||e.scale.y-n<=0)return;e.scale.x-=n,e.scale.y-=n}1===t.deltaY&&(e.scale.x+=n,e.scale.y+=n),t.preventDefault()};var i,r=e.$watch("size",t,!0),o=e.$watch("scale",t,!0),c=0;e.moveStart=function(t){i=t.clientX,c=t.clientY,e.moving=!0},e.move=function(t){var n=t.clientX,r=t.clientY;e.viewBox.x-=(n-i)*(1/e.scale.x),e.viewBox.y-=(r-c)*(1/e.scale.y),i=n,c=r},e.moveEnd=function(){e.moving=!1},e.$on("$destroy",function(){r(),o()})}]),angular.module("FlowDesigner").controller("itemCtrl",["$scope","types","status",function(e,t,n){e.$status=n,e.$types=t,e.width=250,e.height=170,e.dragging=!1;var i,r=0;e.dragStart=function(e){i=e.clientX,r=e.clientY,e.stopPropagation()},e.drag=function(t){e.dragging=!0;var n=t.clientX,o=t.clientY;e.data.Position.X+=(n-i)*(1/e.designer.getScale().x),e.data.Position.Y+=(o-r)*(1/e.designer.getScale().y),i=n,r=o,t.stopPropagation()},e.dragEnd=function(){e.dragging=!1},e.onItemClick=function(){e.designer.selectItem(e.data)}}]).directive("designerItem",["types","status","FlowDesigner.PathService",function(e,t,n){return{restrict:"AE",require:"^designer",replace:!0,templateUrl:n.templatesBaseUrl+"item.tmpl.html",transclude:!0,scope:{data:"=",offsetX:"=",offsetY:"="},controller:"itemCtrl",link:function(e,n,i,r){e.data.Status=t.notrun,e.designer=r;var o=angular.element(n.children());n.replaceWith(o)}}}]).directive("itemTitle",[function(){return{restrict:"E",replace:!0,template:'<div class="font-m box-header" ng-transclude></div>',transclude:!0,link:function(){}}}]).directive("itemDescription",[function(){return{restrict:"AE",replace:!0,template:'<div class="font-xs" ng-transclude></div>',transclude:!0,link:function(){}}}]);var scripts=document.getElementsByTagName("script"),currentScriptPath=scripts[scripts.length-1].src,flowDesignerRootPath=currentScriptPath.split("js/")[0];angular.module("FlowDesigner").service("FlowDesigner.PathService",[function(){return{templatesBaseUrl:flowDesignerRootPath+"templates/"}}]),angular.module("Svg.Directive",[]).directive("ngWidth",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngWidth,function(e){t.attr("width",e)})}}}]).directive("ngHeight",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngHeight,function(e){t.attr("height",e)})}}}]).directive("ngX",["$compile",function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.ngX,function(e){t.attr("x",e)})}}}]).directive("ngY",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY,function(e){t.attr("y",e)})}}}]).directive("ngCx",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCx,function(e){t.attr("cx",e)})}}}]).directive("ngCy",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCy,function(e){t.attr("cy",e)})}}}]).directive("ngX1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX1,function(e){t.attr("x1",e)})}}}]).directive("ngX2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX2,function(e){t.attr("x2",e)})}}}]).directive("ngY1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY1,function(e){t.attr("y1",e)})}}}]).directive("ngY2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY2,function(e){t.attr("y2",e)})}}}]).directive("autoSize",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t){$(window).resize(function(){e.$apply(function(){e.size={width:t.width(),height:t.height()}})})}}}]).directive("ngViewbox",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngViewbox,function(e){if(e){var n=e.x+" "+e.y+" "+e.width+" "+e.height;t[0].setAttribute("viewBox",n)}},!0)}}}]).directive("textEllipsis",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){var i=parseFloat(n.maxWidth),r=e.$eval(n.textEllipsis);if(t.text(r),t.width()>i)for(;t.width()>i;)r=r.substring(0,r.length-1),t.text(r.substring(0,r.length-1)+"...")}}}]),angular.module("Touch.Directive",[]).directive("tap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){var i;t.bind("mousedown",function(){i=new Date}),t.bind("mouseup",function(t){var r=new Date;200>=r-i&&e.$apply(function(){e.$eval(n.tap,{$event:t})})}),e.$on("$destroy",function(){t.unbind("mousedown"),t.unbind("mouseup")})}}}).directive("doubleTap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.hammer({taps:2}).bind("tap",function(t){2===t.gesture.tapCount&&e.$apply(function(){e.$eval(n.doubleTap,{$event:t})})}),e.$on("$destroy",function(){t.hammer().unbind("tap")})}}}).directive("pan",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.bind("mousedown",function(t){0===t.button&&e.$apply(function(){e.$eval(n.panBegin,{$event:t});var i=function(t){e.$apply(function(){e.$eval(n.pan,{$event:t})})};$(document).bind("mousemove",i);var r=function(t){e.$apply(function(){e.$eval(n.panRelease,{$event:t}),$(document).unbind("mousemove",i),$(document).unbind("mouseup",r)})};$(document).bind("mouseup",r)})}),e.$on("$destroy",function(){t.unbind("mousedown")})}}}),function(){function e(){t.instance=new t,t.instance.init(t.withTracking)}var t=this.ElementQueries=function(){function e(e){e||(e=document.documentElement);var t=getComputedStyle(e,"fontSize");return parseFloat(t)||16}function n(t,n){var i=n.replace(/[0-9]*/,"");switch(n=parseFloat(n),i){case"px":return n;case"em":return n*e(t);case"rem":return n*e();case"vw":return n*document.documentElement.clientWidth/100;case"vh":return n*document.documentElement.clientHeight/100;case"vmin":case"vmax":var r=document.documentElement.clientWidth/100,o=document.documentElement.clientHeight/100,c=Math["vmin"===i?"min":"max"];return n*c(r,o);default:return n}}function i(e){this.element=e,this.options={};var t,i,r,o,c,s,a,u=0,l=0;this.addOption=function(e){var t=[e.mode,e.property,e.value].join(",");this.options[t]=e};var d=["min-width","min-height","max-width","max-height"];this.call=function(){u=this.element.offsetWidth,l=this.element.offsetHeight,c={};for(t in this.options)this.options.hasOwnProperty(t)&&(i=this.options[t],r=n(this.element,i.value),o="width"==i.property?u:l,a=i.mode+"-"+i.property,s="","min"==i.mode&&o>=r&&(s+=i.value),"max"==i.mode&&r>=o&&(s+=i.value),c[a]||(c[a]=""),s&&-1===(" "+c[a]+" ").indexOf(" "+s+" ")&&(c[a]+=" "+s));for(var e in d)c[d[e]]?this.element.setAttribute(d[e],c[d[e]].substr(1)):this.element.removeAttribute(d[e])}}function r(e,t){e.elementQueriesSetupInformation?e.elementQueriesSetupInformation.addOption(t):(e.elementQueriesSetupInformation=new i(e),e.elementQueriesSetupInformation.addOption(t),e.elementQueriesSensor=new ResizeSensor(e,function(){e.elementQueriesSetupInformation.call()})),e.elementQueriesSetupInformation.call(),this.withTracking&&a.push(e)}function o(e,t,n,i){var o;if(document.querySelectorAll&&(o=document.querySelectorAll.bind(document)),o||"undefined"==typeof $$||(o=$$),o||"undefined"==typeof jQuery||(o=jQuery),!o)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var c=o(e),s=0,a=c.length;a>s;s++)r(c[s],{mode:t,property:n,value:i})}function c(e){var t;for(e=e.replace(/'/g,'"');null!==(t=u.exec(e));)5<t.length&&o(t[1]||t[5],t[2],t[3],t[4])}function s(e){var t="";if(e)if("string"==typeof e)e=e.toLowerCase(),(-1!==e.indexOf("min-width")||-1!==e.indexOf("max-width"))&&c(e);else for(var n=0,i=e.length;i>n;n++)1===e[n].type?(t=e[n].selectorText||e[n].cssText,-1!==t.indexOf("min-height")||-1!==t.indexOf("max-height")?c(t):(-1!==t.indexOf("min-width")||-1!==t.indexOf("max-width"))&&c(t)):4===e[n].type&&s(e[n].cssRules||e[n].rules)}this.withTracking=!1;var a=[],u=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/gim;this.init=function(e){this.withTracking=e;for(var t=0,n=document.styleSheets.length;n>t;t++)s(document.styleSheets[t].cssText||document.styleSheets[t].cssRules||document.styleSheets[t].rules)},this.update=function(e){this.withTracking=e,this.init()},this.detach=function(){if(!this.withTracking)throw"withTracking is not enabled. We can not detach elements since we don not store it.Use ElementQueries.withTracking = true; before domready.";for(var e;e=a.pop();)t.detach(e);a=[]}};t.update=function(e){t.instance.update(e)},t.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor,console.log("detached")):console.log("detached already",e)},t.withTracking=!1,window.addEventListener?window.addEventListener("load",e,!1):window.attachEvent("onload",e)}(),function(){this.ResizeSensor=function(e,t){function n(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;t>e;e++)this.q[e].call()}}function i(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function r(e,t){if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new n,e.resizedAttached.add(t);e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var r="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;",o="position: absolute; left: 0; top: 0;";e.resizeSensor.style.cssText=r,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+r+'"><div style="'+o+'"></div></div><div class="resize-sensor-shrink" style="'+r+'"><div style="'+o+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),{fixed:1,absolute:1}[i(e,"position")]||(e.style.position="relative");var c,s,a=e.resizeSensor.childNodes[0],u=a.childNodes[0],l=e.resizeSensor.childNodes[1],d=(l.childNodes[0],function(){u.style.width=a.offsetWidth+10+"px",u.style.height=a.offsetHeight+10+"px",a.scrollLeft=a.scrollWidth,a.scrollTop=a.scrollHeight,l.scrollLeft=l.scrollWidth,l.scrollTop=l.scrollHeight,c=e.offsetWidth,s=e.offsetHeight});d();var f=function(){e.resizedAttached&&e.resizedAttached.call()},p=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};p(a,"scroll",function(){(e.offsetWidth>c||e.offsetHeight>s)&&f(),d()}),p(l,"scroll",function(){(e.offsetWidth<c||e.offsetHeight<s)&&f(),d()})}if("[object Array]"===Object.prototype.toString.call(e)||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements)for(var o=0,c=e.length;c>o;o++)r(e[o],t);else r(e,t);this.detach=function(){ResizeSensor.detach(e)}},this.ResizeSensor.detach=function(e){e.resizeSensor&&(e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlc2lnbmVyRGlyZWN0aXZlLmpzIiwiY29tbW9uRGlyZWN0aXZlLmpzIiwiY29ubmVjdG9yQ3RybC5qcyIsImNvbm5lY3RvckRpcmVjdGl2ZS5qcyIsImRlc2lnbmVyQ3RybC5qcyIsIml0ZW1EaXJlY3RpdmUuanMiLCJyZXNvdXJjZVBhdGhTZXJ2aWNlLmpzIiwic3ZnRGlyZWN0aXZlLmpzIiwidG91Y2hEaXJlY3RpdmUuanMiLCJsaWJcXGNzcy1lbGVtZW50LXF1ZXJpZXNcXEVsZW1lbnRRdWVyaWVzLmpzIiwibGliXFxjc3MtZWxlbWVudC1xdWVyaWVzXFxSZXNpemVTZW5zb3IuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsUUFBQSxPQUFBLGdCQUFBLGdCQUFBLGtCQUFBLHFCQUNBLFNBQUEsU0FDQSxLQUFBLE9BQ0EsS0FBQSxPQUNBLE9BQUEsV0FFQSxTQUFBLFVBQ0EsT0FBQSxTQUNBLFFBQUEsVUFDQSxPQUFBLFNBQ0EsVUFBQSxjQUVBLFNBQUEsYUFDQSxNQUFBLFFBQ0EsT0FBQSxXQUVBLFVBQUEsWUFBQSxXQUFBLDJCQUFBLFNBQUEsRUFBQSxHQUNBLE9BQ0EsU0FBQSxLQUNBLFlBQUEsRUFDQSxTQUFBLEVBQ0EsWUFBQSxFQUFBLGlCQUFBLHFCQUNBLE9BQ0EsU0FBQSxJQUNBLE1BQUEsSUFDQSxnQkFBQSxJQUNBLFlBQUEsS0FFQSxXQUFBLGVBQ0EsS0FBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsV0FDQSxFQUFBLE1BQ0EsTUFBQSxFQUFBLFFBQ0EsT0FBQSxFQUFBLFdBR0EsRUFBQSxXQUNBLEVBQUEsUUFDQSxFQUFBLEVBQUEsU0FBQSxLQUNBLEVBQUEsRUFBQSxTQUFBLEtBR0EsS0FDQSxHQUNBLElBQUEsY0FBQSxFQUFBLEdBQUEsU0FBQSxTQUFBLFdBQ0EsSUFDQSxXQzlDQSxRQUFBLE9BQUEsdUJBQ0EsVUFBQSxnQkFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFFBQUEsV0FDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFdBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLGNBQUEsTUFBQSxhQ1ZBLFFBQUEsT0FBQSxnQkFDQSxXQUFBLGlCQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxXQUFBLEVBQ0EsRUFBQSxhQUFBLEtBQ0EsRUFBQSxrQkFBQSxLQUNBLEVBQUEsYUFBQSxXQUNBLE1BQUEsR0FBQSxTQUFBLFlBQUEsRUFBQSxNQUNBLE9BQUEsRUFBQSxTQUFBLFVBRUEsT0FBQSxFQUFBLFNBQUEsWUFBQSxJQUFBLEVBQUEsU0FBQSxXQUFBLFFBR0EsRUFBQSxTQUFBLFdBQ0EsT0FDQSxPQUFBLEVBQUEsU0FBQSxvQkFBQSxFQUFBLE9BQ0EsS0FBQSxFQUFBLFNBQUEsb0JBQUEsRUFBQSxLQUNBLE9BQUEsRUFBQSxTQUFBLG9CQUFBLEVBQUEsT0FDQSxhQUFBLEVBQUEsZ0JBQUEsRUFBQSxTQUFBLE9BQUEsS0FBQSxFQUFBLFNBQUEsU0FJQSxFQUFBLGdCQUFBLFNBQUEsR0FDQSxFQUFBLGtCQUFBLEdBS0EsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEVBQUEsUUFBQSxFQUFBLFNBQ0EsRUFBQSxtQkFFQSxFQUFBLFVBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxRQUFBLEVBQUEsU0FDQSxFQUFBLG1CQUVBLEVBQUEsUUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsYUFBQSxnQkFDQSxFQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsYUFBQSxxQkFDQSxLQUFBLElBQUEsRUFFQSxZQURBLEVBQUEsYUFBQSxLQUdBLElBQUEsR0FBQSxFQUFBLFNBQUEsUUFBQSxHQUNBLEVBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxFQUNBLE9BQUEsR0FBQSxZQUFBLEVBQUEsU0FBQSxXQUFBLElBQUEsRUFBQSxTQUFBLFFBQ0EsRUFBQSxhQUFBLE9BR0EsRUFBQSxFQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsYUFBQSxTQUNBLEdBQUEsbUJBT0EsSUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxZQUFBLEVBQUEsT0FDQSxFQUFBLFdBQ0EsT0FBQSxFQUFBLEdBQ0EsbUJBQUEsRUFBQSxjQUVBLEVBQUEsV0FBQSxNQUNBLE9BQUEsRUFBQSxTQUFBLEdBQ0EsbUJBQUEsRUFBQSxTQUFBLGlCQUlBLEVBQUEsV0FDQSxPQUFBLEVBQUEsU0FBQSxHQUNBLG1CQUFBLEVBQUEsU0FBQSxjQUVBLEVBQUEsV0FBQSxNQUNBLE9BQUEsRUFBQSxHQUNBLG1CQUFBLEVBQUEsaUJBSUEsRUFBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLGNBQ0EsR0FBQSxFQUFBLEVBQUEsU0FBQSxZQUFBLElBQUEsRUFBQSxFQUFBLFNBQUEsV0FBQSxHQUFBLEVBQUEsU0FBQSxhQUFBLEVBQUEsRUFDQSxHQUFBLEVBQUEsRUFBQSxTQUFBLFlBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQUEsRUFBQSxTQUFBLGFBQUEsRUFBQSxHQVFBLEdBQUEsSUFBQSxXQUFBLGlCQzFGQSxRQUFBLE9BQUEsZ0JBQ0EsVUFBQSxhQUFBLFFBQUEsWUFBQSwyQkFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLE9BQ0EsU0FBQSxLQUNBLFNBQUEsRUFDQSxRQUFBLFlBQ0EsWUFBQSxFQUFBLGlCQUFBLHNCQUNBLFdBQUEsZ0JBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxJQUNBLE1BQUEsSUFDQSxPQUFBLEtBRUEsS0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxTQUFBLEVBSUEsRUFBQSxTQUFBLGtCQUFBLFdBQ0EsR0FBQSxHQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsTUFBQSxFQUFBLFNBQUEsZ0JBQUEsRUFBQSxTQUFBLGdCQUNBLFFBQ0EsRUFBQSxFQUFBLFNBQUEsWUFBQSxFQUFBLE1BQUEsRUFBQSxTQUFBLFNBQUEsRUFBQSxFQUFBLFNBQUEsU0FBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLFNBQUEsU0FBQSxFQUFBLEVBQUEsUUFBQSxJQUFBLEVBQUEsU0FBQSxFQUFBLE9BQUEsSUFBQSxFQUFBLE1BQUEsS0FHQSxFQUFBLFNBQUEsZ0JBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsU0FBQSxRQUFBLEdBQ0EsRUFBQSxFQUFBLFNBQUEsWUFBQSxFQUFBLEVBQ0EsSUFBQSxFQUFBLFNBQUEsWUFBQSxFQUFBLE1BQUEsQ0FDQSxHQUFBLE9BQUEsRUFBQSxTQUFBLFVBQ0EsTUFFQSxHQUFBLFNBQUEsVUFBQSxTQUVBLENBQ0EsR0FBQSxJQUFBLEVBQUEsU0FBQSxXQUFBLE9BQ0EsTUFFQSxNQUFBLEVBQUEsU0FBQSxZQUFBLE9BQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxTQUFBLEdBQUEsRUFBQSxxQkFBQSxJQUdBLEVBQUEsZ0JBQUEsRUFBQSxTQUFBLEdBQUEsRUFBQSxTQUFBLGNBT0EsSUFBQSxHQUFBLFFBQUEsUUFBQSxFQUFBLFdBQ0EsR0FBQSxZQUFBLFFDbkRBLFFBQUEsT0FBQSxnQkFDQSxXQUFBLGdCQUFBLFNBQUEsWUFBQSxTQUFBLEdBNkdBLFFBQUEsS0FDQSxFQUFBLFFBQUEsTUFBQSxFQUFBLEtBQUEsTUFBQSxFQUFBLE1BQUEsRUFDQSxFQUFBLFFBQUEsT0FBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLE1BQUEsRUE5R0EsR0FBQSxHQUFBLElBRUEsR0FBQSxNQUNBLE1BQUEsRUFDQSxPQUFBLEdBRUEsRUFBQSxPQUNBLEVBQUEsRUFDQSxFQUFBLEdBRUEsRUFBQSxTQUNBLEVBQUEsRUFDQSxFQUFBLEVBQ0EsTUFBQSxFQUNBLE9BQUEsR0FFQSxFQUFBLFFBQUEsRUFJQSxLQUFBLFNBQUEsV0FDQSxNQUFBLEdBQUEsT0FHQSxLQUFBLFVBQUEsV0FDQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFHQSxLQUFBLFdBQUEsV0FDQSxNQUFBLEdBQUEsU0FHQSxLQUFBLFFBQUEsU0FBQSxHQUNBLE1BQUEsTUFBQSxFQUFBLE9BQUEsTUFBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLEtBQUEsS0FJQSxLQUFBLFlBQUEsU0FBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLEtBQUEsRUFBQSxpQkFBQSxlQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsZUFBQSxHQUVBLE9BQUEsR0FDQSxFQUdBLEtBQUEsRUFBQSxrQkFBQSxlQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsZUFBQSxLQUlBLEtBQUEsc0JBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLFFBQUEsRUFBQSxRQUNBLEVBQUEsRUFBQSxZQUFBLEVBQUEsRUFBQSxtQkFFQSxPQUFBLElBT0EsS0FBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLEVBQUEsT0FBQSxRQUFBLFNBQUEsR0FDQSxFQUFBLFVBQUEsSUFFQSxFQUFBLFVBQUEsRUFDQSxFQUFBLGlCQUFBLEtBQUEsS0FJQSxLQUFBLFdBQUEsU0FBQSxHQUNBLEtBQUEsRUFBQSxpQkFBQSxRQUFBLFNBQUEsR0FDQSxFQUFBLFdBQ0EsRUFBQSxnQkFBQSxFQUFBLFVBQUEsT0FBQSxFQUFBLFVBQUEsc0JBSUEsS0FBQSxFQUFBLGtCQUFBLFFBQUEsU0FBQSxHQUNBLEtBQUEsRUFBQSxZQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsZ0JBQUEsRUFBQSxPQUFBLEVBQUEsd0JBSUEsS0FBQSxFQUFBLE9BQUEsT0FBQSxJQU9BLEVBQUEsYUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBRUEsSUFBQSxLQUFBLEVBQUEsT0FBQSxDQUNBLEdBQUEsRUFBQSxNQUFBLEVBQUEsR0FBQSxHQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFDQSxNQUVBLEdBQUEsTUFBQSxHQUFBLEVBQ0EsRUFBQSxNQUFBLEdBQUEsRUFFQSxJQUFBLEVBQUEsU0FDQSxFQUFBLE1BQUEsR0FBQSxFQUNBLEVBQUEsTUFBQSxHQUFBLEdBRUEsRUFBQSxpQkFRQSxJQU9BLEdBUEEsRUFBQSxFQUFBLE9BQUEsT0FBQSxHQUFBLEdBQ0EsRUFBQSxFQUFBLE9BQUEsUUFBQSxHQUFBLEdBTUEsRUFBQSxDQUNBLEdBQUEsVUFBQSxTQUFBLEdBQ0EsRUFBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLFFBQ0EsRUFBQSxRQUFBLEdBR0EsRUFBQSxLQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxRQUNBLEVBQUEsRUFBQSxPQUNBLEdBQUEsUUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsTUFBQSxHQUNBLEVBQUEsUUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsTUFBQSxHQUNBLEVBQUEsRUFDQSxFQUFBLEdBR0EsRUFBQSxRQUFBLFdBQ0EsRUFBQSxRQUFBLEdBT0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxJQUNBLFNDcEpBLFFBQUEsT0FBQSxnQkFDQSxXQUFBLFlBQUEsU0FBQSxRQUFBLFNBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxFQUFBLE9BQUEsRUFDQSxFQUFBLE1BQUEsSUFDQSxFQUFBLE9BQUEsSUFDQSxFQUFBLFVBQUEsQ0FDQSxJQUFBLEdBQUEsRUFBQSxDQUNBLEdBQUEsVUFBQSxTQUFBLEdBQ0EsRUFBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLFFBQ0EsRUFBQSxtQkFFQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsVUFBQSxDQUNBLElBQUEsR0FBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLE9BQ0EsR0FBQSxLQUFBLFNBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLFNBQUEsV0FBQSxHQUNBLEVBQUEsS0FBQSxTQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxTQUFBLFdBQUEsR0FDQSxFQUFBLEVBQ0EsRUFBQSxFQUNBLEVBQUEsbUJBRUEsRUFBQSxRQUFBLFdBQ0EsRUFBQSxVQUFBLEdBR0EsRUFBQSxZQUFBLFdBQ0EsRUFBQSxTQUFBLFdBQUEsRUFBQSxVQUdBLFVBQUEsZ0JBQUEsUUFBQSxTQUFBLDJCQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsT0FDQSxTQUFBLEtBQ0EsUUFBQSxZQUNBLFNBQUEsRUFDQSxZQUFBLEVBQUEsaUJBQUEsaUJBQ0EsWUFBQSxFQUNBLE9BQ0EsS0FBQSxJQUNBLFFBQUEsSUFDQSxRQUFBLEtBRUEsV0FBQSxXQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsS0FBQSxPQUFBLEVBQUEsT0FDQSxFQUFBLFNBQUEsQ0FHQSxJQUFBLEdBQUEsUUFBQSxRQUFBLEVBQUEsV0FDQSxHQUFBLFlBQUEsUUFJQSxVQUFBLGFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsU0FBQSxzREFDQSxZQUFBLEVBQ0EsS0FBQSxpQkFJQSxVQUFBLG1CQUFBLFdBQ0EsT0FDQSxTQUFBLEtBQ0EsU0FBQSxFQUNBLFNBQUEsNENBQ0EsWUFBQSxFQUNBLEtBQUEsZ0JDdEVBLElBQUEsU0FBQSxTQUFBLHFCQUFBLFVBQ0Esa0JBQUEsUUFBQSxRQUFBLE9BQUEsR0FBQSxJQUNBLHFCQUFBLGtCQUFBLE1BQUEsT0FBQSxFQUVBLFNBQUEsT0FBQSxnQkFDQSxRQUFBLDRCQUFBLFdBQ0EsT0FDQSxpQkFBQSxxQkFBQSxpQkNQQSxRQUFBLE9BQUEsb0JBQ0EsVUFBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLFFBQUEsVUFLQSxVQUFBLFlBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxTQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsU0FBQSxVQUtBLFVBQUEsT0FBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLElBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxJQUFBLFVBS0EsVUFBQSxPQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsSUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLElBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFlBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxRQUFBLE9BQUEsV0FDQSxFQUFBLE9BQUEsV0FDQSxFQUFBLE1BQ0EsTUFBQSxFQUFBLFFBQ0EsT0FBQSxFQUFBLG1CQU9BLFVBQUEsYUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLFVBQUEsU0FBQSxHQUNBLEdBQUEsRUFBQSxDQUdBLEdBQUEsR0FBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLE1BQUEsSUFBQSxFQUFBLE1BQ0EsR0FBQSxHQUFBLGFBQUEsVUFBQSxNQUNBLFFBSUEsVUFBQSxnQkFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxXQUFBLEVBQUEsVUFDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLGFBRUEsSUFEQSxFQUFBLEtBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxLQUFBLEVBQUEsUUFBQSxHQUNBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxPQUFBLEdBQ0EsRUFBQSxLQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUEsT0FBQSxHQUFBLFlDcEtBLFFBQUEsT0FBQSxzQkFDQSxVQUFBLE1BQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsRUFDQSxHQUFBLEtBQUEsWUFBQSxXQUNBLEVBQUEsR0FBQSxRQUdBLEVBQUEsS0FBQSxVQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsR0FBQSxLQUNBLE1BQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLEtBQUEsT0FBQSxRQU9BLEVBQUEsSUFBQSxXQUFBLFdBQ0EsRUFBQSxPQUFBLGFBQ0EsRUFBQSxPQUFBLGlCQUlBLFVBQUEsWUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxRQUNBLEtBQUEsSUFDQSxLQUFBLE1BQUEsU0FBQSxHQUNBLElBQUEsRUFBQSxRQUFBLFVBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsV0FBQSxPQUFBLFFBT0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLFNBQUEsT0FBQSxhQUlBLFVBQUEsTUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLFlBQUEsU0FBQSxHQUNBLElBQUEsRUFBQSxRQUdBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLFVBQUEsT0FBQSxHQUNBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsS0FBQSxPQUFBLE1BR0EsR0FBQSxVQUFBLEtBQUEsWUFBQSxFQUNBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsWUFBQSxPQUFBLElBQ0EsRUFBQSxVQUFBLE9BQUEsWUFBQSxHQUNBLEVBQUEsVUFBQSxPQUFBLFVBQUEsS0FHQSxHQUFBLFVBQUEsS0FBQSxVQUFBLE9BS0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLE9BQUEsbUJDN0VBLFdBNFJBLFFBQUEsS0FDQSxFQUFBLFNBQUEsR0FBQSxHQUNBLEVBQUEsU0FBQSxLQUFBLEVBQUEsY0F4UkEsR0FBQSxHQUFBLEtBQUEsZUFBQSxXQVVBLFFBQUEsR0FBQSxHQUNBLElBQ0EsRUFBQSxTQUFBLGdCQUVBLElBQUEsR0FBQSxpQkFBQSxFQUFBLFdBQ0EsT0FBQSxZQUFBLElBQUEsR0FXQSxRQUFBLEdBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLFFBQUEsU0FBQSxHQUVBLFFBREEsRUFBQSxXQUFBLEdBQ0EsR0FDQSxJQUFBLEtBQ0EsTUFBQSxFQUNBLEtBQUEsS0FDQSxNQUFBLEdBQUEsRUFBQSxFQUNBLEtBQUEsTUFDQSxNQUFBLEdBQUEsR0FJQSxLQUFBLEtBQ0EsTUFBQSxHQUFBLFNBQUEsZ0JBQUEsWUFBQSxHQUNBLEtBQUEsS0FDQSxNQUFBLEdBQUEsU0FBQSxnQkFBQSxhQUFBLEdBQ0EsS0FBQSxPQUNBLElBQUEsT0FDQSxHQUFBLEdBQUEsU0FBQSxnQkFBQSxZQUFBLElBQ0EsRUFBQSxTQUFBLGdCQUFBLGFBQUEsSUFDQSxFQUFBLEtBQUEsU0FBQSxFQUFBLE1BQUEsTUFDQSxPQUFBLEdBQUEsRUFBQSxFQUFBLEVBQ0EsU0FDQSxNQUFBLElBV0EsUUFBQSxHQUFBLEdBQ0EsS0FBQSxRQUFBLEVBQ0EsS0FBQSxVQUNBLElBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUtBLE1BQUEsVUFBQSxTQUFBLEdBQ0EsR0FBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLFNBQUEsRUFBQSxPQUFBLEtBQUEsSUFDQSxNQUFBLFFBQUEsR0FBQSxFQUdBLElBQUEsSUFBQSxZQUFBLGFBQUEsWUFBQSxhQUtBLE1BQUEsS0FBQSxXQUVBLEVBQUEsS0FBQSxRQUFBLFlBQ0EsRUFBQSxLQUFBLFFBQUEsYUFFQSxJQUVBLEtBQUEsSUFBQSxNQUFBLFFBQ0EsS0FBQSxRQUFBLGVBQUEsS0FHQSxFQUFBLEtBQUEsUUFBQSxHQUVBLEVBQUEsRUFBQSxLQUFBLFFBQUEsRUFBQSxPQUVBLEVBQUEsU0FBQSxFQUFBLFNBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxLQUFBLElBQUEsRUFBQSxTQUNBLEVBQUEsR0FFQSxPQUFBLEVBQUEsTUFBQSxHQUFBLElBQ0EsR0FBQSxFQUFBLE9BR0EsT0FBQSxFQUFBLE1BQUEsR0FBQSxJQUNBLEdBQUEsRUFBQSxPQUdBLEVBQUEsS0FBQSxFQUFBLEdBQUEsSUFDQSxHQUFBLE1BQUEsSUFBQSxFQUFBLEdBQUEsS0FBQSxRQUFBLElBQUEsRUFBQSxPQUNBLEVBQUEsSUFBQSxJQUFBLEdBSUEsS0FBQSxHQUFBLEtBQUEsR0FDQSxFQUFBLEVBQUEsSUFDQSxLQUFBLFFBQUEsYUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLElBQUEsT0FBQSxJQUVBLEtBQUEsUUFBQSxnQkFBQSxFQUFBLEtBVUEsUUFBQSxHQUFBLEVBQUEsR0FDQSxFQUFBLCtCQUNBLEVBQUEsK0JBQUEsVUFBQSxJQUVBLEVBQUEsK0JBQUEsR0FBQSxHQUFBLEdBQ0EsRUFBQSwrQkFBQSxVQUFBLEdBQ0EsRUFBQSxxQkFBQSxHQUFBLGNBQUEsRUFBQSxXQUNBLEVBQUEsK0JBQUEsVUFHQSxFQUFBLCtCQUFBLE9BRUEsS0FBQSxjQUNBLEVBQUEsS0FBQSxHQVVBLFFBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsRUFLQSxJQUpBLFNBQUEsbUJBQUEsRUFBQSxTQUFBLGlCQUFBLEtBQUEsV0FDQSxHQUFBLG1CQUFBLE1BQUEsRUFBQSxJQUNBLEdBQUEsbUJBQUEsVUFBQSxFQUFBLFNBRUEsRUFDQSxLQUFBLDhEQUlBLEtBQUEsR0FEQSxHQUFBLEVBQUEsR0FDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLElBQ0EsS0FBQSxFQUNBLFNBQUEsRUFDQSxNQUFBLElBVUEsUUFBQSxHQUFBLEdBQ0EsR0FBQSxFQUVBLEtBREEsRUFBQSxFQUFBLFFBQUEsS0FBQSxLQUNBLFFBQUEsRUFBQSxFQUFBLEtBQUEsS0FDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLElBUUEsUUFBQSxHQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQ0EsSUFBQSxFQUdBLEdBQUEsZ0JBQUEsR0FDQSxFQUFBLEVBQUEsZUFDQSxLQUFBLEVBQUEsUUFBQSxjQUFBLEtBQUEsRUFBQSxRQUFBLGVBQ0EsRUFBQSxPQUdBLEtBQUEsR0FBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLElBQ0EsSUFBQSxFQUFBLEdBQUEsTUFDQSxFQUFBLEVBQUEsR0FBQSxjQUFBLEVBQUEsR0FBQSxRQUNBLEtBQUEsRUFBQSxRQUFBLGVBQUEsS0FBQSxFQUFBLFFBQUEsY0FDQSxFQUFBLElBQ0EsS0FBQSxFQUFBLFFBQUEsY0FBQSxLQUFBLEVBQUEsUUFBQSxlQUNBLEVBQUEsSUFFQSxJQUFBLEVBQUEsR0FBQSxNQUNBLEVBQUEsRUFBQSxHQUFBLFVBQUEsRUFBQSxHQUFBLE9BN01BLEtBQUEsY0FBQSxDQUNBLElBQUEsTUFzS0EsRUFBQSxvR0FrREEsTUFBQSxLQUFBLFNBQUEsR0FDQSxLQUFBLGFBQUEsQ0FDQSxLQUFBLEdBQUEsR0FBQSxFQUFBLEVBQUEsU0FBQSxZQUFBLE9BQUEsRUFBQSxFQUFBLElBQ0EsRUFBQSxTQUFBLFlBQUEsR0FBQSxTQUFBLFNBQUEsWUFBQSxHQUFBLFVBQUEsU0FBQSxZQUFBLEdBQUEsUUFTQSxLQUFBLE9BQUEsU0FBQSxHQUNBLEtBQUEsYUFBQSxFQUNBLEtBQUEsUUFHQSxLQUFBLE9BQUEsV0FDQSxJQUFBLEtBQUEsYUFDQSxLQUFBLDRJQUtBLEtBREEsR0FBQSxHQUNBLEVBQUEsRUFBQSxPQUNBLEVBQUEsT0FBQSxFQUdBLE9BU0EsR0FBQSxPQUFBLFNBQUEsR0FDQSxFQUFBLFNBQUEsT0FBQSxJQVFBLEVBQUEsT0FBQSxTQUFBLEdBQ0EsRUFBQSxnQ0FDQSxFQUFBLHFCQUFBLGVBQ0EsR0FBQSxxQ0FDQSxHQUFBLHFCQUNBLFFBQUEsSUFBQSxhQUVBLFFBQUEsSUFBQSxtQkFBQSxJQUlBLEVBQUEsY0FBQSxFQU9BLE9BQUEsaUJBQ0EsT0FBQSxpQkFBQSxPQUFBLEdBQUEsR0FFQSxPQUFBLFlBQUEsU0FBQSxNQ3BTQSxXQVVBLEtBQUEsYUFBQSxTQUFBLEVBQUEsR0FLQSxRQUFBLEtBQ0EsS0FBQSxLQUNBLEtBQUEsSUFBQSxTQUFBLEdBQ0EsS0FBQSxFQUFBLEtBQUEsR0FHQSxJQUFBLEdBQUEsQ0FDQSxNQUFBLEtBQUEsV0FDQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxJQUNBLEtBQUEsRUFBQSxHQUFBLFFBVUEsUUFBQSxHQUFBLEVBQUEsR0FDQSxNQUFBLEdBQUEsYUFDQSxFQUFBLGFBQUEsR0FDQSxPQUFBLGlCQUNBLE9BQUEsaUJBQUEsRUFBQSxNQUFBLGlCQUFBLEdBRUEsRUFBQSxNQUFBLEdBU0EsUUFBQSxHQUFBLEVBQUEsR0FDQSxHQUFBLEVBQUEsaUJBR0EsR0FBQSxFQUFBLGdCQUVBLFdBREEsR0FBQSxnQkFBQSxJQUFBLE9BSEEsR0FBQSxnQkFBQSxHQUFBLEdBQ0EsRUFBQSxnQkFBQSxJQUFBLEVBTUEsR0FBQSxhQUFBLFNBQUEsY0FBQSxPQUNBLEVBQUEsYUFBQSxVQUFBLGVBQ0EsSUFBQSxHQUFBLCtHQUNBLEVBQUEsc0NBRUEsR0FBQSxhQUFBLE1BQUEsUUFBQSxFQUNBLEVBQUEsYUFBQSxVQUNBLDRDQUFBLEVBQUEsaUJBQ0EsRUFBQSwwREFFQSxFQUFBLGlCQUNBLEVBQUEsMkNBRUEsRUFBQSxZQUFBLEVBQUEsZUFFQSxNQUFBLEVBQUEsU0FBQSxHQUFBLEVBQUEsRUFBQSxlQUNBLEVBQUEsTUFBQSxTQUFBLFdBR0EsSUFLQSxHQUFBLEVBTEEsRUFBQSxFQUFBLGFBQUEsV0FBQSxHQUNBLEVBQUEsRUFBQSxXQUFBLEdBQ0EsRUFBQSxFQUFBLGFBQUEsV0FBQSxHQUtBLEdBSkEsRUFBQSxXQUFBLEdBSUEsV0FDQSxFQUFBLE1BQUEsTUFBQSxFQUFBLFlBQUEsR0FBQSxLQUNBLEVBQUEsTUFBQSxPQUFBLEVBQUEsYUFBQSxHQUFBLEtBQ0EsRUFBQSxXQUFBLEVBQUEsWUFDQSxFQUFBLFVBQUEsRUFBQSxhQUNBLEVBQUEsV0FBQSxFQUFBLFlBQ0EsRUFBQSxVQUFBLEVBQUEsYUFDQSxFQUFBLEVBQUEsWUFDQSxFQUFBLEVBQUEsY0FHQSxJQUVBLElBQUEsR0FBQSxXQUNBLEVBQUEsaUJBQ0EsRUFBQSxnQkFBQSxRQUlBLEVBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFlBQ0EsRUFBQSxZQUFBLEtBQUEsRUFBQSxHQUVBLEVBQUEsaUJBQUEsRUFBQSxHQUlBLEdBQUEsRUFBQSxTQUFBLFlBQ0EsRUFBQSxZQUFBLEdBQUEsRUFBQSxhQUFBLElBQ0EsSUFFQSxNQUdBLEVBQUEsRUFBQSxTQUFBLFlBQ0EsRUFBQSxZQUFBLEdBQUEsRUFBQSxhQUFBLElBQ0EsSUFFQSxNQUlBLEdBQUEsbUJBQUEsT0FBQSxVQUFBLFNBQUEsS0FBQSxJQUNBLG1CQUFBLFNBQUEsWUFBQSxTQUNBLG1CQUFBLFdBQUEsWUFBQSxVQUdBLElBREEsR0FBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLE9BQ0EsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEdBQUEsT0FHQSxHQUFBLEVBQUEsRUFHQSxNQUFBLE9BQUEsV0FDQSxhQUFBLE9BQUEsS0FJQSxLQUFBLGFBQUEsT0FBQSxTQUFBLEdBQ0EsRUFBQSxlQUNBLEVBQUEsWUFBQSxFQUFBLG9CQUNBLEdBQUEsbUJBQ0EsR0FBQSIsImZpbGUiOiJmbG93RGVzaWduZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDgvNS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0Zsb3dEZXNpZ25lcicsIFsnU3ZnLkRpcmVjdGl2ZScsICdUb3VjaC5EaXJlY3RpdmUnLCAnQ29tbW9uLkRpcmVjdGl2ZSddKVxyXG4gICAgLmNvbnN0YW50KFwidHlwZXNcIiwge1xyXG4gICAgICAgIHRleHQ6ICdUZXh0JyxcclxuICAgICAgICBib29sOiAnQm9vbCcsXHJcbiAgICAgICAgbnVtYmVyOiAnTnVtYmVyJ1xyXG4gICAgfSlcclxuICAgIC5jb25zdGFudChcInN0YXR1c1wiLCB7XHJcbiAgICAgICAgbm90cnVuOiAnbm90cnVuJyxcclxuICAgICAgICBydW5uaW5nOiAncnVubmluZycsXHJcbiAgICAgICAgZmFpbGVkOiAnZmFpbGVkJyxcclxuICAgICAgICBzdWNjZWVkZWQ6ICdzdWNjZWVkZWQnXHJcbiAgICB9KVxyXG4gICAgLmNvbnN0YW50KFwiZGlyZWN0aW9uXCIsIHtcclxuICAgICAgICBpbnB1dDogJ2lucHV0JyxcclxuICAgICAgICBvdXRwdXQ6ICdvdXRwdXQnXHJcbiAgICB9KVxyXG4gICAgLmRpcmVjdGl2ZSgnZGVzaWduZXInLCBbXCIkdGltZW91dFwiLCBcIkZsb3dEZXNpZ25lci5QYXRoU2VydmljZVwiLCBmdW5jdGlvbiAoJHRpbWVvdXQsICRwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkcGF0aC50ZW1wbGF0ZXNCYXNlVXJsICsgJ2Rlc2lnbmVyLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBhdXRvU2l6ZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6ICc9JyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ2hhbmdlZDogJyYnLFxyXG4gICAgICAgICAgICAgICAgc2l6ZUNoYW5nZWQ6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZGVzaWduZXJDdHJsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZXRTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zaXplID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZWxlbWVudC53aWR0aCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0KClcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHZhciBzZXRPZmZzZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9mZnNldCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogZWxlbWVudC5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBlbGVtZW50Lm9mZnNldCgpLnRvcFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2V0U2l6ZSgpO1xyXG4gICAgICAgICAgICAgICAgc2V0T2Zmc2V0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzaXplciA9IG5ldyBSZXNpemVTZW5zb3IoJChlbGVtZW50KS5wYXJlbnQoKS5wYXJlbnQoKSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFNpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRPZmZzZXQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNQ0cgb24gMjAxNC4wOS4wOS4uXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnQ29tbW9uLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdNb3VzZXdoZWVsJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICc/bmdNb2RlbCcsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQubW91c2V3aGVlbChmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLm5nTW91c2V3aGVlbCwge2V2ZW50OiBldmVudH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA5LzkvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInKVxyXG4gICAgLmNvbnRyb2xsZXIoXCJjb25uZWN0b3JDdHJsXCIsIFsnJHNjb3BlJywgJ3R5cGVzJywgJ2RpcmVjdGlvbicsIGZ1bmN0aW9uICgkc2NvcGUsICR0eXBlcywgJGRpcmVjdGlvbikge1xyXG4gICAgICAgICRzY29wZS4kZGlyZWN0aW9uID0gJGRpcmVjdGlvbjtcclxuICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICRzY29wZS5oYXNSZWZlcmVuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZSAhPT0gbnVsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcyAhPT0gbnVsbCAmJiAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcy5sZW5ndGggIT09IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5zZXRTdHlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHN0cmluZzogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5VmFsdWVUeXBlID09PSAkdHlwZXMuc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgYm9vbDogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5VmFsdWVUeXBlID09PSAkdHlwZXMuYm9vbCxcclxuICAgICAgICAgICAgICAgIG51bWJlcjogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5VmFsdWVUeXBlID09PSAkdHlwZXMubnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgJ25vLXZhbHVlJzogISRzY29wZS5oYXNSZWZlcmVuY2UoKSAmJiAoISRzY29wZS5wcm9wZXJ0eS5WYWx1ZSB8fCAkc2NvcGUucHJvcGVydHkuVmFsdWUgPT09IFwiXCIpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbGVjdFJlZmVyZW5jZSA9IGZ1bmN0aW9uIChyZWZlcmVuY2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkUmVmZXJlbmNlID0gcmVmZXJlbmNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcmVnaW9uIERyYWdnaW5nIG5ldyByZWZlcmVuY2VcclxuXHJcbiAgICAgICAgJHNjb3BlLmRyYWcgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHNldE5ld1JlZmVyZW5jZVBvc2l0aW9uKCRldmVudC5jbGllbnRYLCAkZXZlbnQuY2xpZW50WSk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5kcmFnU3RhcnQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHNldE5ld1JlZmVyZW5jZVBvc2l0aW9uKCRldmVudC5jbGllbnRYLCAkZXZlbnQuY2xpZW50WSk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5kcmFnRW5kID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbUlkID0gJCgkZXZlbnQudGFyZ2V0KVswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaXRlbS1pZCcpO1xyXG4gICAgICAgICAgICB2YXIgcHJvcGVydHlOYW1lID0gJCgkZXZlbnQudGFyZ2V0KVswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvcGVydHktbmFtZScpO1xyXG4gICAgICAgICAgICBpZiAoIWl0ZW1JZCB8fCAhcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVmSXRlbSA9ICRzY29wZS5kZXNpZ25lci5nZXRJdGVtKGl0ZW1JZCk7XHJcbiAgICAgICAgICAgIHZhciByZWZQcm9wID0gJHNjb3BlLmRlc2lnbmVyLmdldFByb3BlcnR5KHJlZkl0ZW0sIHByb3BlcnR5TmFtZSk7XHJcbiAgICAgICAgICAgIGlmKHJlZlByb3AuRGlyZWN0aW9uID09PSAkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uIHx8IGl0ZW1JZCA9PT0gJHNjb3BlLml0ZW1EYXRhLklkKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uZXdSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFkZFJlZmVyZW5jZXMoJHNjb3BlLnByb3BlcnR5LCByZWZQcm9wLCByZWZJdGVtKTtcclxuICAgICAgICAgICAgJHNjb3BlLm5ld1JlZmVyZW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBEcmFnZ2luZyBuZXcgcmVmZXJlbmNlXHJcblxyXG4gICAgICAgIC8vcmVnaW9uIFByaXZhdGUgZnVuY3Rpb25zXHJcblxyXG4gICAgICAgIHZhciBhZGRSZWZlcmVuY2VzID0gZnVuY3Rpb24gKHNvdXJjZVByb3BlcnR5LCB0YXJnZXRQcm9wZXJ0eSwgdGFyZ2V0SXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoc291cmNlUHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2VQcm9wZXJ0eS5SZWZlcmVuY2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFza0lkOiB0YXJnZXRJdGVtLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogdGFyZ2V0UHJvcGVydHkuUHJvcGVydHlOYW1lXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJvcGVydHkuUmVmZXJlbmNlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBUYXNrSWQ6ICRzY29wZS5pdGVtRGF0YS5JZCxcclxuICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VkUHJvcGVydHk6ICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eU5hbWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJvcGVydHkuUmVmZXJlbmNlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFRhc2tJZDogJHNjb3BlLml0ZW1EYXRhLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5TmFtZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHNvdXJjZVByb3BlcnR5LlJlZmVyZW5jZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFza0lkOiB0YXJnZXRJdGVtLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogdGFyZ2V0UHJvcGVydHkuUHJvcGVydHlOYW1lXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHNldE5ld1JlZmVyZW5jZVBvc2l0aW9uID0gZnVuY3Rpb24gKHgsIHkpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm5ld1JlZmVyZW5jZSA9IHtcclxuICAgICAgICAgICAgICAgIHg6ICh4IC0gJHNjb3BlLmRlc2lnbmVyLmdldE9mZnNldCgpLngpICogKDEgLyAkc2NvcGUuZGVzaWduZXIuZ2V0U2NhbGUoKS54KSArICRzY29wZS5kZXNpZ25lci5nZXRWaWV3Qm94KCkueCAtIDEsXHJcbiAgICAgICAgICAgICAgICB5OiAoeSAtICRzY29wZS5kZXNpZ25lci5nZXRPZmZzZXQoKS55KSAqICgxIC8gJHNjb3BlLmRlc2lnbmVyLmdldFNjYWxlKCkueSkgKyAkc2NvcGUuZGVzaWduZXIuZ2V0Vmlld0JveCgpLnkgLSAxXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gUHJpdmF0ZSBmdW5jdGlvbnNcclxuXHJcbiAgICAgICAgLy9cclxuICAgICAgICAvL0Rpc3Bvc2luZ1xyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pXHJcbjsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5kaXJlY3RpdmUoJ2Nvbm5lY3RvcicsIFsndHlwZXMnLCAnZGlyZWN0aW9uJywgJ0Zsb3dEZXNpZ25lci5QYXRoU2VydmljZScsIGZ1bmN0aW9uICgkdHlwZXMsICRkaXJlY3Rpb24sICRwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnXmRlc2lnbmVyJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRwYXRoLnRlbXBsYXRlc0Jhc2VVcmwgKyAnY29ubmVjdG9yLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb25uZWN0b3JDdHJsJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGl0ZW1EYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogJz0nLFxyXG4gICAgICAgICAgICAgICAgaW5kZXg6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9mZnNldDogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBkZXNpZ25lckN0cmwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kZXNpZ25lciA9IGRlc2lnbmVyQ3RybDtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3JlZ2lvbiBBZGQgZnVuY3Rpb25zIHRvIHByb3BlcnR5IG9iamVjdFxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9wZXJ0eS5jYWxjdWxhdGVQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcHMgPSAkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0ID8gJHNjb3BlLml0ZW1EYXRhLklucHV0UHJvcGVydGllcyA6ICRzY29wZS5pdGVtRGF0YS5PdXRwdXRQcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogJHNjb3BlLnByb3BlcnR5LkRpcmVjdGlvbiA9PT0gJGRpcmVjdGlvbi5pbnB1dCA/ICRzY29wZS5pdGVtRGF0YS5Qb3NpdGlvbi5YIDogJHNjb3BlLml0ZW1EYXRhLlBvc2l0aW9uLlggKyAyNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6ICRzY29wZS5pdGVtRGF0YS5Qb3NpdGlvbi5ZICsgJHNjb3BlLm9mZnNldCArICgoMTcwIC0gJHNjb3BlLm9mZnNldCkgLyAocHJvcHMubGVuZ3RoICsgMSkpICogKCRzY29wZS5pbmRleCArIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvcGVydHkucmVtb3ZlUmVmZXJlbmNlID0gZnVuY3Rpb24gKGl0ZW1JZCwgcmVmZXJlbmNlZFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlZkl0ZW0gPSAkc2NvcGUuZGVzaWduZXIuZ2V0SXRlbShpdGVtSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZQcm9wID0gJHNjb3BlLmRlc2lnbmVyLmdldFByb3BlcnR5KHJlZkl0ZW0sIHJlZmVyZW5jZWRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wcm9wZXJ0eS5EaXJlY3Rpb24gPT09ICRkaXJlY3Rpb24uaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2UgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5xKCRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2VzKS5yZW1vdmUoZnVuY3Rpb24gKHJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZi5UYXNrSWQgPT09IGl0ZW1JZCAmJiByZWYuUmVmZXJlbmNlZFByb3BlcnR5ID09PSByZWZlcmVuY2VkUHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZWZQcm9wLnJlbW92ZVJlZmVyZW5jZSgkc2NvcGUuaXRlbURhdGEuSWQsICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2VuZHJlZ2lvbiBBZGQgZnVuY3Rpb25zIHRvIHByb3BlcnR5IG9iamVjdFxyXG5cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0l0IG5lZWRzIGZvciBhbmd1bGFyLCByZW1vdmVzIHN2ZyB3cmFwcGVyXHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50LmNoaWxkcmVuKCkpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZXBsYWNlV2l0aChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDkvOS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0Zsb3dEZXNpZ25lcicpXHJcbiAgICAuY29udHJvbGxlcihcImRlc2lnbmVyQ3RybFwiLCBbJyRzY29wZScsICdkaXJlY3Rpb24nLCBmdW5jdGlvbiAoJHNjb3BlLCAkZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnNjYWxlID0ge1xyXG4gICAgICAgICAgICB4OiAxLFxyXG4gICAgICAgICAgICB5OiAxXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUudmlld0JveCA9IHtcclxuICAgICAgICAgICAgeDogMCxcclxuICAgICAgICAgICAgeTogMCxcclxuICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLm1vdmluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAvL3JlZ2lvbiBDb250cm9sbGVyIGZ1bmN0aW9uc1xyXG5cclxuICAgICAgICB0aGlzLmdldFNjYWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNjYWxlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0T2Zmc2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4geyB4OiAkc2NvcGUub2Zmc2V0LngsIHk6ICRzY29wZS5vZmZzZXQueX07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRWaWV3Qm94ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnZpZXdCb3g7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRJdGVtID0gZnVuY3Rpb24gKGl0ZW1JZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbGlucSgkc2NvcGUuaXRlbXMpLmZpcnN0KGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5JZCA9PT0gaXRlbUlkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFByb3BlcnR5ID0gZnVuY3Rpb24gKGl0ZW0sIHByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvcCA9IGxpbnEoaXRlbS5JbnB1dFByb3BlcnRpZXMpLmZpcnN0T3JEZWZhdWx0KGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5LlByb3BlcnR5TmFtZSA9PT0gcHJvcGVydHlOYW1lO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHByb3ApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlucShpdGVtLk91dHB1dFByb3BlcnRpZXMpLmZpcnN0T3JEZWZhdWx0KGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5LlByb3BlcnR5TmFtZSA9PT0gcHJvcGVydHlOYW1lO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFJlZmVyZW5jZWRQcm9wZXJ0eSA9IGZ1bmN0aW9uIChyZWZlcmVuY2UpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLmdldEl0ZW0ocmVmZXJlbmNlLlRhc2tJZCk7XHJcbiAgICAgICAgICAgIHZhciBwcm9wID0gc2VsZi5nZXRQcm9wZXJ0eShpdGVtLCByZWZlcmVuY2UuUmVmZXJlbmNlZFByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwcm9wO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIENvbnRyb2xsZXIgZnVuY3Rpb25zXHJcblxyXG4gICAgICAgIC8vcmVnaW9uIERlc2lnbmVyIGl0ZW0gaGFuZGxpbmdcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RJdGVtID0gZnVuY3Rpb24gKHNlbGVjdGVkSXRlbSkge1xyXG4gICAgICAgICAgICBsaW5xKCRzY29wZS5pdGVtcykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkQ2hhbmdlZCh7aXRlbTogc2VsZWN0ZWRJdGVtfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGxpbnEoaXRlbS5JbnB1dFByb3BlcnRpZXMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9wLlJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3AucmVtb3ZlUmVmZXJlbmNlKHByb3AuUmVmZXJlbmNlLlRhc2tJZCwgcHJvcC5SZWZlcmVuY2UuUmVmZXJlbmNlZFByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsaW5xKGl0ZW0uT3V0cHV0UHJvcGVydGllcykuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgICAgICAgICAgICAgbGlucShwcm9wLlJlZmVyZW5jZXMpLmZvckVhY2goZnVuY3Rpb24gKHJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3AucmVtb3ZlUmVmZXJlbmNlKHJlZmVyZW5jZS5UYXNrSWQsIHJlZmVyZW5jZS5SZWZlcmVuY2VkUHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGlucSgkc2NvcGUuaXRlbXMpLnJlbW92ZShpdGVtKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBEZXNpZ25lciBpdGVtIGhhbmRsaW5nXHJcblxyXG4gICAgICAgIC8vcmVnaW9uIFpvb21pbmdcclxuXHJcbiAgICAgICAgJHNjb3BlLm9uTW91c2VXaGVlbCA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgc3RlcCA9IDAuMTtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudC5kZWx0YVkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNjYWxlLnggLSBzdGVwIDw9IDAgfHwgJHNjb3BlLnNjYWxlLnkgLSBzdGVwIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NhbGUueCAtPSBzdGVwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjYWxlLnkgLT0gc3RlcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGVsdGFZID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NhbGUueCArPSBzdGVwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjYWxlLnkgKz0gc3RlcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF91cGRhdGVWaWV3Qm94U2l6ZSgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnZpZXdCb3gud2lkdGggPSAkc2NvcGUuc2l6ZS53aWR0aCAvICRzY29wZS5zY2FsZS54O1xyXG4gICAgICAgICAgICAkc2NvcGUudmlld0JveC5oZWlnaHQgPSAkc2NvcGUuc2l6ZS5oZWlnaHQgLyAkc2NvcGUuc2NhbGUueTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzaXplV2F0Y2hlciA9ICRzY29wZS4kd2F0Y2goJ3NpemUnLCBfdXBkYXRlVmlld0JveFNpemUsIHRydWUpO1xyXG4gICAgICAgIHZhciBzY2FsZVdhdGNoZXIgPSAkc2NvcGUuJHdhdGNoKCdzY2FsZScsIF91cGRhdGVWaWV3Qm94U2l6ZSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIFpvb21pbmdcclxuXHJcbiAgICAgICAgLy8gcmVnaW9uIFZpZXdib3ggbW92aW5nXHJcblxyXG4gICAgICAgIHZhciBtb3ZlWCwgbW92ZVkgPSAwO1xyXG4gICAgICAgICRzY29wZS5tb3ZlU3RhcnQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIG1vdmVYID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIG1vdmVZID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS5tb3ZpbmcgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5tb3ZlID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgeCA9ICRldmVudC5jbGllbnRYO1xyXG4gICAgICAgICAgICB2YXIgeSA9ICRldmVudC5jbGllbnRZO1xyXG4gICAgICAgICAgICAkc2NvcGUudmlld0JveC54IC09ICh4IC0gbW92ZVgpICogKDEgLyAkc2NvcGUuc2NhbGUueCk7XHJcbiAgICAgICAgICAgICRzY29wZS52aWV3Qm94LnkgLT0gKHkgLSBtb3ZlWSkgKiAoMSAvICRzY29wZS5zY2FsZS55KTtcclxuICAgICAgICAgICAgbW92ZVggPSB4O1xyXG4gICAgICAgICAgICBtb3ZlWSA9IHk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLm1vdmVFbmQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tb3ZpbmcgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBWaWV3Ym94IG1vdmluZ1xyXG5cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNpemVXYXRjaGVyKCk7XHJcbiAgICAgICAgICAgIHNjYWxlV2F0Y2hlcigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pXHJcbjsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5jb250cm9sbGVyKFwiaXRlbUN0cmxcIiwgWyckc2NvcGUnLCAndHlwZXMnLCAnc3RhdHVzJywgZnVuY3Rpb24gKCRzY29wZSwgJHR5cGVzLCAkc3RhdHVzKSB7XHJcbiAgICAgICAgJHNjb3BlLiRzdGF0dXMgPSAkc3RhdHVzO1xyXG4gICAgICAgICRzY29wZS4kdHlwZXMgPSAkdHlwZXM7XHJcbiAgICAgICAgJHNjb3BlLndpZHRoID0gMjUwO1xyXG4gICAgICAgICRzY29wZS5oZWlnaHQgPSAxNzA7XHJcbiAgICAgICAgJHNjb3BlLmRyYWdnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGRyYWdYLCBkcmFnWSA9IDA7XHJcbiAgICAgICAgJHNjb3BlLmRyYWdTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgZHJhZ1ggPSAkZXZlbnQuY2xpZW50WDtcclxuICAgICAgICAgICAgZHJhZ1kgPSAkZXZlbnQuY2xpZW50WTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmRyYWcgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5kcmFnZ2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciB4ID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIHZhciB5ID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhLlBvc2l0aW9uLlggKz0gKHggLSBkcmFnWCkgKiAoMSAvICRzY29wZS5kZXNpZ25lci5nZXRTY2FsZSgpLngpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0YS5Qb3NpdGlvbi5ZICs9ICh5IC0gZHJhZ1kpICogKDEgLyAkc2NvcGUuZGVzaWduZXIuZ2V0U2NhbGUoKS55KTtcclxuICAgICAgICAgICAgZHJhZ1ggPSB4O1xyXG4gICAgICAgICAgICBkcmFnWSA9IHk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5kcmFnRW5kID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZHJhZ2dpbmcgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUub25JdGVtQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5kZXNpZ25lci5zZWxlY3RJdGVtKCRzY29wZS5kYXRhKTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdkZXNpZ25lckl0ZW0nLCBbICd0eXBlcycsICdzdGF0dXMnLCAnRmxvd0Rlc2lnbmVyLlBhdGhTZXJ2aWNlJywgZnVuY3Rpb24gKCR0eXBlcywgJHN0YXR1cywgJHBhdGgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdeZGVzaWduZXInLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJHBhdGgudGVtcGxhdGVzQmFzZVVybCArICdpdGVtLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBvZmZzZXRYOiAnPScsXHJcbiAgICAgICAgICAgICAgICBvZmZzZXRZOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2l0ZW1DdHJsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMsIGRlc2lnbmVyQ3RybCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuU3RhdHVzID0gJHN0YXR1cy5ub3RydW47XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVzaWduZXIgPSBkZXNpZ25lckN0cmw7XHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy9JdCBuZWVkcyBmb3IgYW5ndWxhciwgcmVtb3ZlcyBzdmcgd3JhcHBlclxyXG4gICAgICAgICAgICAgICAgdmFyIGUgPSBhbmd1bGFyLmVsZW1lbnQoZWxlbWVudC5jaGlsZHJlbigpKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQucmVwbGFjZVdpdGgoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdpdGVtVGl0bGUnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJmb250LW0gYm94LWhlYWRlclwiIG5nLXRyYW5zY2x1ZGU+PC9kaXY+JyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2l0ZW1EZXNjcmlwdGlvbicsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJmb250LXhzXCIgbmctdHJhbnNjbHVkZT48L2Rpdj4nLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKSIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiAxMC82LzIwMTQuXHJcbiAqL1xyXG52YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xyXG52YXIgY3VycmVudFNjcmlwdFBhdGggPSBzY3JpcHRzW3NjcmlwdHMubGVuZ3RoIC0gMV0uc3JjO1xyXG52YXIgZmxvd0Rlc2lnbmVyUm9vdFBhdGggPSBjdXJyZW50U2NyaXB0UGF0aC5zcGxpdChcImpzL1wiKVswXTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInKVxyXG4gICAgLnNlcnZpY2UoXCJGbG93RGVzaWduZXIuUGF0aFNlcnZpY2VcIiwgWyBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZXNCYXNlVXJsOiBmbG93RGVzaWduZXJSb290UGF0aCArIFwidGVtcGxhdGVzL1wiXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC81LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnU3ZnLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdXaWR0aCcsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGF0dHJzLm5nV2lkdGgsIGZ1bmN0aW9uICh3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcIndpZHRoXCIsIHdpZHRoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdIZWlnaHQnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0hlaWdodCwgZnVuY3Rpb24gKGhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1gnLCBbJyRjb21waWxlJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gsIGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieFwiLCB4KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdZJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdZLCBmdW5jdGlvbiAoeSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInlcIiwgeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nQ3gnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0N4LCBmdW5jdGlvbiAoY3gpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJjeFwiLCBjeCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nQ3knLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0N5LCBmdW5jdGlvbiAoY3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJjeVwiLCBjeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWDEnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gxLCBmdW5jdGlvbiAoeDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ4MVwiLCB4MSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWDInLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gyLCBmdW5jdGlvbiAoeDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ4MlwiLCB4Mik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWTEnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1kxLCBmdW5jdGlvbiAoeTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5MVwiLCB5MSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWTInLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1kyLCBmdW5jdGlvbiAoeTIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5MlwiLCB5Mik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2F1dG9TaXplJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlbGVtZW50LndpZHRoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdWaWV3Ym94JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdWaWV3Ym94LCBmdW5jdGlvbiAodmlld2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmlld2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHZpZXdib3gueCArIFwiIFwiICsgdmlld2JveC55ICsgXCIgXCIgKyB2aWV3Ym94LndpZHRoICsgXCIgXCIgKyB2aWV3Ym94LmhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIiwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCd0ZXh0RWxsaXBzaXMnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gcGFyc2VGbG9hdChhdHRycy5tYXhXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkc2NvcGUuJGV2YWwoYXR0cnMudGV4dEVsbGlwc2lzKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC53aWR0aCgpID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZWxlbWVudC53aWR0aCgpID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSkgKyAnLi4uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC8xNS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ1RvdWNoLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgndGFwJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGltZVN0YW1wO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aW1lU3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdtb3VzZXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRlIC0gdGltZVN0YW1wIDw9IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy50YXAsIHsgJGV2ZW50OiBldmVudCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnbW91c2Vkb3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC51bmJpbmQoJ21vdXNldXAnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pLmRpcmVjdGl2ZSgnZG91YmxlVGFwJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmhhbW1lcih7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFwczogMlxyXG4gICAgICAgICAgICAgICAgfSkuYmluZCgndGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lmdlc3R1cmUudGFwQ291bnQgPT09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMuZG91YmxlVGFwLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0Rpc3Bvc2luZ1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5oYW1tZXIoKS51bmJpbmQoJ3RhcCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSkuZGlyZWN0aXZlKCdwYW4nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnbW91c2Vkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMucGFuQmVnaW4sIHsgJGV2ZW50OiBldmVudH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW91c2VNb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLnBhbiwgeyAkZXZlbnQ6IGV2ZW50IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNlbW92ZScsIG1vdXNlTW92ZUhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW91c2VVcEhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy5wYW5SZWxlYXNlLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZW1vdmUnLCBtb3VzZU1vdmVIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS51bmJpbmQoJ21vdXNldXAnLCBtb3VzZVVwSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkuYmluZCgnbW91c2V1cCcsIG1vdXNlVXBIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnbW91c2Vkb3duJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIvKipcbiAqIENvcHlyaWdodCBNYXJjIEouIFNjaG1pZHQuIFNlZSB0aGUgTElDRU5TRSBmaWxlIGF0IHRoZSB0b3AtbGV2ZWxcbiAqIGRpcmVjdG9yeSBvZiB0aGlzIGRpc3RyaWJ1dGlvbiBhbmQgYXRcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXJjai9jc3MtZWxlbWVudC1xdWVyaWVzL2Jsb2IvbWFzdGVyL0xJQ0VOU0UuXG4gKi9cbjtcbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKlxuICAgICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICB2YXIgRWxlbWVudFF1ZXJpZXMgPSB0aGlzLkVsZW1lbnRRdWVyaWVzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy53aXRoVHJhY2tpbmcgPSBmYWxzZTtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBlbGVtZW50XG4gICAgICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBnZXRFbVNpemUoZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmb250U2l6ZSA9IGdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgJ2ZvbnRTaXplJyk7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChmb250U2l6ZSkgfHwgMTY7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICogQGNvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vTXIwZ3JvZy9lbGVtZW50LXF1ZXJ5L2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICAgICAgICAgKiBAcGFyYW0geyp9IHZhbHVlXG4gICAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gY29udmVydFRvUHgoZWxlbWVudCwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhciB1bml0cyA9IHZhbHVlLnJlcGxhY2UoL1swLTldKi8sICcnKTtcbiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgICBzd2l0Y2ggKHVuaXRzKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInB4XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZW1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICogZ2V0RW1TaXplKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyZW1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICogZ2V0RW1TaXplKCk7XG4gICAgICAgICAgICAgICAgLy8gVmlld3BvcnQgdW5pdHMhXG4gICAgICAgICAgICAgICAgLy8gQWNjb3JkaW5nIHRvIGh0dHA6Ly9xdWlya3Ntb2RlLm9yZy9tb2JpbGUvdGFibGVWaWV3cG9ydC5odG1sXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoL0hlaWdodCBnZXRzIHVzIHRoZSBtb3N0IHJlbGlhYmxlIGluZm9cbiAgICAgICAgICAgICAgICBjYXNlIFwidndcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC8gMTAwO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ2aFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgKiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gMTAwO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ2bWluXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInZtYXhcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZ3ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC8gMTAwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gMTAwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2hvb3NlciA9IE1hdGhbdW5pdHMgPT09IFwidm1pblwiID8gXCJtaW5cIiA6IFwibWF4XCJdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgKiBjaG9vc2VyKHZ3LCB2aCk7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgIC8vIGZvciBub3csIG5vdCBzdXBwb3J0aW5nIHBoeXNpY2FsIHVuaXRzIChzaW5jZSB0aGV5IGFyZSBqdXN0IGEgc2V0IG51bWJlciBvZiBweClcbiAgICAgICAgICAgICAgICAvLyBvciBleC9jaCAoZ2V0dGluZyBhY2N1cmF0ZSBtZWFzdXJlbWVudHMgaXMgaGFyZClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAgICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gU2V0dXBJbmZvcm1hdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0ge307XG4gICAgICAgICAgICB2YXIga2V5LCBvcHRpb24sIHdpZHRoID0gMCwgaGVpZ2h0ID0gMCwgdmFsdWUsIGFjdHVhbFZhbHVlLCBhdHRyVmFsdWVzLCBhdHRyVmFsdWUsIGF0dHJOYW1lO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb24ge21vZGU6ICdtaW58bWF4JywgcHJvcGVydHk6ICd3aWR0aHxoZWlnaHQnLCB2YWx1ZTogJzEyM3B4J31cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5hZGRPcHRpb24gPSBmdW5jdGlvbihvcHRpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gW29wdGlvbi5tb2RlLCBvcHRpb24ucHJvcGVydHksIG9wdGlvbi52YWx1ZV0uam9pbignLCcpO1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1tpZHhdID0gb3B0aW9uO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBbJ21pbi13aWR0aCcsICdtaW4taGVpZ2h0JywgJ21heC13aWR0aCcsICdtYXgtaGVpZ2h0J107XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRXh0cmFjdHMgdGhlIGNvbXB1dGVkIHdpZHRoL2hlaWdodCBhbmQgc2V0cyB0byBtaW4vbWF4LSBhdHRyaWJ1dGUuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuY2FsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIGV4dHJhY3QgY3VycmVudCBkaW1lbnNpb25zXG4gICAgICAgICAgICAgICAgd2lkdGggPSB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblxuICAgICAgICAgICAgICAgIGF0dHJWYWx1ZXMgPSB7fTtcblxuICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIHRoaXMub3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbiA9IHRoaXMub3B0aW9uc1trZXldO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY29udmVydFRvUHgodGhpcy5lbGVtZW50LCBvcHRpb24udmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFjdHVhbFZhbHVlID0gb3B0aW9uLnByb3BlcnR5ID09ICd3aWR0aCcgPyB3aWR0aCA6IGhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgYXR0ck5hbWUgPSBvcHRpb24ubW9kZSArICctJyArIG9wdGlvbi5wcm9wZXJ0eTtcbiAgICAgICAgICAgICAgICAgICAgYXR0clZhbHVlID0gJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbi5tb2RlID09ICdtaW4nICYmIGFjdHVhbFZhbHVlID49IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyVmFsdWUgKz0gb3B0aW9uLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbi5tb2RlID09ICdtYXgnICYmIGFjdHVhbFZhbHVlIDw9IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyVmFsdWUgKz0gb3B0aW9uLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhdHRyVmFsdWVzW2F0dHJOYW1lXSkgYXR0clZhbHVlc1thdHRyTmFtZV0gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJWYWx1ZSAmJiAtMSA9PT0gKCcgJythdHRyVmFsdWVzW2F0dHJOYW1lXSsnICcpLmluZGV4T2YoJyAnICsgYXR0clZhbHVlICsgJyAnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0clZhbHVlc1thdHRyTmFtZV0gKz0gJyAnICsgYXR0clZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyVmFsdWVzW2F0dHJpYnV0ZXNba11dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZXNba10sIGF0dHJWYWx1ZXNbYXR0cmlidXRlc1trXV0uc3Vic3RyKDEpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlc1trXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICAgICAgb3B0aW9uc1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2V0dXBFbGVtZW50KGVsZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmVsZW1lbnRRdWVyaWVzU2V0dXBJbmZvcm1hdGlvbikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZWxlbWVudFF1ZXJpZXNTZXR1cEluZm9ybWF0aW9uLmFkZE9wdGlvbihvcHRpb25zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5lbGVtZW50UXVlcmllc1NldHVwSW5mb3JtYXRpb24gPSBuZXcgU2V0dXBJbmZvcm1hdGlvbihlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmVsZW1lbnRRdWVyaWVzU2V0dXBJbmZvcm1hdGlvbi5hZGRPcHRpb24ob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5lbGVtZW50UXVlcmllc1NlbnNvciA9IG5ldyBSZXNpemVTZW5zb3IoZWxlbWVudCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZWxlbWVudFF1ZXJpZXNTZXR1cEluZm9ybWF0aW9uLmNhbGwoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuZWxlbWVudFF1ZXJpZXNTZXR1cEluZm9ybWF0aW9uLmNhbGwoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMud2l0aFRyYWNraW5nKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3JcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG1vZGUgbWlufG1heFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHkgd2lkdGh8aGVpZ2h0XG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gcXVldWVRdWVyeShzZWxlY3RvciwgbW9kZSwgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgcXVlcnk7XG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCkgcXVlcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsLmJpbmQoZG9jdW1lbnQpO1xuICAgICAgICAgICAgaWYgKCFxdWVyeSAmJiAndW5kZWZpbmVkJyAhPT0gdHlwZW9mICQkKSBxdWVyeSA9ICQkO1xuICAgICAgICAgICAgaWYgKCFxdWVyeSAmJiAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGpRdWVyeSkgcXVlcnkgPSBqUXVlcnk7XG5cbiAgICAgICAgICAgIGlmICghcXVlcnkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyAnTm8gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCwgalF1ZXJ5IG9yIE1vb3Rvb2xzXFwncyAkJCBmb3VuZC4nO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZWxlbWVudHMgPSBxdWVyeShzZWxlY3Rvcik7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGo7IGkrKykge1xuICAgICAgICAgICAgICAgIHNldHVwRWxlbWVudChlbGVtZW50c1tpXSwge1xuICAgICAgICAgICAgICAgICAgICBtb2RlOiBtb2RlLFxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogcHJvcGVydHksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJlZ2V4ID0gLyw/KFteLFxcbl0qKVxcW1tcXHNcXHRdKihtaW58bWF4KS0od2lkdGh8aGVpZ2h0KVtcXHNcXHRdKlt+JFxcXl0/PVtcXHNcXHRdKlwiKFteXCJdKilcIltcXHNcXHRdKl0oW15cXG5cXHNcXHtdKikvbWdpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY3NzXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBleHRyYWN0UXVlcnkoY3NzKSB7XG4gICAgICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgICAgICBjc3MgPSBjc3MucmVwbGFjZSgvJy9nLCAnXCInKTtcbiAgICAgICAgICAgIHdoaWxlIChudWxsICE9PSAobWF0Y2ggPSByZWdleC5leGVjKGNzcykpKSB7XG4gICAgICAgICAgICAgICAgaWYgKDUgPCBtYXRjaC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcXVldWVRdWVyeShtYXRjaFsxXSB8fCBtYXRjaFs1XSwgbWF0Y2hbMl0sIG1hdGNoWzNdLCBtYXRjaFs0XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwYXJhbSB7Q3NzUnVsZVtdfFN0cmluZ30gcnVsZXNcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHJlYWRSdWxlcyhydWxlcykge1xuICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gJyc7XG4gICAgICAgICAgICBpZiAoIXJ1bGVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCdzdHJpbmcnID09PSB0eXBlb2YgcnVsZXMpIHtcbiAgICAgICAgICAgICAgICBydWxlcyA9IHJ1bGVzLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKC0xICE9PSBydWxlcy5pbmRleE9mKCdtaW4td2lkdGgnKSB8fCAtMSAhPT0gcnVsZXMuaW5kZXhPZignbWF4LXdpZHRoJykpIHtcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFjdFF1ZXJ5KHJ1bGVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gcnVsZXMubGVuZ3RoOyBpIDwgajsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgxID09PSBydWxlc1tpXS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvciA9IHJ1bGVzW2ldLnNlbGVjdG9yVGV4dCB8fCBydWxlc1tpXS5jc3NUZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0xICE9PSBzZWxlY3Rvci5pbmRleE9mKCdtaW4taGVpZ2h0JykgfHwgLTEgIT09IHNlbGVjdG9yLmluZGV4T2YoJ21heC1oZWlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RRdWVyeShzZWxlY3Rvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZigtMSAhPT0gc2VsZWN0b3IuaW5kZXhPZignbWluLXdpZHRoJykgfHwgLTEgIT09IHNlbGVjdG9yLmluZGV4T2YoJ21heC13aWR0aCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdFF1ZXJ5KHNlbGVjdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICg0ID09PSBydWxlc1tpXS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkUnVsZXMocnVsZXNbaV0uY3NzUnVsZXMgfHwgcnVsZXNbaV0ucnVsZXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlYXJjaGVzIGFsbCBjc3MgcnVsZXMgYW5kIHNldHVwcyB0aGUgZXZlbnQgbGlzdGVuZXIgdG8gYWxsIGVsZW1lbnRzIHdpdGggZWxlbWVudCBxdWVyeSBydWxlcy4uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gd2l0aFRyYWNraW5nIGFsbG93cyBhbmQgcmVxdWlyZXMgeW91IHRvIHVzZSBkZXRhY2gsIHNpbmNlIHdlIHN0b3JlIGludGVybmFsbHkgYWxsIHVzZWQgZWxlbWVudHNcbiAgICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vIGdhcmJhZ2UgY29sbGVjdGlvbiBwb3NzaWJsZSBpZiB5b3UgZG9uIG5vdCBjYWxsIC5kZXRhY2goKSBmaXJzdClcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKHdpdGhUcmFja2luZykge1xuICAgICAgICAgICAgdGhpcy53aXRoVHJhY2tpbmcgPSB3aXRoVHJhY2tpbmc7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IGRvY3VtZW50LnN0eWxlU2hlZXRzLmxlbmd0aDsgaSA8IGo7IGkrKykge1xuICAgICAgICAgICAgICAgIHJlYWRSdWxlcyhkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5jc3NUZXh0IHx8IGRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmNzc1J1bGVzIHx8IGRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLnJ1bGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSB3aXRoVHJhY2tpbmcgYWxsb3dzIGFuZCByZXF1aXJlcyB5b3UgdG8gdXNlIGRldGFjaCwgc2luY2Ugd2Ugc3RvcmUgaW50ZXJuYWxseSBhbGwgdXNlZCBlbGVtZW50c1xuICAgICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm8gZ2FyYmFnZSBjb2xsZWN0aW9uIHBvc3NpYmxlIGlmIHlvdSBkb24gbm90IGNhbGwgLmRldGFjaCgpIGZpcnN0KVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cGRhdGUgPSBmdW5jdGlvbih3aXRoVHJhY2tpbmcpIHtcbiAgICAgICAgICAgIHRoaXMud2l0aFRyYWNraW5nID0gd2l0aFRyYWNraW5nO1xuICAgICAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5kZXRhY2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy53aXRoVHJhY2tpbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyAnd2l0aFRyYWNraW5nIGlzIG5vdCBlbmFibGVkLiBXZSBjYW4gbm90IGRldGFjaCBlbGVtZW50cyBzaW5jZSB3ZSBkb24gbm90IHN0b3JlIGl0LicgK1xuICAgICAgICAgICAgICAgICdVc2UgRWxlbWVudFF1ZXJpZXMud2l0aFRyYWNraW5nID0gdHJ1ZTsgYmVmb3JlIGRvbXJlYWR5Lic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBlbGVtZW50O1xuICAgICAgICAgICAgd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50cy5wb3AoKSkge1xuICAgICAgICAgICAgICAgIEVsZW1lbnRRdWVyaWVzLmRldGFjaChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudHMgPSBbXTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHdpdGhUcmFja2luZyBhbGxvd3MgYW5kIHJlcXVpcmVzIHlvdSB0byB1c2UgZGV0YWNoLCBzaW5jZSB3ZSBzdG9yZSBpbnRlcm5hbGx5IGFsbCB1c2VkIGVsZW1lbnRzXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vIGdhcmJhZ2UgY29sbGVjdGlvbiBwb3NzaWJsZSBpZiB5b3UgZG9uIG5vdCBjYWxsIC5kZXRhY2goKSBmaXJzdClcbiAgICAgKi9cbiAgICBFbGVtZW50UXVlcmllcy51cGRhdGUgPSBmdW5jdGlvbih3aXRoVHJhY2tpbmcpIHtcbiAgICAgICAgRWxlbWVudFF1ZXJpZXMuaW5zdGFuY2UudXBkYXRlKHdpdGhUcmFja2luZyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYWxsIHNlbnNvciBhbmQgZWxlbWVudHF1ZXJ5IGluZm9ybWF0aW9uIGZyb20gdGhlIGVsZW1lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAgICovXG4gICAgRWxlbWVudFF1ZXJpZXMuZGV0YWNoID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5lbGVtZW50UXVlcmllc1NldHVwSW5mb3JtYXRpb24pIHtcbiAgICAgICAgICAgIGVsZW1lbnQuZWxlbWVudFF1ZXJpZXNTZW5zb3IuZGV0YWNoKCk7XG4gICAgICAgICAgICBkZWxldGUgZWxlbWVudC5lbGVtZW50UXVlcmllc1NldHVwSW5mb3JtYXRpb247XG4gICAgICAgICAgICBkZWxldGUgZWxlbWVudC5lbGVtZW50UXVlcmllc1NlbnNvcjtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkZXRhY2hlZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RldGFjaGVkIGFscmVhZHknLCBlbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBFbGVtZW50UXVlcmllcy53aXRoVHJhY2tpbmcgPSBmYWxzZTtcblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIEVsZW1lbnRRdWVyaWVzLmluc3RhbmNlID0gbmV3IEVsZW1lbnRRdWVyaWVzKCk7XG4gICAgICAgIEVsZW1lbnRRdWVyaWVzLmluc3RhbmNlLmluaXQoRWxlbWVudFF1ZXJpZXMud2l0aFRyYWNraW5nKTtcbiAgICB9XG5cbiAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0LCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LmF0dGFjaEV2ZW50KCdvbmxvYWQnLCBpbml0KTtcbiAgICB9XG5cbn0pKCk7IiwiLyoqXG4gKiBDb3B5cmlnaHQgTWFyYyBKLiBTY2htaWR0LiBTZWUgdGhlIExJQ0VOU0UgZmlsZSBhdCB0aGUgdG9wLWxldmVsXG4gKiBkaXJlY3Rvcnkgb2YgdGhpcyBkaXN0cmlidXRpb24gYW5kIGF0XG4gKiBodHRwczovL2dpdGh1Yi5jb20vbWFyY2ovY3NzLWVsZW1lbnQtcXVlcmllcy9ibG9iL21hc3Rlci9MSUNFTlNFLlxuICovXG47XG4oZnVuY3Rpb24oKSB7XG5cbiAgICAvKipcbiAgICAgKiBDbGFzcyBmb3IgZGltZW5zaW9uIGNoYW5nZSBkZXRlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8RWxlbWVudFtdfEVsZW1lbnRzfGpRdWVyeX0gZWxlbWVudFxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICpcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICB0aGlzLlJlc2l6ZVNlbnNvciA9IGZ1bmN0aW9uKGVsZW1lbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIEV2ZW50UXVldWUoKSB7XG4gICAgICAgICAgICB0aGlzLnEgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuYWRkID0gZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnEucHVzaChldik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgaSwgajtcbiAgICAgICAgICAgIHRoaXMuY2FsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGogPSB0aGlzLnEubGVuZ3RoOyBpIDwgajsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucVtpXS5jYWxsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgICAgIHByb3BcbiAgICAgICAgICogQHJldHVybnMge1N0cmluZ3xOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIHByb3ApIHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmN1cnJlbnRTdHlsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmN1cnJlbnRTdHlsZVtwcm9wXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc3R5bGVbcHJvcF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSAgICByZXNpemVkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBhdHRhY2hSZXNpemVFdmVudChlbGVtZW50LCByZXNpemVkKSB7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQucmVzaXplZEF0dGFjaGVkKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZXNpemVkQXR0YWNoZWQgPSBuZXcgRXZlbnRRdWV1ZSgpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucmVzaXplZEF0dGFjaGVkLmFkZChyZXNpemVkKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5yZXNpemVkQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlc2l6ZWRBdHRhY2hlZC5hZGQocmVzaXplZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LnJlc2l6ZVNlbnNvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZWxlbWVudC5yZXNpemVTZW5zb3IuY2xhc3NOYW1lID0gJ3Jlc2l6ZS1zZW5zb3InO1xuICAgICAgICAgICAgdmFyIHN0eWxlID0gJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogMDsgdG9wOiAwOyByaWdodDogMDsgYm90dG9tOiAwOyBvdmVyZmxvdzogc2Nyb2xsOyB6LWluZGV4OiAtMTsgdmlzaWJpbGl0eTogaGlkZGVuOyc7XG4gICAgICAgICAgICB2YXIgc3R5bGVDaGlsZCA9ICdwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDA7IHRvcDogMDsnO1xuXG4gICAgICAgICAgICBlbGVtZW50LnJlc2l6ZVNlbnNvci5zdHlsZS5jc3NUZXh0ID0gc3R5bGU7XG4gICAgICAgICAgICBlbGVtZW50LnJlc2l6ZVNlbnNvci5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicmVzaXplLXNlbnNvci1leHBhbmRcIiBzdHlsZT1cIicgKyBzdHlsZSArICdcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgc3R5bGU9XCInICsgc3R5bGVDaGlsZCArICdcIj48L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyZXNpemUtc2Vuc29yLXNocmlua1wiIHN0eWxlPVwiJyArIHN0eWxlICsgJ1wiPicgK1xuICAgICAgICAgICAgICAgICAgICAnPGRpdiBzdHlsZT1cIicgKyBzdHlsZUNoaWxkICsgJyB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlXCI+PC9kaXY+JyArXG4gICAgICAgICAgICAgICAgJzwvZGl2Pic7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGVsZW1lbnQucmVzaXplU2Vuc29yKTtcblxuICAgICAgICAgICAgaWYgKCF7Zml4ZWQ6IDEsIGFic29sdXRlOiAxfVtnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsICdwb3NpdGlvbicpXSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZXhwYW5kID0gZWxlbWVudC5yZXNpemVTZW5zb3IuY2hpbGROb2Rlc1swXTtcbiAgICAgICAgICAgIHZhciBleHBhbmRDaGlsZCA9IGV4cGFuZC5jaGlsZE5vZGVzWzBdO1xuICAgICAgICAgICAgdmFyIHNocmluayA9IGVsZW1lbnQucmVzaXplU2Vuc29yLmNoaWxkTm9kZXNbMV07XG4gICAgICAgICAgICB2YXIgc2hyaW5rQ2hpbGQgPSBzaHJpbmsuY2hpbGROb2Rlc1swXTtcblxuICAgICAgICAgICAgdmFyIGxhc3RXaWR0aCwgbGFzdEhlaWdodDtcblxuICAgICAgICAgICAgdmFyIHJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZXhwYW5kQ2hpbGQuc3R5bGUud2lkdGggPSBleHBhbmQub2Zmc2V0V2lkdGggKyAxMCArICdweCc7XG4gICAgICAgICAgICAgICAgZXhwYW5kQ2hpbGQuc3R5bGUuaGVpZ2h0ID0gZXhwYW5kLm9mZnNldEhlaWdodCArIDEwICsgJ3B4JztcbiAgICAgICAgICAgICAgICBleHBhbmQuc2Nyb2xsTGVmdCA9IGV4cGFuZC5zY3JvbGxXaWR0aDtcbiAgICAgICAgICAgICAgICBleHBhbmQuc2Nyb2xsVG9wID0gZXhwYW5kLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgICAgICBzaHJpbmsuc2Nyb2xsTGVmdCA9IHNocmluay5zY3JvbGxXaWR0aDtcbiAgICAgICAgICAgICAgICBzaHJpbmsuc2Nyb2xsVG9wID0gc2hyaW5rLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgICAgICBsYXN0V2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICAgICAgICAgIGxhc3RIZWlnaHQgPSBlbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlc2V0KCk7XG5cbiAgICAgICAgICAgIHZhciBjaGFuZ2VkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucmVzaXplZEF0dGFjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVzaXplZEF0dGFjaGVkLmNhbGwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgYWRkRXZlbnQgPSBmdW5jdGlvbihlbCwgbmFtZSwgY2IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWwuYXR0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWwuYXR0YWNoRXZlbnQoJ29uJyArIG5hbWUsIGNiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKG5hbWUsIGNiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBhZGRFdmVudChleHBhbmQsICdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5vZmZzZXRXaWR0aCA+IGxhc3RXaWR0aCB8fCBlbGVtZW50Lm9mZnNldEhlaWdodCA+IGxhc3RIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNldCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGFkZEV2ZW50KHNocmluaywgJ3Njcm9sbCcsZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQub2Zmc2V0V2lkdGggPCBsYXN0V2lkdGggfHwgZWxlbWVudC5vZmZzZXRIZWlnaHQgPCBsYXN0SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFwiW29iamVjdCBBcnJheV1cIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGVsZW1lbnQpXG4gICAgICAgICAgICB8fCAoJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBqUXVlcnkgJiYgZWxlbWVudCBpbnN0YW5jZW9mIGpRdWVyeSkgLy9qcXVlcnlcbiAgICAgICAgICAgIHx8ICgndW5kZWZpbmVkJyAhPT0gdHlwZW9mIEVsZW1lbnRzICYmIGVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50cykgLy9tb290b29sc1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICB2YXIgaSA9IDAsIGogPSBlbGVtZW50Lmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoOyBpIDwgajsgaSsrKSB7XG4gICAgICAgICAgICAgICAgYXR0YWNoUmVzaXplRXZlbnQoZWxlbWVudFtpXSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXR0YWNoUmVzaXplRXZlbnQoZWxlbWVudCwgY2FsbGJhY2spO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5kZXRhY2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFJlc2l6ZVNlbnNvci5kZXRhY2goZWxlbWVudCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIHRoaXMuUmVzaXplU2Vuc29yLmRldGFjaCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQucmVzaXplU2Vuc29yKSB7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQucmVzaXplU2Vuc29yKTtcbiAgICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnJlc2l6ZVNlbnNvcjtcbiAgICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnJlc2l6ZWRBdHRhY2hlZDtcbiAgICAgICAgfVxuICAgIH07XG5cbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9