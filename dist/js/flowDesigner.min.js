angular.module("FlowDesigner",["Svg.Directive","Touch.Directive","Common.Directive"]).constant("types",{text:"Text",bool:"Bool","int":"Number"}).constant("status",{notrun:"notrun",running:"running",failed:"failed",succeeded:"succeeded"}).constant("direction",{input:"input",output:"output"}).directive("designer",["$timeout","pathService",function(e,t){return{restrict:"AE",transclude:!1,replace:!0,templateUrl:t.templatesBaseUrl+"designer.tmpl.html",scope:{autoSize:"=",items:"=",selectedChanged:"&"},controller:"designerCtrl",link:function(e,t){e.size={width:t.width(),height:t.height()},e.offset={x:t.offset().left,y:t.offset().top}}}}]),angular.module("Common.Directive",[]).directive("ngMousewheel",[function(){return{restrict:"A",require:"?ngModel",replace:!0,scope:!1,link:function(e,t,n){t.mousewheel(function(t){e.$apply(function(){e.$eval(n.ngMousewheel,{event:t})})})}}}]),angular.module("FlowDesigner").controller("connectorCtrl",["$scope","types","direction",function(e,t,n){e.$direction=n,e.newReference=null,e.selectedReference=null,e.hasReference=function(){return e.property.Direction===n.input?null!==e.property.Reference:null!==e.property.References&&0!==e.property.References.length},e.setStyle=function(){return{string:e.property.PropertyValueType===t.string,bool:e.property.PropertyValueType===t.bool,number:e.property.PropertyValueType===t.int,"no-value":!(e.hasReference()||e.property.Value&&""!==e.property.Value)}},e.selectReference=function(t){e.selectedReference=t},e.drag=function(e){i(e.clientX,e.clientY),e.stopPropagation()},e.dragStart=function(e){i(e.clientX,e.clientY),e.stopPropagation()},e.dragEnd=function(t){var n=$(t.target)[0].getAttribute("data-item-id"),i=$(t.target)[0].getAttribute("data-property-name");if(!n||!i)return void(e.newReference=null);var o=e.designer.getItem(n),c=e.designer.getProperty(o,i);return c.Direction===e.property.Direction||n===e.itemData.Id?void(e.newReference=null):(r(e.property,c,o),e.newReference=null,void t.stopPropagation())};var r=function(t,r,i){t.Direction===n.input?(t.Reference={TaskId:i.Id,ReferencedProperty:r.PropertyName},r.References.push({TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName})):(r.Reference={TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName},t.References.push({TaskId:i.Id,ReferencedProperty:r.PropertyName}))},i=function(t,n){e.newReference={x:(t-e.designer.getOffset().x)*(1/e.designer.getScale().x)+e.designer.getViewBox().x-1,y:(n-e.designer.getOffset().y)*(1/e.designer.getScale().y)+e.designer.getViewBox().y-1}};e.$on("$destroy",function(){})}]),angular.module("FlowDesigner").directive("connector",["types","direction","pathService",function(e,t,n){return{restrict:"AE",replace:!0,require:"^designer",templateUrl:n.templatesBaseUrl+"connector.tmpl.html",controller:"connectorCtrl",scope:{itemData:"=",property:"=",index:"=",offset:"="},link:function(e,n,r,i){e.designer=i,e.property.calculatePosition=function(){var n=e.property.Direction===t.input?e.itemData.InputProperties:e.itemData.OutputProperties;return{x:e.property.Direction===t.input?e.itemData.Position.X:e.itemData.Position.X+250,y:e.itemData.Position.Y+e.offset+(170-e.offset)/(n.length+1)*(e.index+1)}},e.property.removeReference=function(n,r){var i=e.designer.getItem(n),o=e.designer.getProperty(i,r);if(e.property.Direction===t.input){if(null===e.property.Reference)return;e.property.Reference=null}else{if(0===e.property.References.length)return;linq(e.property.References).remove(function(e){return e.TaskId===n&&e.ReferencedProperty===r})}o.removeReference(e.itemData.Id,e.property.PropertyName)};var o=angular.element(n.children());n.replaceWith(o)}}}]),angular.module("FlowDesigner").controller("designerCtrl",["$scope","direction",function(e){function t(){e.viewBox.width=e.size.width/e.scale.x,e.viewBox.height=e.size.height/e.scale.y}var n=this;e.size={width:0,height:0},e.scale={x:1,y:1},e.viewBox={x:0,y:0,width:0,height:0},e.moving=!1,this.getScale=function(){return e.scale},this.getOffset=function(){return{x:e.offset.x,y:e.offset.y}},this.getViewBox=function(){return e.viewBox},this.getItem=function(t){return linq(e.items).first(function(e){return e.Id===t})},this.getProperty=function(e,t){var n=linq(e.InputProperties).firstOrDefault(function(e){return e.PropertyName===t});return n?n:linq(e.OutputProperties).firstOrDefault(function(e){return e.PropertyName===t})},this.getReferencedProperty=function(e){var t=n.getItem(e.TaskId),r=n.getProperty(t,e.ReferencedProperty);return r},this.selectItem=function(t){linq(e.items).forEach(function(e){e.selected=!1}),t.selected=!0,e.selectedChanged({item:t})},this.removeItem=function(t){linq(t.InputProperties).forEach(function(e){e.Reference&&e.removeReference(e.Reference.TaskId,e.Reference.ReferencedProperty)}),linq(t.OutputProperties).forEach(function(e){linq(e.References).forEach(function(t){e.removeReference(t.TaskId,t.ReferencedProperty)})}),linq(e.items).remove(t)},e.onMouseWheel=function(t){var n=.1;if(-1===t.deltaY){if(e.scale.x-n<=0||e.scale.y-n<=0)return;e.scale.x-=n,e.scale.y-=n}1===t.deltaY&&(e.scale.x+=n,e.scale.y+=n),t.preventDefault()};var r,i=e.$watch("size",t,!0),o=e.$watch("scale",t,!0),c=0;e.moveStart=function(t){r=t.clientX,c=t.clientY,e.moving=!0},e.move=function(t){var n=t.clientX,i=t.clientY;e.viewBox.x-=(n-r)*(1/e.scale.x),e.viewBox.y-=(i-c)*(1/e.scale.y),r=n,c=i},e.moveEnd=function(){e.moving=!1},e.$on("$destroy",function(){i(),o()})}]),angular.module("FlowDesigner").controller("itemCtrl",["$scope","types","status",function(e,t,n){e.$status=n,e.$types=t,e.width=250,e.height=170,e.dragging=!1;var r,i=0;e.dragStart=function(e){r=e.clientX,i=e.clientY,e.stopPropagation()},e.drag=function(t){e.dragging=!0;var n=t.clientX,o=t.clientY;e.data.Position.X+=(n-r)*(1/e.designer.getScale().x),e.data.Position.Y+=(o-i)*(1/e.designer.getScale().y),r=n,i=o,t.stopPropagation()},e.dragEnd=function(){e.dragging=!1},e.onItemClick=function(){e.designer.selectItem(e.data)}}]).directive("designerItem",["types","status","pathService",function(e,t,n){return{restrict:"AE",require:"^designer",replace:!0,templateUrl:n.templatesBaseUrl+"item.tmpl.html",transclude:!0,scope:{data:"=",offsetX:"=",offsetY:"="},controller:"itemCtrl",link:function(e,n,r,i){e.data.Status=t.notrun,e.designer=i;var o=angular.element(n.children());n.replaceWith(o)}}}]).directive("itemTitle",[function(){return{restrict:"E",replace:!0,template:'<div class="font-m box-header" ng-transclude></div>',transclude:!0,link:function(){}}}]).directive("itemDescription",[function(){return{restrict:"AE",replace:!0,template:'<div class="font-xs" ng-transclude></div>',transclude:!0,link:function(){}}}]);var scripts=document.getElementsByTagName("script"),currentScriptPath=scripts[scripts.length-1].src,rootPath=currentScriptPath.split("js/")[0];angular.module("FlowDesigner").service("pathService",[function(){return{templatesBaseUrl:rootPath+"templates/"}}]),angular.module("Svg.Directive",[]).directive("ngWidth",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngWidth,function(e){t.attr("width",e)})}}}]).directive("ngHeight",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngHeight,function(e){t.attr("height",e)})}}}]).directive("ngX",["$compile",function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.ngX,function(e){t.attr("x",e)})}}}]).directive("ngY",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY,function(e){t.attr("y",e)})}}}]).directive("ngCx",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCx,function(e){t.attr("cx",e)})}}}]).directive("ngCy",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCy,function(e){t.attr("cy",e)})}}}]).directive("ngX1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX1,function(e){t.attr("x1",e)})}}}]).directive("ngX2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX2,function(e){t.attr("x2",e)})}}}]).directive("ngY1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY1,function(e){t.attr("y1",e)})}}}]).directive("ngY2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY2,function(e){t.attr("y2",e)})}}}]).directive("autoSize",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t){$(window).resize(function(){e.$apply(function(){e.size={width:t.width(),height:t.height()}})})}}}]).directive("ngViewbox",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngViewbox,function(e){if(e){var n=e.x+" "+e.y+" "+e.width+" "+e.height;t[0].setAttribute("viewBox",n)}},!0)}}}]).directive("textEllipsis",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){var r=parseFloat(n.maxWidth),i=e.$eval(n.textEllipsis);if(t.text(i),t.width()>r)for(;t.width()>r;)i=i.substring(0,i.length-1),t.text(i.substring(0,i.length-1)+"...")}}}]),angular.module("Touch.Directive",[]).directive("tap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){var r;t.bind("mousedown",function(){r=new Date}),t.bind("mouseup",function(t){var i=new Date;200>=i-r&&e.$apply(function(){e.$eval(n.tap,{$event:t})})}),e.$on("$destroy",function(){t.unbind("mousedown"),t.unbind("mouseup")})}}}).directive("doubleTap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.hammer({taps:2}).bind("tap",function(t){2===t.gesture.tapCount&&e.$apply(function(){e.$eval(n.doubleTap,{$event:t})})}),e.$on("$destroy",function(){t.hammer().unbind("tap")})}}}).directive("pan",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.bind("mousedown",function(t){0===t.button&&e.$apply(function(){e.$eval(n.panBegin,{$event:t});var r=function(t){e.$apply(function(){e.$eval(n.pan,{$event:t})})};$(document).bind("mousemove",r);var i=function(t){e.$apply(function(){e.$eval(n.panRelease,{$event:t}),$(document).unbind("mousemove",r),$(document).unbind("mouseup",i)})};$(document).bind("mouseup",i)})}),e.$on("$destroy",function(){t.unbind("mousedown")})}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlc2lnbmVyRGlyZWN0aXZlLmpzIiwiY29tbW9uRGlyZWN0aXZlLmpzIiwiY29ubmVjdG9yQ3RybC5qcyIsImNvbm5lY3RvckRpcmVjdGl2ZS5qcyIsImRlc2lnbmVyQ3RybC5qcyIsIml0ZW1EaXJlY3RpdmUuanMiLCJyZXNvdXJjZVBhdGhTZXJ2aWNlLmpzIiwic3ZnRGlyZWN0aXZlLmpzIiwidG91Y2hEaXJlY3RpdmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsUUFBQSxPQUFBLGdCQUFBLGdCQUFBLGtCQUFBLHFCQUNBLFNBQUEsU0FDQSxLQUFBLE9BQ0EsS0FBQSxPQUNBLE1BQUEsV0FFQSxTQUFBLFVBQ0EsT0FBQSxTQUNBLFFBQUEsVUFDQSxPQUFBLFNBQ0EsVUFBQSxjQUVBLFNBQUEsYUFDQSxNQUFBLFFBQ0EsT0FBQSxXQUVBLFVBQUEsWUFBQSxXQUFBLGNBQUEsU0FBQSxFQUFBLEdBQ0EsT0FDQSxTQUFBLEtBQ0EsWUFBQSxFQUNBLFNBQUEsRUFDQSxZQUFBLEVBQUEsaUJBQUEscUJBQ0EsT0FDQSxTQUFBLElBQ0EsTUFBQSxJQUNBLGdCQUFBLEtBRUEsV0FBQSxlQUNBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxNQUNBLE1BQUEsRUFBQSxRQUNBLE9BQUEsRUFBQSxVQUVBLEVBQUEsUUFDQSxFQUFBLEVBQUEsU0FBQSxLQUNBLEVBQUEsRUFBQSxTQUFBLFVDbkNBLFFBQUEsT0FBQSx1QkFDQSxVQUFBLGdCQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsUUFBQSxXQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsV0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsY0FBQSxNQUFBLGFDVkEsUUFBQSxPQUFBLGdCQUNBLFdBQUEsaUJBQUEsU0FBQSxRQUFBLFlBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFdBQUEsRUFDQSxFQUFBLGFBQUEsS0FDQSxFQUFBLGtCQUFBLEtBQ0EsRUFBQSxhQUFBLFdBQ0EsTUFBQSxHQUFBLFNBQUEsWUFBQSxFQUFBLE1BQ0EsT0FBQSxFQUFBLFNBQUEsVUFFQSxPQUFBLEVBQUEsU0FBQSxZQUFBLElBQUEsRUFBQSxTQUFBLFdBQUEsUUFHQSxFQUFBLFNBQUEsV0FDQSxPQUNBLE9BQUEsRUFBQSxTQUFBLG9CQUFBLEVBQUEsT0FDQSxLQUFBLEVBQUEsU0FBQSxvQkFBQSxFQUFBLEtBQ0EsT0FBQSxFQUFBLFNBQUEsb0JBQUEsRUFBQSxJQUNBLGFBQUEsRUFBQSxnQkFBQSxFQUFBLFNBQUEsT0FBQSxLQUFBLEVBQUEsU0FBQSxTQUlBLEVBQUEsZ0JBQUEsU0FBQSxHQUNBLEVBQUEsa0JBQUEsR0FLQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxRQUFBLEVBQUEsU0FDQSxFQUFBLG1CQUVBLEVBQUEsVUFBQSxTQUFBLEdBQ0EsRUFBQSxFQUFBLFFBQUEsRUFBQSxTQUNBLEVBQUEsbUJBRUEsRUFBQSxRQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxhQUFBLGdCQUNBLEVBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxhQUFBLHFCQUNBLEtBQUEsSUFBQSxFQUVBLFlBREEsRUFBQSxhQUFBLEtBR0EsSUFBQSxHQUFBLEVBQUEsU0FBQSxRQUFBLEdBQ0EsRUFBQSxFQUFBLFNBQUEsWUFBQSxFQUFBLEVBQ0EsT0FBQSxHQUFBLFlBQUEsRUFBQSxTQUFBLFdBQUEsSUFBQSxFQUFBLFNBQUEsUUFDQSxFQUFBLGFBQUEsT0FHQSxFQUFBLEVBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxhQUFBLFNBQ0EsR0FBQSxtQkFPQSxJQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFlBQUEsRUFBQSxPQUNBLEVBQUEsV0FDQSxPQUFBLEVBQUEsR0FDQSxtQkFBQSxFQUFBLGNBRUEsRUFBQSxXQUFBLE1BQ0EsT0FBQSxFQUFBLFNBQUEsR0FDQSxtQkFBQSxFQUFBLFNBQUEsaUJBSUEsRUFBQSxXQUNBLE9BQUEsRUFBQSxTQUFBLEdBQ0EsbUJBQUEsRUFBQSxTQUFBLGNBRUEsRUFBQSxXQUFBLE1BQ0EsT0FBQSxFQUFBLEdBQ0EsbUJBQUEsRUFBQSxpQkFJQSxFQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsY0FDQSxHQUFBLEVBQUEsRUFBQSxTQUFBLFlBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQUEsRUFBQSxTQUFBLGFBQUEsRUFBQSxFQUNBLEdBQUEsRUFBQSxFQUFBLFNBQUEsWUFBQSxJQUFBLEVBQUEsRUFBQSxTQUFBLFdBQUEsR0FBQSxFQUFBLFNBQUEsYUFBQSxFQUFBLEdBUUEsR0FBQSxJQUFBLFdBQUEsaUJDMUZBLFFBQUEsT0FBQSxnQkFDQSxVQUFBLGFBQUEsUUFBQSxZQUFBLGNBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxPQUNBLFNBQUEsS0FDQSxTQUFBLEVBQ0EsUUFBQSxZQUNBLFlBQUEsRUFBQSxpQkFBQSxzQkFDQSxXQUFBLGdCQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsSUFDQSxNQUFBLElBQ0EsT0FBQSxLQUVBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsU0FBQSxFQUlBLEVBQUEsU0FBQSxrQkFBQSxXQUNBLEdBQUEsR0FBQSxFQUFBLFNBQUEsWUFBQSxFQUFBLE1BQUEsRUFBQSxTQUFBLGdCQUFBLEVBQUEsU0FBQSxnQkFDQSxRQUNBLEVBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxTQUFBLEVBQUEsRUFBQSxTQUFBLFNBQUEsRUFBQSxJQUNBLEVBQUEsRUFBQSxTQUFBLFNBQUEsRUFBQSxFQUFBLFFBQUEsSUFBQSxFQUFBLFNBQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxNQUFBLEtBR0EsRUFBQSxTQUFBLGdCQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLFNBQUEsUUFBQSxHQUNBLEVBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxFQUNBLElBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxNQUFBLENBQ0EsR0FBQSxPQUFBLEVBQUEsU0FBQSxVQUNBLE1BRUEsR0FBQSxTQUFBLFVBQUEsU0FFQSxDQUNBLEdBQUEsSUFBQSxFQUFBLFNBQUEsV0FBQSxPQUNBLE1BRUEsTUFBQSxFQUFBLFNBQUEsWUFBQSxPQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsU0FBQSxHQUFBLEVBQUEscUJBQUEsSUFHQSxFQUFBLGdCQUFBLEVBQUEsU0FBQSxHQUFBLEVBQUEsU0FBQSxjQU9BLElBQUEsR0FBQSxRQUFBLFFBQUEsRUFBQSxXQUNBLEdBQUEsWUFBQSxRQ25EQSxRQUFBLE9BQUEsZ0JBQ0EsV0FBQSxnQkFBQSxTQUFBLFlBQUEsU0FBQSxHQTZHQSxRQUFBLEtBQ0EsRUFBQSxRQUFBLE1BQUEsRUFBQSxLQUFBLE1BQUEsRUFBQSxNQUFBLEVBQ0EsRUFBQSxRQUFBLE9BQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxNQUFBLEVBOUdBLEdBQUEsR0FBQSxJQUVBLEdBQUEsTUFDQSxNQUFBLEVBQ0EsT0FBQSxHQUVBLEVBQUEsT0FDQSxFQUFBLEVBQ0EsRUFBQSxHQUVBLEVBQUEsU0FDQSxFQUFBLEVBQ0EsRUFBQSxFQUNBLE1BQUEsRUFDQSxPQUFBLEdBRUEsRUFBQSxRQUFBLEVBSUEsS0FBQSxTQUFBLFdBQ0EsTUFBQSxHQUFBLE9BR0EsS0FBQSxVQUFBLFdBQ0EsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBR0EsS0FBQSxXQUFBLFdBQ0EsTUFBQSxHQUFBLFNBR0EsS0FBQSxRQUFBLFNBQUEsR0FDQSxNQUFBLE1BQUEsRUFBQSxPQUFBLE1BQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxLQUFBLEtBSUEsS0FBQSxZQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxLQUFBLEVBQUEsaUJBQUEsZUFBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLGVBQUEsR0FFQSxPQUFBLEdBQ0EsRUFHQSxLQUFBLEVBQUEsa0JBQUEsZUFBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLGVBQUEsS0FJQSxLQUFBLHNCQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxRQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsWUFBQSxFQUFBLEVBQUEsbUJBRUEsT0FBQSxJQU9BLEtBQUEsV0FBQSxTQUFBLEdBQ0EsS0FBQSxFQUFBLE9BQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxVQUFBLElBRUEsRUFBQSxVQUFBLEVBQ0EsRUFBQSxpQkFBQSxLQUFBLEtBSUEsS0FBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLEVBQUEsaUJBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxXQUNBLEVBQUEsZ0JBQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxVQUFBLHNCQUlBLEtBQUEsRUFBQSxrQkFBQSxRQUFBLFNBQUEsR0FDQSxLQUFBLEVBQUEsWUFBQSxRQUFBLFNBQUEsR0FDQSxFQUFBLGdCQUFBLEVBQUEsT0FBQSxFQUFBLHdCQUlBLEtBQUEsRUFBQSxPQUFBLE9BQUEsSUFPQSxFQUFBLGFBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUVBLElBQUEsS0FBQSxFQUFBLE9BQUEsQ0FDQSxHQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsR0FBQSxFQUFBLE1BQUEsRUFBQSxHQUFBLEVBQ0EsTUFFQSxHQUFBLE1BQUEsR0FBQSxFQUNBLEVBQUEsTUFBQSxHQUFBLEVBRUEsSUFBQSxFQUFBLFNBQ0EsRUFBQSxNQUFBLEdBQUEsRUFDQSxFQUFBLE1BQUEsR0FBQSxHQUVBLEVBQUEsaUJBUUEsSUFPQSxHQVBBLEVBQUEsRUFBQSxPQUFBLE9BQUEsR0FBQSxHQUNBLEVBQUEsRUFBQSxPQUFBLFFBQUEsR0FBQSxHQU1BLEVBQUEsQ0FDQSxHQUFBLFVBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxRQUNBLEVBQUEsRUFBQSxRQUNBLEVBQUEsUUFBQSxHQUdBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsT0FDQSxHQUFBLFFBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLE1BQUEsR0FDQSxFQUFBLFFBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLE1BQUEsR0FDQSxFQUFBLEVBQ0EsRUFBQSxHQUdBLEVBQUEsUUFBQSxXQUNBLEVBQUEsUUFBQSxHQU9BLEVBQUEsSUFBQSxXQUFBLFdBQ0EsSUFDQSxTQ3BKQSxRQUFBLE9BQUEsZ0JBQ0EsV0FBQSxZQUFBLFNBQUEsUUFBQSxTQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxRQUFBLEVBQ0EsRUFBQSxPQUFBLEVBQ0EsRUFBQSxNQUFBLElBQ0EsRUFBQSxPQUFBLElBQ0EsRUFBQSxVQUFBLENBQ0EsSUFBQSxHQUFBLEVBQUEsQ0FDQSxHQUFBLFVBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxRQUNBLEVBQUEsRUFBQSxRQUNBLEVBQUEsbUJBRUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLFVBQUEsQ0FDQSxJQUFBLEdBQUEsRUFBQSxRQUNBLEVBQUEsRUFBQSxPQUNBLEdBQUEsS0FBQSxTQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxTQUFBLFdBQUEsR0FDQSxFQUFBLEtBQUEsU0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQ0EsRUFBQSxFQUNBLEVBQUEsRUFDQSxFQUFBLG1CQUVBLEVBQUEsUUFBQSxXQUNBLEVBQUEsVUFBQSxHQUdBLEVBQUEsWUFBQSxXQUNBLEVBQUEsU0FBQSxXQUFBLEVBQUEsVUFHQSxVQUFBLGdCQUFBLFFBQUEsU0FBQSxjQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsT0FDQSxTQUFBLEtBQ0EsUUFBQSxZQUNBLFNBQUEsRUFDQSxZQUFBLEVBQUEsaUJBQUEsaUJBQ0EsWUFBQSxFQUNBLE9BQ0EsS0FBQSxJQUNBLFFBQUEsSUFDQSxRQUFBLEtBRUEsV0FBQSxXQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsS0FBQSxPQUFBLEVBQUEsT0FDQSxFQUFBLFNBQUEsQ0FHQSxJQUFBLEdBQUEsUUFBQSxRQUFBLEVBQUEsV0FDQSxHQUFBLFlBQUEsUUFJQSxVQUFBLGFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsU0FBQSxzREFDQSxZQUFBLEVBQ0EsS0FBQSxpQkFJQSxVQUFBLG1CQUFBLFdBQ0EsT0FDQSxTQUFBLEtBQ0EsU0FBQSxFQUNBLFNBQUEsNENBQ0EsWUFBQSxFQUNBLEtBQUEsZ0JDdEVBLElBQUEsU0FBQSxTQUFBLHFCQUFBLFVBQ0Esa0JBQUEsUUFBQSxRQUFBLE9BQUEsR0FBQSxJQUNBLFNBQUEsa0JBQUEsTUFBQSxPQUFBLEVBRUEsU0FBQSxPQUFBLGdCQUNBLFFBQUEsZUFBQSxXQUNBLE9BQ0EsaUJBQUEsU0FBQSxpQkNQQSxRQUFBLE9BQUEsb0JBQ0EsVUFBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLFFBQUEsVUFLQSxVQUFBLFlBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxTQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsU0FBQSxVQUtBLFVBQUEsT0FBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLElBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxJQUFBLFVBS0EsVUFBQSxPQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsSUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLElBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFlBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxRQUFBLE9BQUEsV0FDQSxFQUFBLE9BQUEsV0FDQSxFQUFBLE1BQ0EsTUFBQSxFQUFBLFFBQ0EsT0FBQSxFQUFBLG1CQU9BLFVBQUEsYUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLFVBQUEsU0FBQSxHQUNBLEdBQUEsRUFBQSxDQUdBLEdBQUEsR0FBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLE1BQUEsSUFBQSxFQUFBLE1BQ0EsR0FBQSxHQUFBLGFBQUEsVUFBQSxNQUNBLFFBSUEsVUFBQSxnQkFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxXQUFBLEVBQUEsVUFDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLGFBRUEsSUFEQSxFQUFBLEtBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxLQUFBLEVBQUEsUUFBQSxHQUNBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxPQUFBLEdBQ0EsRUFBQSxLQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUEsT0FBQSxHQUFBLFlDcEtBLFFBQUEsT0FBQSxzQkFDQSxVQUFBLE1BQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsRUFDQSxHQUFBLEtBQUEsWUFBQSxXQUNBLEVBQUEsR0FBQSxRQUdBLEVBQUEsS0FBQSxVQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsR0FBQSxLQUNBLE1BQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLEtBQUEsT0FBQSxRQU9BLEVBQUEsSUFBQSxXQUFBLFdBQ0EsRUFBQSxPQUFBLGFBQ0EsRUFBQSxPQUFBLGlCQUlBLFVBQUEsWUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxRQUNBLEtBQUEsSUFDQSxLQUFBLE1BQUEsU0FBQSxHQUNBLElBQUEsRUFBQSxRQUFBLFVBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsV0FBQSxPQUFBLFFBT0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLFNBQUEsT0FBQSxhQUlBLFVBQUEsTUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLFlBQUEsU0FBQSxHQUNBLElBQUEsRUFBQSxRQUdBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLFVBQUEsT0FBQSxHQUNBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsS0FBQSxPQUFBLE1BR0EsR0FBQSxVQUFBLEtBQUEsWUFBQSxFQUNBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsWUFBQSxPQUFBLElBQ0EsRUFBQSxVQUFBLE9BQUEsWUFBQSxHQUNBLEVBQUEsVUFBQSxPQUFBLFVBQUEsS0FHQSxHQUFBLFVBQUEsS0FBQSxVQUFBLE9BS0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLE9BQUEiLCJmaWxlIjoiZmxvd0Rlc2lnbmVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA4LzUvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInLCBbJ1N2Zy5EaXJlY3RpdmUnLCAnVG91Y2guRGlyZWN0aXZlJywgJ0NvbW1vbi5EaXJlY3RpdmUnXSlcclxuICAgIC5jb25zdGFudChcInR5cGVzXCIsIHtcclxuICAgICAgICB0ZXh0OiAnVGV4dCcsXHJcbiAgICAgICAgYm9vbDogJ0Jvb2wnLFxyXG4gICAgICAgIGludDogJ051bWJlcidcclxuICAgIH0pXHJcbiAgICAuY29uc3RhbnQoXCJzdGF0dXNcIiwge1xyXG4gICAgICAgIG5vdHJ1bjogJ25vdHJ1bicsXHJcbiAgICAgICAgcnVubmluZzogJ3J1bm5pbmcnLFxyXG4gICAgICAgIGZhaWxlZDogJ2ZhaWxlZCcsXHJcbiAgICAgICAgc3VjY2VlZGVkOiAnc3VjY2VlZGVkJ1xyXG4gICAgfSlcclxuICAgIC5jb25zdGFudChcImRpcmVjdGlvblwiLCB7XHJcbiAgICAgICAgaW5wdXQ6ICdpbnB1dCcsXHJcbiAgICAgICAgb3V0cHV0OiAnb3V0cHV0J1xyXG4gICAgfSlcclxuICAgIC5kaXJlY3RpdmUoJ2Rlc2lnbmVyJywgW1wiJHRpbWVvdXRcIiwgXCJwYXRoU2VydmljZVwiLCBmdW5jdGlvbiAoJHRpbWVvdXQsICRwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRwYXRoLnRlbXBsYXRlc0Jhc2VVcmwgKyAnZGVzaWduZXIudG1wbC5odG1sJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGF1dG9TaXplOiAnPScsXHJcbiAgICAgICAgICAgICAgICBpdGVtczogJz0nLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDaGFuZ2VkOiAnJidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Rlc2lnbmVyQ3RybCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogZWxlbWVudC53aWR0aCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogZWxlbWVudC5oZWlnaHQoKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5vZmZzZXQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogZWxlbWVudC5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IGVsZW1lbnQub2Zmc2V0KCkudG9wXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNQ0cgb24gMjAxNC4wOS4wOS4uXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnQ29tbW9uLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdNb3VzZXdoZWVsJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICc/bmdNb2RlbCcsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQubW91c2V3aGVlbChmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLm5nTW91c2V3aGVlbCwge2V2ZW50OiBldmVudH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA5LzkvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInKVxyXG4gICAgLmNvbnRyb2xsZXIoXCJjb25uZWN0b3JDdHJsXCIsIFsnJHNjb3BlJywgJ3R5cGVzJywgJ2RpcmVjdGlvbicsIGZ1bmN0aW9uICgkc2NvcGUsICR0eXBlcywgJGRpcmVjdGlvbikge1xyXG4gICAgICAgICRzY29wZS4kZGlyZWN0aW9uID0gJGRpcmVjdGlvbjtcclxuICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICRzY29wZS5oYXNSZWZlcmVuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZSAhPT0gbnVsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcyAhPT0gbnVsbCAmJiAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcy5sZW5ndGggIT09IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5zZXRTdHlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHN0cmluZzogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5VmFsdWVUeXBlID09PSAkdHlwZXMuc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgYm9vbDogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5VmFsdWVUeXBlID09PSAkdHlwZXMuYm9vbCxcclxuICAgICAgICAgICAgICAgIG51bWJlcjogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5VmFsdWVUeXBlID09PSAkdHlwZXMuaW50LFxyXG4gICAgICAgICAgICAgICAgJ25vLXZhbHVlJzogISRzY29wZS5oYXNSZWZlcmVuY2UoKSAmJiAoISRzY29wZS5wcm9wZXJ0eS5WYWx1ZSB8fCAkc2NvcGUucHJvcGVydHkuVmFsdWUgPT09IFwiXCIpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbGVjdFJlZmVyZW5jZSA9IGZ1bmN0aW9uIChyZWZlcmVuY2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkUmVmZXJlbmNlID0gcmVmZXJlbmNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcmVnaW9uIERyYWdnaW5nIG5ldyByZWZlcmVuY2VcclxuXHJcbiAgICAgICAgJHNjb3BlLmRyYWcgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHNldE5ld1JlZmVyZW5jZVBvc2l0aW9uKCRldmVudC5jbGllbnRYLCAkZXZlbnQuY2xpZW50WSk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5kcmFnU3RhcnQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHNldE5ld1JlZmVyZW5jZVBvc2l0aW9uKCRldmVudC5jbGllbnRYLCAkZXZlbnQuY2xpZW50WSk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5kcmFnRW5kID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbUlkID0gJCgkZXZlbnQudGFyZ2V0KVswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaXRlbS1pZCcpO1xyXG4gICAgICAgICAgICB2YXIgcHJvcGVydHlOYW1lID0gJCgkZXZlbnQudGFyZ2V0KVswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvcGVydHktbmFtZScpO1xyXG4gICAgICAgICAgICBpZiAoIWl0ZW1JZCB8fCAhcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVmSXRlbSA9ICRzY29wZS5kZXNpZ25lci5nZXRJdGVtKGl0ZW1JZCk7XHJcbiAgICAgICAgICAgIHZhciByZWZQcm9wID0gJHNjb3BlLmRlc2lnbmVyLmdldFByb3BlcnR5KHJlZkl0ZW0sIHByb3BlcnR5TmFtZSk7XHJcbiAgICAgICAgICAgIGlmKHJlZlByb3AuRGlyZWN0aW9uID09PSAkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uIHx8IGl0ZW1JZCA9PT0gJHNjb3BlLml0ZW1EYXRhLklkKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uZXdSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFkZFJlZmVyZW5jZXMoJHNjb3BlLnByb3BlcnR5LCByZWZQcm9wLCByZWZJdGVtKTtcclxuICAgICAgICAgICAgJHNjb3BlLm5ld1JlZmVyZW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBEcmFnZ2luZyBuZXcgcmVmZXJlbmNlXHJcblxyXG4gICAgICAgIC8vcmVnaW9uIFByaXZhdGUgZnVuY3Rpb25zXHJcblxyXG4gICAgICAgIHZhciBhZGRSZWZlcmVuY2VzID0gZnVuY3Rpb24gKHNvdXJjZVByb3BlcnR5LCB0YXJnZXRQcm9wZXJ0eSwgdGFyZ2V0SXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoc291cmNlUHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2VQcm9wZXJ0eS5SZWZlcmVuY2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFza0lkOiB0YXJnZXRJdGVtLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogdGFyZ2V0UHJvcGVydHkuUHJvcGVydHlOYW1lXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJvcGVydHkuUmVmZXJlbmNlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBUYXNrSWQ6ICRzY29wZS5pdGVtRGF0YS5JZCxcclxuICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VkUHJvcGVydHk6ICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eU5hbWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0UHJvcGVydHkuUmVmZXJlbmNlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFRhc2tJZDogJHNjb3BlLml0ZW1EYXRhLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5TmFtZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHNvdXJjZVByb3BlcnR5LlJlZmVyZW5jZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFza0lkOiB0YXJnZXRJdGVtLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogdGFyZ2V0UHJvcGVydHkuUHJvcGVydHlOYW1lXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHNldE5ld1JlZmVyZW5jZVBvc2l0aW9uID0gZnVuY3Rpb24gKHgsIHkpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm5ld1JlZmVyZW5jZSA9IHtcclxuICAgICAgICAgICAgICAgIHg6ICh4IC0gJHNjb3BlLmRlc2lnbmVyLmdldE9mZnNldCgpLngpICogKDEgLyAkc2NvcGUuZGVzaWduZXIuZ2V0U2NhbGUoKS54KSArICRzY29wZS5kZXNpZ25lci5nZXRWaWV3Qm94KCkueCAtIDEsXHJcbiAgICAgICAgICAgICAgICB5OiAoeSAtICRzY29wZS5kZXNpZ25lci5nZXRPZmZzZXQoKS55KSAqICgxIC8gJHNjb3BlLmRlc2lnbmVyLmdldFNjYWxlKCkueSkgKyAkc2NvcGUuZGVzaWduZXIuZ2V0Vmlld0JveCgpLnkgLSAxXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gUHJpdmF0ZSBmdW5jdGlvbnNcclxuXHJcbiAgICAgICAgLy9cclxuICAgICAgICAvL0Rpc3Bvc2luZ1xyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pXHJcbjsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5kaXJlY3RpdmUoJ2Nvbm5lY3RvcicsIFsndHlwZXMnLCAnZGlyZWN0aW9uJywgJ3BhdGhTZXJ2aWNlJywgZnVuY3Rpb24gKCR0eXBlcywgJGRpcmVjdGlvbiwgJHBhdGgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdeZGVzaWduZXInLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJHBhdGgudGVtcGxhdGVzQmFzZVVybCArICdjb25uZWN0b3IudG1wbC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Nvbm5lY3RvckN0cmwnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgaXRlbURhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5OiAnPScsXHJcbiAgICAgICAgICAgICAgICBpbmRleDogJz0nLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMsIGRlc2lnbmVyQ3RybCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRlc2lnbmVyID0gZGVzaWduZXJDdHJsO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vcmVnaW9uIEFkZCBmdW5jdGlvbnMgdG8gcHJvcGVydHkgb2JqZWN0XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb3BlcnR5LmNhbGN1bGF0ZVBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9wcyA9ICRzY29wZS5wcm9wZXJ0eS5EaXJlY3Rpb24gPT09ICRkaXJlY3Rpb24uaW5wdXQgPyAkc2NvcGUuaXRlbURhdGEuSW5wdXRQcm9wZXJ0aWVzIDogJHNjb3BlLml0ZW1EYXRhLk91dHB1dFByb3BlcnRpZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0ID8gJHNjb3BlLml0ZW1EYXRhLlBvc2l0aW9uLlggOiAkc2NvcGUuaXRlbURhdGEuUG9zaXRpb24uWCArIDI1MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogJHNjb3BlLml0ZW1EYXRhLlBvc2l0aW9uLlkgKyAkc2NvcGUub2Zmc2V0ICsgKCgxNzAgLSAkc2NvcGUub2Zmc2V0KSAvIChwcm9wcy5sZW5ndGggKyAxKSkgKiAoJHNjb3BlLmluZGV4ICsgMSlcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9wZXJ0eS5yZW1vdmVSZWZlcmVuY2UgPSBmdW5jdGlvbiAoaXRlbUlkLCByZWZlcmVuY2VkUHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVmSXRlbSA9ICRzY29wZS5kZXNpZ25lci5nZXRJdGVtKGl0ZW1JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlZlByb3AgPSAkc2NvcGUuZGVzaWduZXIuZ2V0UHJvcGVydHkocmVmSXRlbSwgcmVmZXJlbmNlZFByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnByb3BlcnR5LkRpcmVjdGlvbiA9PT0gJGRpcmVjdGlvbi5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbnEoJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZXMpLnJlbW92ZShmdW5jdGlvbiAocmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVmLlRhc2tJZCA9PT0gaXRlbUlkICYmIHJlZi5SZWZlcmVuY2VkUHJvcGVydHkgPT09IHJlZmVyZW5jZWRQcm9wZXJ0eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJlZlByb3AucmVtb3ZlUmVmZXJlbmNlKCRzY29wZS5pdGVtRGF0YS5JZCwgJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5TmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vZW5kcmVnaW9uIEFkZCBmdW5jdGlvbnMgdG8gcHJvcGVydHkgb2JqZWN0XHJcblxyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vSXQgbmVlZHMgZm9yIGFuZ3VsYXIsIHJlbW92ZXMgc3ZnIHdyYXBwZXJcclxuICAgICAgICAgICAgICAgIHZhciBlID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQuY2hpbGRyZW4oKSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlcGxhY2VXaXRoKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5jb250cm9sbGVyKFwiZGVzaWduZXJDdHJsXCIsIFsnJHNjb3BlJywgJ2RpcmVjdGlvbicsIGZ1bmN0aW9uICgkc2NvcGUsICRkaXJlY3Rpb24pIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgICRzY29wZS5zaXplID0ge1xyXG4gICAgICAgICAgICB3aWR0aDogMCxcclxuICAgICAgICAgICAgaGVpZ2h0OiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuc2NhbGUgPSB7XHJcbiAgICAgICAgICAgIHg6IDEsXHJcbiAgICAgICAgICAgIHk6IDFcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS52aWV3Qm94ID0ge1xyXG4gICAgICAgICAgICB4OiAwLFxyXG4gICAgICAgICAgICB5OiAwLFxyXG4gICAgICAgICAgICB3aWR0aDogMCxcclxuICAgICAgICAgICAgaGVpZ2h0OiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUubW92aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8vcmVnaW9uIENvbnRyb2xsZXIgZnVuY3Rpb25zXHJcblxyXG4gICAgICAgIHRoaXMuZ2V0U2NhbGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc2NhbGU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRPZmZzZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHg6ICRzY29wZS5vZmZzZXQueCwgeTogJHNjb3BlLm9mZnNldC55fTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFZpZXdCb3ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUudmlld0JveDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldEl0ZW0gPSBmdW5jdGlvbiAoaXRlbUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsaW5xKCRzY29wZS5pdGVtcykuZmlyc3QoZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLklkID09PSBpdGVtSWQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0UHJvcGVydHkgPSBmdW5jdGlvbiAoaXRlbSwgcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9wID0gbGlucShpdGVtLklucHV0UHJvcGVydGllcykuZmlyc3RPckRlZmF1bHQoZnVuY3Rpb24gKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHkuUHJvcGVydHlOYW1lID09PSBwcm9wZXJ0eU5hbWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAocHJvcCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3A7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBsaW5xKGl0ZW0uT3V0cHV0UHJvcGVydGllcykuZmlyc3RPckRlZmF1bHQoZnVuY3Rpb24gKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHkuUHJvcGVydHlOYW1lID09PSBwcm9wZXJ0eU5hbWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0UmVmZXJlbmNlZFByb3BlcnR5ID0gZnVuY3Rpb24gKHJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuZ2V0SXRlbShyZWZlcmVuY2UuVGFza0lkKTtcclxuICAgICAgICAgICAgdmFyIHByb3AgPSBzZWxmLmdldFByb3BlcnR5KGl0ZW0sIHJlZmVyZW5jZS5SZWZlcmVuY2VkUHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHByb3A7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gQ29udHJvbGxlciBmdW5jdGlvbnNcclxuXHJcbiAgICAgICAgLy9yZWdpb24gRGVzaWduZXIgaXRlbSBoYW5kbGluZ1xyXG5cclxuICAgICAgICB0aGlzLnNlbGVjdEl0ZW0gPSBmdW5jdGlvbiAoc2VsZWN0ZWRJdGVtKSB7XHJcbiAgICAgICAgICAgIGxpbnEoJHNjb3BlLml0ZW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW0uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRDaGFuZ2VkKHtpdGVtOiBzZWxlY3RlZEl0ZW19KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgbGlucShpdGVtLklucHV0UHJvcGVydGllcykuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb3AuUmVmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcC5yZW1vdmVSZWZlcmVuY2UocHJvcC5SZWZlcmVuY2UuVGFza0lkLCBwcm9wLlJlZmVyZW5jZS5SZWZlcmVuY2VkUHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxpbnEoaXRlbS5PdXRwdXRQcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgICAgICAgICAgICBsaW5xKHByb3AuUmVmZXJlbmNlcykuZm9yRWFjaChmdW5jdGlvbiAocmVmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcC5yZW1vdmVSZWZlcmVuY2UocmVmZXJlbmNlLlRhc2tJZCwgcmVmZXJlbmNlLlJlZmVyZW5jZWRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsaW5xKCRzY29wZS5pdGVtcykucmVtb3ZlKGl0ZW0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIERlc2lnbmVyIGl0ZW0gaGFuZGxpbmdcclxuXHJcbiAgICAgICAgLy9yZWdpb24gWm9vbWluZ1xyXG5cclxuICAgICAgICAkc2NvcGUub25Nb3VzZVdoZWVsID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBzdGVwID0gMC4xO1xyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50LmRlbHRhWSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2NhbGUueCAtIHN0ZXAgPD0gMCB8fCAkc2NvcGUuc2NhbGUueSAtIHN0ZXAgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2FsZS54IC09IHN0ZXA7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NhbGUueSAtPSBzdGVwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChldmVudC5kZWx0YVkgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2FsZS54ICs9IHN0ZXA7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NhbGUueSArPSBzdGVwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3VwZGF0ZVZpZXdCb3hTaXplKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUudmlld0JveC53aWR0aCA9ICRzY29wZS5zaXplLndpZHRoIC8gJHNjb3BlLnNjYWxlLng7XHJcbiAgICAgICAgICAgICRzY29wZS52aWV3Qm94LmhlaWdodCA9ICRzY29wZS5zaXplLmhlaWdodCAvICRzY29wZS5zY2FsZS55O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHNpemVXYXRjaGVyID0gJHNjb3BlLiR3YXRjaCgnc2l6ZScsIF91cGRhdGVWaWV3Qm94U2l6ZSwgdHJ1ZSk7XHJcbiAgICAgICAgdmFyIHNjYWxlV2F0Y2hlciA9ICRzY29wZS4kd2F0Y2goJ3NjYWxlJywgX3VwZGF0ZVZpZXdCb3hTaXplLCB0cnVlKTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gWm9vbWluZ1xyXG5cclxuICAgICAgICAvLyByZWdpb24gVmlld2JveCBtb3ZpbmdcclxuXHJcbiAgICAgICAgdmFyIG1vdmVYLCBtb3ZlWSA9IDA7XHJcbiAgICAgICAgJHNjb3BlLm1vdmVTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgbW92ZVggPSAkZXZlbnQuY2xpZW50WDtcclxuICAgICAgICAgICAgbW92ZVkgPSAkZXZlbnQuY2xpZW50WTtcclxuICAgICAgICAgICAgJHNjb3BlLm1vdmluZyA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLm1vdmUgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIHZhciB5ID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS52aWV3Qm94LnggLT0gKHggLSBtb3ZlWCkgKiAoMSAvICRzY29wZS5zY2FsZS54KTtcclxuICAgICAgICAgICAgJHNjb3BlLnZpZXdCb3gueSAtPSAoeSAtIG1vdmVZKSAqICgxIC8gJHNjb3BlLnNjYWxlLnkpO1xyXG4gICAgICAgICAgICBtb3ZlWCA9IHg7XHJcbiAgICAgICAgICAgIG1vdmVZID0geTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUubW92ZUVuZCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1vdmluZyA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIFZpZXdib3ggbW92aW5nXHJcblxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy9EaXNwb3NpbmdcclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2l6ZVdhdGNoZXIoKTtcclxuICAgICAgICAgICAgc2NhbGVXYXRjaGVyKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSlcclxuOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA5LzkvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInKVxyXG4gICAgLmNvbnRyb2xsZXIoXCJpdGVtQ3RybFwiLCBbJyRzY29wZScsICd0eXBlcycsICdzdGF0dXMnLCBmdW5jdGlvbiAoJHNjb3BlLCAkdHlwZXMsICRzdGF0dXMpIHtcclxuICAgICAgICAkc2NvcGUuJHN0YXR1cyA9ICRzdGF0dXM7XHJcbiAgICAgICAgJHNjb3BlLiR0eXBlcyA9ICR0eXBlcztcclxuICAgICAgICAkc2NvcGUud2lkdGggPSAyNTA7XHJcbiAgICAgICAgJHNjb3BlLmhlaWdodCA9IDE3MDtcclxuICAgICAgICAkc2NvcGUuZHJhZ2dpbmcgPSBmYWxzZTtcclxuICAgICAgICB2YXIgZHJhZ1gsIGRyYWdZID0gMDtcclxuICAgICAgICAkc2NvcGUuZHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICBkcmFnWCA9ICRldmVudC5jbGllbnRYO1xyXG4gICAgICAgICAgICBkcmFnWSA9ICRldmVudC5jbGllbnRZO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuZHJhZyA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmRyYWdnaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdmFyIHggPSAkZXZlbnQuY2xpZW50WDtcclxuICAgICAgICAgICAgdmFyIHkgPSAkZXZlbnQuY2xpZW50WTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGEuUG9zaXRpb24uWCArPSAoeCAtIGRyYWdYKSAqICgxIC8gJHNjb3BlLmRlc2lnbmVyLmdldFNjYWxlKCkueCk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhLlBvc2l0aW9uLlkgKz0gKHkgLSBkcmFnWSkgKiAoMSAvICRzY29wZS5kZXNpZ25lci5nZXRTY2FsZSgpLnkpO1xyXG4gICAgICAgICAgICBkcmFnWCA9IHg7XHJcbiAgICAgICAgICAgIGRyYWdZID0geTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmRyYWdFbmQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5kcmFnZ2luZyA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5vbkl0ZW1DbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmRlc2lnbmVyLnNlbGVjdEl0ZW0oJHNjb3BlLmRhdGEpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2Rlc2lnbmVySXRlbScsIFsgJ3R5cGVzJywgJ3N0YXR1cycsICdwYXRoU2VydmljZScsIGZ1bmN0aW9uICgkdHlwZXMsICRzdGF0dXMsICRwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnXmRlc2lnbmVyJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRwYXRoLnRlbXBsYXRlc0Jhc2VVcmwgKyAnaXRlbS50bXBsLmh0bWwnLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0WDogJz0nLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0WTogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdpdGVtQ3RybCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBkZXNpZ25lckN0cmwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLlN0YXR1cyA9ICRzdGF0dXMubm90cnVuO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRlc2lnbmVyID0gZGVzaWduZXJDdHJsO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vSXQgbmVlZHMgZm9yIGFuZ3VsYXIsIHJlbW92ZXMgc3ZnIHdyYXBwZXJcclxuICAgICAgICAgICAgICAgIHZhciBlID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQuY2hpbGRyZW4oKSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlcGxhY2VXaXRoKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnaXRlbVRpdGxlJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIixcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwiZm9udC1tIGJveC1oZWFkZXJcIiBuZy10cmFuc2NsdWRlPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdpdGVtRGVzY3JpcHRpb24nLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwiZm9udC14c1wiIG5nLXRyYW5zY2x1ZGU+PC9kaXY+JyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSkiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gMTAvNi8yMDE0LlxyXG4gKi9cclxudmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcclxudmFyIGN1cnJlbnRTY3JpcHRQYXRoID0gc2NyaXB0c1tzY3JpcHRzLmxlbmd0aCAtIDFdLnNyYztcclxudmFyIHJvb3RQYXRoID0gY3VycmVudFNjcmlwdFBhdGguc3BsaXQoXCJqcy9cIilbMF07XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5zZXJ2aWNlKFwicGF0aFNlcnZpY2VcIiwgWyBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZXNCYXNlVXJsOiByb290UGF0aCArIFwidGVtcGxhdGVzL1wiXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC81LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnU3ZnLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdXaWR0aCcsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGF0dHJzLm5nV2lkdGgsIGZ1bmN0aW9uICh3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcIndpZHRoXCIsIHdpZHRoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdIZWlnaHQnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0hlaWdodCwgZnVuY3Rpb24gKGhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1gnLCBbJyRjb21waWxlJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gsIGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieFwiLCB4KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdZJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdZLCBmdW5jdGlvbiAoeSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInlcIiwgeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nQ3gnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0N4LCBmdW5jdGlvbiAoY3gpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJjeFwiLCBjeCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nQ3knLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0N5LCBmdW5jdGlvbiAoY3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJjeVwiLCBjeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWDEnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gxLCBmdW5jdGlvbiAoeDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ4MVwiLCB4MSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWDInLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gyLCBmdW5jdGlvbiAoeDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ4MlwiLCB4Mik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWTEnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1kxLCBmdW5jdGlvbiAoeTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5MVwiLCB5MSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWTInLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1kyLCBmdW5jdGlvbiAoeTIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5MlwiLCB5Mik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2F1dG9TaXplJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlbGVtZW50LndpZHRoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdWaWV3Ym94JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdWaWV3Ym94LCBmdW5jdGlvbiAodmlld2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmlld2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHZpZXdib3gueCArIFwiIFwiICsgdmlld2JveC55ICsgXCIgXCIgKyB2aWV3Ym94LndpZHRoICsgXCIgXCIgKyB2aWV3Ym94LmhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIiwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCd0ZXh0RWxsaXBzaXMnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gcGFyc2VGbG9hdChhdHRycy5tYXhXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkc2NvcGUuJGV2YWwoYXR0cnMudGV4dEVsbGlwc2lzKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC53aWR0aCgpID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZWxlbWVudC53aWR0aCgpID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSkgKyAnLi4uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC8xNS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ1RvdWNoLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgndGFwJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGltZVN0YW1wO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aW1lU3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdtb3VzZXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRlIC0gdGltZVN0YW1wIDw9IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy50YXAsIHsgJGV2ZW50OiBldmVudCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnbW91c2Vkb3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC51bmJpbmQoJ21vdXNldXAnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pLmRpcmVjdGl2ZSgnZG91YmxlVGFwJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmhhbW1lcih7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFwczogMlxyXG4gICAgICAgICAgICAgICAgfSkuYmluZCgndGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lmdlc3R1cmUudGFwQ291bnQgPT09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMuZG91YmxlVGFwLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0Rpc3Bvc2luZ1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5oYW1tZXIoKS51bmJpbmQoJ3RhcCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSkuZGlyZWN0aXZlKCdwYW4nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnbW91c2Vkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMucGFuQmVnaW4sIHsgJGV2ZW50OiBldmVudH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW91c2VNb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLnBhbiwgeyAkZXZlbnQ6IGV2ZW50IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNlbW92ZScsIG1vdXNlTW92ZUhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW91c2VVcEhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy5wYW5SZWxlYXNlLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZW1vdmUnLCBtb3VzZU1vdmVIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS51bmJpbmQoJ21vdXNldXAnLCBtb3VzZVVwSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkuYmluZCgnbW91c2V1cCcsIG1vdXNlVXBIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnbW91c2Vkb3duJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=