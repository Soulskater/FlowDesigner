angular.module("FlowDesigner",["Svg.Directive","Touch.Directive","Common.Directive"]).constant("types",{text:"Text",bool:"Bool","int":"Number"}).constant("status",{notrun:"notrun",running:"running",failed:"failed",succeeded:"succeeded"}).constant("direction",{input:"input",output:"output"}).directive("designer",["$timeout",function(){return{restrict:"AE",transclude:!1,replace:!0,templateUrl:"src/templates/designer.tmpl.html",scope:{autoSize:"=",items:"=",selectedChanged:"&"},controller:"designerCtrl",link:function(e,t){e.size={width:t.width(),height:t.height()},e.offset={x:t.offset().left,y:t.offset().top}}}}]),angular.module("Common.Directive",[]).directive("ngMousewheel",[function(){return{restrict:"A",require:"?ngModel",replace:!0,scope:!1,link:function(e,t,n){t.mousewheel(function(t){e.$apply(function(){e.$eval(n.ngMousewheel,{event:t})})})}}}]),angular.module("FlowDesigner").controller("connectorCtrl",["$scope","types","direction",function(e,t,n){e.$direction=n,e.newReference=null,e.selectedReference=null,e.hasReference=function(){return e.property.Direction===n.input?null!==e.property.Reference:0!==e.property.References.length},e.setStyle=function(){return{string:e.property.PropertyValueType===t.string,bool:e.property.PropertyValueType===t.bool,number:e.property.PropertyValueType===t.int,"no-value":!(e.hasReference()||e.property.Value&&""!==e.property.Value)}},e.selectReference=function(t){e.selectedReference=t},e.drag=function(e){i(e.clientX,e.clientY),e.stopPropagation()},e.dragStart=function(e){i(e.clientX,e.clientY),e.stopPropagation()},e.dragEnd=function(t){var n=$(t.target)[0].getAttribute("data-item-id"),i=$(t.target)[0].getAttribute("data-property-name");if(!n||!i)return void(e.newReference=null);var o=e.designer.getItem(n),c=e.designer.getProperty(o,i);return c.Direction===e.property.Direction||n===e.itemData.Id?void(e.newReference=null):(r(e.property,c,o),e.newReference=null,void t.stopPropagation())};var r=function(t,r,i){t.Direction===n.input?(t.Reference={TaskId:i.Id,ReferencedProperty:r.PropertyName},r.References.push({TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName})):(r.Reference={TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName},t.References.push({TaskId:i.Id,ReferencedProperty:r.PropertyName}))},i=function(t,n){e.newReference={x:(t-e.designer.getOffset().x)*(1/e.designer.getScale().x)+e.designer.getViewBox().x-1,y:(n-e.designer.getOffset().y)*(1/e.designer.getScale().y)+e.designer.getViewBox().y-1}};e.$on("$destroy",function(){})}]),angular.module("FlowDesigner").directive("connector",["types","direction",function(e,t){return{restrict:"AE",replace:!0,require:"^designer",templateUrl:"src/templates/connector.tmpl.html",controller:"connectorCtrl",scope:{itemData:"=",property:"=",index:"=",offset:"="},link:function(e,n,r,i){e.designer=i,e.property.calculatePosition=function(){var n=e.property.Direction===t.input?e.itemData.InputProperties:e.itemData.OutputProperties;return{x:e.property.Direction===t.input?e.itemData.Position.X:e.itemData.Position.X+250,y:e.itemData.Position.Y+e.offset+(170-e.offset)/(n.length+1)*(e.index+1)}},e.property.removeReference=function(n,r){var i=e.designer.getItem(n),o=e.designer.getProperty(i,r);if(e.property.Direction===t.input){if(null===e.property.Reference)return;e.property.Reference=null}else{if(0===e.property.References.length)return;linq(e.property.References).remove(function(e){return e.TaskId===n&&e.ReferencedProperty===r})}o.removeReference(e.itemData.Id,e.property.PropertyName)};var o=angular.element(n.children());n.replaceWith(o)}}}]),angular.module("FlowDesigner").controller("designerCtrl",["$scope","direction",function(e){function t(){e.viewBox.width=e.size.width/e.scale.x,e.viewBox.height=e.size.height/e.scale.y}var n=this;e.size={width:0,height:0},e.scale={x:1,y:1},e.viewBox={x:0,y:0,width:0,height:0},e.moving=!1,this.getScale=function(){return e.scale},this.getOffset=function(){return{x:e.offset.x,y:e.offset.y}},this.getViewBox=function(){return e.viewBox},this.getItem=function(t){return linq(e.items).first(function(e){return e.Id===t})},this.getProperty=function(e,t){var n=linq(e.InputProperties).firstOrDefault(function(e){return e.PropertyName===t});return n?n:linq(e.OutputProperties).firstOrDefault(function(e){return e.PropertyName===t})},this.getReferencedProperty=function(e){var t=n.getItem(e.TaskId),r=n.getProperty(t,e.ReferencedProperty);return r},this.selectItem=function(t){linq(e.items).forEach(function(e){e.selected=!1}),t.selected=!0,e.selectedChanged({item:t})},this.removeItem=function(t){linq(t.InputProperties).forEach(function(e){e.Reference&&e.removeReference(e.Reference.TaskId,e.Reference.ReferencedProperty)}),linq(t.OutputProperties).forEach(function(e){linq(e.References).forEach(function(t){e.removeReference(t.TaskId,t.ReferencedProperty)})}),linq(e.items).remove(t)},e.onMouseWheel=function(t){var n=.1;if(-1===t.deltaY){if(e.scale.x-n<=0||e.scale.y-n<=0)return;e.scale.x-=n,e.scale.y-=n}1===t.deltaY&&(e.scale.x+=n,e.scale.y+=n),t.preventDefault()};var r,i=e.$watch("size",t,!0),o=e.$watch("scale",t,!0),c=0;e.moveStart=function(t){r=t.clientX,c=t.clientY,e.moving=!0},e.move=function(t){var n=t.clientX,i=t.clientY;e.viewBox.x-=(n-r)*(1/e.scale.x),e.viewBox.y-=(i-c)*(1/e.scale.y),r=n,c=i},e.moveEnd=function(){e.moving=!1},e.$on("$destroy",function(){i(),o()})}]),angular.module("FlowDesigner").controller("itemCtrl",["$scope","types","status",function(e,t,n){e.$status=n,e.$types=t,e.width=250,e.height=170,e.dragging=!1;var r,i=0;e.dragStart=function(e){r=e.clientX,i=e.clientY,e.stopPropagation()},e.drag=function(t){e.dragging=!0;var n=t.clientX,o=t.clientY;e.data.Position.X+=(n-r)*(1/e.designer.getScale().x),e.data.Position.Y+=(o-i)*(1/e.designer.getScale().y),r=n,i=o,t.stopPropagation()},e.dragEnd=function(){e.dragging=!1},e.onItemClick=function(){e.designer.selectItem(e.data)}}]).directive("designerItem",["types","status",function(e,t){return{restrict:"AE",require:"^designer",replace:!0,templateUrl:"src/templates/item.tmpl.html",transclude:!0,scope:{data:"=",offsetX:"=",offsetY:"="},controller:"itemCtrl",link:function(e,n,r,i){e.data.Status=t.notrun,e.designer=i;var o=angular.element(n.children());n.replaceWith(o)}}}]).directive("itemTitle",[function(){return{restrict:"E",replace:!0,template:'<div class="font-m box-header" ng-transclude></div>',transclude:!0,link:function(){}}}]).directive("itemDescription",[function(){return{restrict:"AE",replace:!0,template:'<div class="font-xs" ng-transclude></div>',transclude:!0,link:function(){}}}]),angular.module("Svg.Directive",[]).directive("ngWidth",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngWidth,function(e){t.attr("width",e)})}}}]).directive("ngHeight",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngHeight,function(e){t.attr("height",e)})}}}]).directive("ngX",["$compile",function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.ngX,function(e){t.attr("x",e)})}}}]).directive("ngY",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY,function(e){t.attr("y",e)})}}}]).directive("ngCx",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCx,function(e){t.attr("cx",e)})}}}]).directive("ngCy",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCy,function(e){t.attr("cy",e)})}}}]).directive("ngX1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX1,function(e){t.attr("x1",e)})}}}]).directive("ngX2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX2,function(e){t.attr("x2",e)})}}}]).directive("ngY1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY1,function(e){t.attr("y1",e)})}}}]).directive("ngY2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY2,function(e){t.attr("y2",e)})}}}]).directive("autoSize",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t){$(window).resize(function(){e.$apply(function(){e.size={width:t.width(),height:t.height()}})})}}}]).directive("ngViewbox",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngViewbox,function(e){if(e){var n=e.x+" "+e.y+" "+e.width+" "+e.height;t[0].setAttribute("viewBox",n)}},!0)}}}]).directive("textEllipsis",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){var r=parseFloat(n.maxWidth),i=e.$eval(n.textEllipsis);if(t.text(i),t.width()>r)for(;t.width()>r;)i=i.substring(0,i.length-1),t.text(i.substring(0,i.length-1)+"...")}}}]),angular.module("Touch.Directive",[]).directive("tap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){var r;t.bind("mousedown",function(){r=new Date}),t.bind("mouseup",function(t){var i=new Date;200>=i-r&&e.$apply(function(){e.$eval(n.tap,{$event:t})})}),e.$on("$destroy",function(){t.unbind("mousedown"),t.unbind("mouseup")})}}}).directive("doubleTap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.hammer({taps:2}).bind("tap",function(t){2===t.gesture.tapCount&&e.$apply(function(){e.$eval(n.doubleTap,{$event:t})})}),e.$on("$destroy",function(){t.hammer().unbind("tap")})}}}).directive("pan",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.bind("mousedown",function(t){0===t.button&&e.$apply(function(){e.$eval(n.panBegin,{$event:t});var r=function(t){e.$apply(function(){e.$eval(n.pan,{$event:t})})};$(document).bind("mousemove",r);var i=function(t){e.$apply(function(){e.$eval(n.panRelease,{$event:t}),$(document).unbind("mousemove",r),$(document).unbind("mouseup",i)})};$(document).bind("mouseup",i)})}),e.$on("$destroy",function(){t.unbind("mousedown")})}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlc2lnbmVyRGlyZWN0aXZlLmpzIiwiY29tbW9uRGlyZWN0aXZlLmpzIiwiY29ubmVjdG9yQ3RybC5qcyIsImNvbm5lY3RvckRpcmVjdGl2ZS5qcyIsImRlc2lnbmVyQ3RybC5qcyIsIml0ZW1EaXJlY3RpdmUuanMiLCJzdmdEaXJlY3RpdmUuanMiLCJ0b3VjaERpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxRQUFBLE9BQUEsZ0JBQUEsZ0JBQUEsa0JBQUEscUJBQ0EsU0FBQSxTQUNBLEtBQUEsT0FDQSxLQUFBLE9BQ0EsTUFBQSxXQUVBLFNBQUEsVUFDQSxPQUFBLFNBQ0EsUUFBQSxVQUNBLE9BQUEsU0FDQSxVQUFBLGNBRUEsU0FBQSxhQUNBLE1BQUEsUUFDQSxPQUFBLFdBRUEsVUFBQSxZQUFBLFdBQUEsV0FDQSxPQUNBLFNBQUEsS0FDQSxZQUFBLEVBQ0EsU0FBQSxFQUNBLFlBQUEsbUNBQ0EsT0FDQSxTQUFBLElBQ0EsTUFBQSxJQUNBLGdCQUFBLEtBRUEsV0FBQSxlQUNBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxNQUNBLE1BQUEsRUFBQSxRQUNBLE9BQUEsRUFBQSxVQUVBLEVBQUEsUUFDQSxFQUFBLEVBQUEsU0FBQSxLQUNBLEVBQUEsRUFBQSxTQUFBLFVDbkNBLFFBQUEsT0FBQSx1QkFDQSxVQUFBLGdCQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsUUFBQSxXQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsV0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsY0FBQSxNQUFBLGFDVkEsUUFBQSxPQUFBLGdCQUNBLFdBQUEsaUJBQUEsU0FBQSxRQUFBLFlBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFdBQUEsRUFDQSxFQUFBLGFBQUEsS0FDQSxFQUFBLGtCQUFBLEtBQ0EsRUFBQSxhQUFBLFdBQ0EsTUFBQSxHQUFBLFNBQUEsWUFBQSxFQUFBLE1BQ0EsT0FBQSxFQUFBLFNBQUEsVUFFQSxJQUFBLEVBQUEsU0FBQSxXQUFBLFFBR0EsRUFBQSxTQUFBLFdBQ0EsT0FDQSxPQUFBLEVBQUEsU0FBQSxvQkFBQSxFQUFBLE9BQ0EsS0FBQSxFQUFBLFNBQUEsb0JBQUEsRUFBQSxLQUNBLE9BQUEsRUFBQSxTQUFBLG9CQUFBLEVBQUEsSUFDQSxhQUFBLEVBQUEsZ0JBQUEsRUFBQSxTQUFBLE9BQUEsS0FBQSxFQUFBLFNBQUEsU0FJQSxFQUFBLGdCQUFBLFNBQUEsR0FDQSxFQUFBLGtCQUFBLEdBS0EsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEVBQUEsUUFBQSxFQUFBLFNBQ0EsRUFBQSxtQkFFQSxFQUFBLFVBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxRQUFBLEVBQUEsU0FDQSxFQUFBLG1CQUVBLEVBQUEsUUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsYUFBQSxnQkFDQSxFQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsYUFBQSxxQkFDQSxLQUFBLElBQUEsRUFFQSxZQURBLEVBQUEsYUFBQSxLQUdBLElBQUEsR0FBQSxFQUFBLFNBQUEsUUFBQSxHQUNBLEVBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxFQUNBLE9BQUEsR0FBQSxZQUFBLEVBQUEsU0FBQSxXQUFBLElBQUEsRUFBQSxTQUFBLFFBQ0EsRUFBQSxhQUFBLE9BR0EsRUFBQSxFQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsYUFBQSxTQUNBLEdBQUEsbUJBT0EsSUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxZQUFBLEVBQUEsT0FDQSxFQUFBLFdBQ0EsT0FBQSxFQUFBLEdBQ0EsbUJBQUEsRUFBQSxjQUVBLEVBQUEsV0FBQSxNQUNBLE9BQUEsRUFBQSxTQUFBLEdBQ0EsbUJBQUEsRUFBQSxTQUFBLGlCQUlBLEVBQUEsV0FDQSxPQUFBLEVBQUEsU0FBQSxHQUNBLG1CQUFBLEVBQUEsU0FBQSxjQUVBLEVBQUEsV0FBQSxNQUNBLE9BQUEsRUFBQSxHQUNBLG1CQUFBLEVBQUEsaUJBSUEsRUFBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLGNBQ0EsR0FBQSxFQUFBLEVBQUEsU0FBQSxZQUFBLElBQUEsRUFBQSxFQUFBLFNBQUEsV0FBQSxHQUFBLEVBQUEsU0FBQSxhQUFBLEVBQUEsRUFDQSxHQUFBLEVBQUEsRUFBQSxTQUFBLFlBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQUEsRUFBQSxTQUFBLGFBQUEsRUFBQSxHQVFBLEdBQUEsSUFBQSxXQUFBLGlCQzFGQSxRQUFBLE9BQUEsZ0JBQ0EsVUFBQSxhQUFBLFFBQUEsWUFBQSxTQUFBLEVBQUEsR0FDQSxPQUNBLFNBQUEsS0FDQSxTQUFBLEVBQ0EsUUFBQSxZQUNBLFlBQUEsb0NBQ0EsV0FBQSxnQkFDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLElBQ0EsTUFBQSxJQUNBLE9BQUEsS0FFQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFNBQUEsRUFJQSxFQUFBLFNBQUEsa0JBQUEsV0FDQSxHQUFBLEdBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxnQkFBQSxFQUFBLFNBQUEsZ0JBQ0EsUUFDQSxFQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsTUFBQSxFQUFBLFNBQUEsU0FBQSxFQUFBLEVBQUEsU0FBQSxTQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsU0FBQSxTQUFBLEVBQUEsRUFBQSxRQUFBLElBQUEsRUFBQSxTQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsTUFBQSxLQUdBLEVBQUEsU0FBQSxnQkFBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxTQUFBLFFBQUEsR0FDQSxFQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsRUFDQSxJQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsTUFBQSxDQUNBLEdBQUEsT0FBQSxFQUFBLFNBQUEsVUFDQSxNQUVBLEdBQUEsU0FBQSxVQUFBLFNBRUEsQ0FDQSxHQUFBLElBQUEsRUFBQSxTQUFBLFdBQUEsT0FDQSxNQUVBLE1BQUEsRUFBQSxTQUFBLFlBQUEsT0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLFNBQUEsR0FBQSxFQUFBLHFCQUFBLElBR0EsRUFBQSxnQkFBQSxFQUFBLFNBQUEsR0FBQSxFQUFBLFNBQUEsY0FPQSxJQUFBLEdBQUEsUUFBQSxRQUFBLEVBQUEsV0FDQSxHQUFBLFlBQUEsUUNuREEsUUFBQSxPQUFBLGdCQUNBLFdBQUEsZ0JBQUEsU0FBQSxZQUFBLFNBQUEsR0E2R0EsUUFBQSxLQUNBLEVBQUEsUUFBQSxNQUFBLEVBQUEsS0FBQSxNQUFBLEVBQUEsTUFBQSxFQUNBLEVBQUEsUUFBQSxPQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsTUFBQSxFQTlHQSxHQUFBLEdBQUEsSUFFQSxHQUFBLE1BQ0EsTUFBQSxFQUNBLE9BQUEsR0FFQSxFQUFBLE9BQ0EsRUFBQSxFQUNBLEVBQUEsR0FFQSxFQUFBLFNBQ0EsRUFBQSxFQUNBLEVBQUEsRUFDQSxNQUFBLEVBQ0EsT0FBQSxHQUVBLEVBQUEsUUFBQSxFQUlBLEtBQUEsU0FBQSxXQUNBLE1BQUEsR0FBQSxPQUdBLEtBQUEsVUFBQSxXQUNBLE9BQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUdBLEtBQUEsV0FBQSxXQUNBLE1BQUEsR0FBQSxTQUdBLEtBQUEsUUFBQSxTQUFBLEdBQ0EsTUFBQSxNQUFBLEVBQUEsT0FBQSxNQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsS0FBQSxLQUlBLEtBQUEsWUFBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxFQUFBLGlCQUFBLGVBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxlQUFBLEdBRUEsT0FBQSxHQUNBLEVBR0EsS0FBQSxFQUFBLGtCQUFBLGVBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxlQUFBLEtBSUEsS0FBQSxzQkFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsUUFBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLFlBQUEsRUFBQSxFQUFBLG1CQUVBLE9BQUEsSUFPQSxLQUFBLFdBQUEsU0FBQSxHQUNBLEtBQUEsRUFBQSxPQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsVUFBQSxJQUVBLEVBQUEsVUFBQSxFQUNBLEVBQUEsaUJBQUEsS0FBQSxLQUlBLEtBQUEsV0FBQSxTQUFBLEdBQ0EsS0FBQSxFQUFBLGlCQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsV0FDQSxFQUFBLGdCQUFBLEVBQUEsVUFBQSxPQUFBLEVBQUEsVUFBQSxzQkFJQSxLQUFBLEVBQUEsa0JBQUEsUUFBQSxTQUFBLEdBQ0EsS0FBQSxFQUFBLFlBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxnQkFBQSxFQUFBLE9BQUEsRUFBQSx3QkFJQSxLQUFBLEVBQUEsT0FBQSxPQUFBLElBT0EsRUFBQSxhQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFFQSxJQUFBLEtBQUEsRUFBQSxPQUFBLENBQ0EsR0FBQSxFQUFBLE1BQUEsRUFBQSxHQUFBLEdBQUEsRUFBQSxNQUFBLEVBQUEsR0FBQSxFQUNBLE1BRUEsR0FBQSxNQUFBLEdBQUEsRUFDQSxFQUFBLE1BQUEsR0FBQSxFQUVBLElBQUEsRUFBQSxTQUNBLEVBQUEsTUFBQSxHQUFBLEVBQ0EsRUFBQSxNQUFBLEdBQUEsR0FFQSxFQUFBLGlCQVFBLElBT0EsR0FQQSxFQUFBLEVBQUEsT0FBQSxPQUFBLEdBQUEsR0FDQSxFQUFBLEVBQUEsT0FBQSxRQUFBLEdBQUEsR0FNQSxFQUFBLENBQ0EsR0FBQSxVQUFBLFNBQUEsR0FDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLFFBQUEsR0FHQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLE9BQ0EsR0FBQSxRQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxNQUFBLEdBQ0EsRUFBQSxRQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxNQUFBLEdBQ0EsRUFBQSxFQUNBLEVBQUEsR0FHQSxFQUFBLFFBQUEsV0FDQSxFQUFBLFFBQUEsR0FPQSxFQUFBLElBQUEsV0FBQSxXQUNBLElBQ0EsU0NwSkEsUUFBQSxPQUFBLGdCQUNBLFdBQUEsWUFBQSxTQUFBLFFBQUEsU0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsUUFBQSxFQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsTUFBQSxJQUNBLEVBQUEsT0FBQSxJQUNBLEVBQUEsVUFBQSxDQUNBLElBQUEsR0FBQSxFQUFBLENBQ0EsR0FBQSxVQUFBLFNBQUEsR0FDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLG1CQUVBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxVQUFBLENBQ0EsSUFBQSxHQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsT0FDQSxHQUFBLEtBQUEsU0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQ0EsRUFBQSxLQUFBLFNBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLFNBQUEsV0FBQSxHQUNBLEVBQUEsRUFDQSxFQUFBLEVBQ0EsRUFBQSxtQkFFQSxFQUFBLFFBQUEsV0FDQSxFQUFBLFVBQUEsR0FHQSxFQUFBLFlBQUEsV0FDQSxFQUFBLFNBQUEsV0FBQSxFQUFBLFVBR0EsVUFBQSxnQkFBQSxRQUFBLFNBQUEsU0FBQSxFQUFBLEdBQ0EsT0FDQSxTQUFBLEtBQ0EsUUFBQSxZQUNBLFNBQUEsRUFDQSxZQUFBLCtCQUNBLFlBQUEsRUFDQSxPQUNBLEtBQUEsSUFDQSxRQUFBLElBQ0EsUUFBQSxLQUVBLFdBQUEsV0FDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsT0FBQSxFQUFBLE9BQ0EsRUFBQSxTQUFBLENBR0EsSUFBQSxHQUFBLFFBQUEsUUFBQSxFQUFBLFdBQ0EsR0FBQSxZQUFBLFFBSUEsVUFBQSxhQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLFNBQUEsc0RBQ0EsWUFBQSxFQUNBLEtBQUEsaUJBSUEsVUFBQSxtQkFBQSxXQUNBLE9BQ0EsU0FBQSxLQUNBLFNBQUEsRUFDQSxTQUFBLDRDQUNBLFlBQUEsRUFDQSxLQUFBLGlCQ3RFQSxRQUFBLE9BQUEsb0JBQ0EsVUFBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLFFBQUEsVUFLQSxVQUFBLFlBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxTQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsU0FBQSxVQUtBLFVBQUEsT0FBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLElBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxJQUFBLFVBS0EsVUFBQSxPQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsSUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLElBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFlBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxRQUFBLE9BQUEsV0FDQSxFQUFBLE9BQUEsV0FDQSxFQUFBLE1BQ0EsTUFBQSxFQUFBLFFBQ0EsT0FBQSxFQUFBLG1CQU9BLFVBQUEsYUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLFVBQUEsU0FBQSxHQUNBLEdBQUEsRUFBQSxDQUdBLEdBQUEsR0FBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLE1BQUEsSUFBQSxFQUFBLE1BQ0EsR0FBQSxHQUFBLGFBQUEsVUFBQSxNQUNBLFFBSUEsVUFBQSxnQkFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxXQUFBLEVBQUEsVUFDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLGFBRUEsSUFEQSxFQUFBLEtBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxLQUFBLEVBQUEsUUFBQSxHQUNBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxPQUFBLEdBQ0EsRUFBQSxLQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUEsT0FBQSxHQUFBLFlDcEtBLFFBQUEsT0FBQSxzQkFDQSxVQUFBLE1BQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsRUFDQSxHQUFBLEtBQUEsWUFBQSxXQUNBLEVBQUEsR0FBQSxRQUdBLEVBQUEsS0FBQSxVQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsR0FBQSxLQUNBLE1BQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLEtBQUEsT0FBQSxRQU9BLEVBQUEsSUFBQSxXQUFBLFdBQ0EsRUFBQSxPQUFBLGFBQ0EsRUFBQSxPQUFBLGlCQUlBLFVBQUEsWUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxRQUNBLEtBQUEsSUFDQSxLQUFBLE1BQUEsU0FBQSxHQUNBLElBQUEsRUFBQSxRQUFBLFVBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsV0FBQSxPQUFBLFFBT0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLFNBQUEsT0FBQSxhQUlBLFVBQUEsTUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLFlBQUEsU0FBQSxHQUNBLElBQUEsRUFBQSxRQUdBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFBQSxFQUFBLFVBQUEsT0FBQSxHQUNBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsS0FBQSxPQUFBLE1BR0EsR0FBQSxVQUFBLEtBQUEsWUFBQSxFQUNBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsWUFBQSxPQUFBLElBQ0EsRUFBQSxVQUFBLE9BQUEsWUFBQSxHQUNBLEVBQUEsVUFBQSxPQUFBLFVBQUEsS0FHQSxHQUFBLFVBQUEsS0FBQSxVQUFBLE9BS0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLE9BQUEiLCJmaWxlIjoiZmxvd0Rlc2lnbmVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA4LzUvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInLCBbJ1N2Zy5EaXJlY3RpdmUnLCAnVG91Y2guRGlyZWN0aXZlJywgJ0NvbW1vbi5EaXJlY3RpdmUnXSlcclxuICAgIC5jb25zdGFudChcInR5cGVzXCIsIHtcclxuICAgICAgICB0ZXh0OiAnVGV4dCcsXHJcbiAgICAgICAgYm9vbDogJ0Jvb2wnLFxyXG4gICAgICAgIGludDogJ051bWJlcidcclxuICAgIH0pXHJcbiAgICAuY29uc3RhbnQoXCJzdGF0dXNcIiwge1xyXG4gICAgICAgIG5vdHJ1bjogJ25vdHJ1bicsXHJcbiAgICAgICAgcnVubmluZzogJ3J1bm5pbmcnLFxyXG4gICAgICAgIGZhaWxlZDogJ2ZhaWxlZCcsXHJcbiAgICAgICAgc3VjY2VlZGVkOiAnc3VjY2VlZGVkJ1xyXG4gICAgfSlcclxuICAgIC5jb25zdGFudChcImRpcmVjdGlvblwiLCB7XHJcbiAgICAgICAgaW5wdXQ6ICdpbnB1dCcsXHJcbiAgICAgICAgb3V0cHV0OiAnb3V0cHV0J1xyXG4gICAgfSlcclxuICAgIC5kaXJlY3RpdmUoJ2Rlc2lnbmVyJywgW1wiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKCR0aW1lb3V0KSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvdGVtcGxhdGVzL2Rlc2lnbmVyLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBhdXRvU2l6ZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6ICc9JyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ2hhbmdlZDogJyYnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkZXNpZ25lckN0cmwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNpemUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnQud2lkdGgoKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0KClcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub2Zmc2V0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IGVsZW1lbnQub2Zmc2V0KCkubGVmdCxcclxuICAgICAgICAgICAgICAgICAgICB5OiBlbGVtZW50Lm9mZnNldCgpLnRvcFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTUNHIG9uIDIwMTQuMDkuMDkuLlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0NvbW1vbi5EaXJlY3RpdmUnLCBbXSlcclxuICAgIC5kaXJlY3RpdmUoJ25nTW91c2V3aGVlbCcsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnP25nTW9kZWwnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm1vdXNld2hlZWwoZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy5uZ01vdXNld2hlZWwsIHtldmVudDogZXZlbnR9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5jb250cm9sbGVyKFwiY29ubmVjdG9yQ3RybFwiLCBbJyRzY29wZScsICd0eXBlcycsICdkaXJlY3Rpb24nLCBmdW5jdGlvbiAoJHNjb3BlLCAkdHlwZXMsICRkaXJlY3Rpb24pIHtcclxuICAgICAgICAkc2NvcGUuJGRpcmVjdGlvbiA9ICRkaXJlY3Rpb247XHJcbiAgICAgICAgJHNjb3BlLm5ld1JlZmVyZW5jZSA9IG51bGw7XHJcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkUmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAkc2NvcGUuaGFzUmVmZXJlbmNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnByb3BlcnR5LkRpcmVjdGlvbiA9PT0gJGRpcmVjdGlvbi5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2UgIT09IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZXMubGVuZ3RoICE9PSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuc2V0U3R5bGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmc6ICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eVZhbHVlVHlwZSA9PT0gJHR5cGVzLnN0cmluZyxcclxuICAgICAgICAgICAgICAgIGJvb2w6ICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eVZhbHVlVHlwZSA9PT0gJHR5cGVzLmJvb2wsXHJcbiAgICAgICAgICAgICAgICBudW1iZXI6ICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eVZhbHVlVHlwZSA9PT0gJHR5cGVzLmludCxcclxuICAgICAgICAgICAgICAgICduby12YWx1ZSc6ICEkc2NvcGUuaGFzUmVmZXJlbmNlKCkgJiYgKCEkc2NvcGUucHJvcGVydHkuVmFsdWUgfHwgJHNjb3BlLnByb3BlcnR5LlZhbHVlID09PSBcIlwiKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZWxlY3RSZWZlcmVuY2UgPSBmdW5jdGlvbiAocmVmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZFJlZmVyZW5jZSA9IHJlZmVyZW5jZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL3JlZ2lvbiBEcmFnZ2luZyBuZXcgcmVmZXJlbmNlXHJcblxyXG4gICAgICAgICRzY29wZS5kcmFnID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICBzZXROZXdSZWZlcmVuY2VQb3NpdGlvbigkZXZlbnQuY2xpZW50WCwgJGV2ZW50LmNsaWVudFkpO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuZHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICBzZXROZXdSZWZlcmVuY2VQb3NpdGlvbigkZXZlbnQuY2xpZW50WCwgJGV2ZW50LmNsaWVudFkpO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuZHJhZ0VuZCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1JZCA9ICQoJGV2ZW50LnRhcmdldClbMF0uZ2V0QXR0cmlidXRlKCdkYXRhLWl0ZW0taWQnKTtcclxuICAgICAgICAgICAgdmFyIHByb3BlcnR5TmFtZSA9ICQoJGV2ZW50LnRhcmdldClbMF0uZ2V0QXR0cmlidXRlKCdkYXRhLXByb3BlcnR5LW5hbWUnKTtcclxuICAgICAgICAgICAgaWYgKCFpdGVtSWQgfHwgIXByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5ld1JlZmVyZW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlZkl0ZW0gPSAkc2NvcGUuZGVzaWduZXIuZ2V0SXRlbShpdGVtSWQpO1xyXG4gICAgICAgICAgICB2YXIgcmVmUHJvcCA9ICRzY29wZS5kZXNpZ25lci5nZXRQcm9wZXJ0eShyZWZJdGVtLCBwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICAgICAgICBpZihyZWZQcm9wLkRpcmVjdGlvbiA9PT0gJHNjb3BlLnByb3BlcnR5LkRpcmVjdGlvbiB8fCBpdGVtSWQgPT09ICRzY29wZS5pdGVtRGF0YS5JZCl7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhZGRSZWZlcmVuY2VzKCRzY29wZS5wcm9wZXJ0eSwgcmVmUHJvcCwgcmVmSXRlbSk7XHJcbiAgICAgICAgICAgICRzY29wZS5uZXdSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gRHJhZ2dpbmcgbmV3IHJlZmVyZW5jZVxyXG5cclxuICAgICAgICAvL3JlZ2lvbiBQcml2YXRlIGZ1bmN0aW9uc1xyXG5cclxuICAgICAgICB2YXIgYWRkUmVmZXJlbmNlcyA9IGZ1bmN0aW9uIChzb3VyY2VQcm9wZXJ0eSwgdGFyZ2V0UHJvcGVydHksIHRhcmdldEl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKHNvdXJjZVByb3BlcnR5LkRpcmVjdGlvbiA9PT0gJGRpcmVjdGlvbi5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgc291cmNlUHJvcGVydHkuUmVmZXJlbmNlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFRhc2tJZDogdGFyZ2V0SXRlbS5JZCxcclxuICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VkUHJvcGVydHk6IHRhcmdldFByb3BlcnR5LlByb3BlcnR5TmFtZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHRhcmdldFByb3BlcnR5LlJlZmVyZW5jZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFza0lkOiAkc2NvcGUuaXRlbURhdGEuSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgUmVmZXJlbmNlZFByb3BlcnR5OiAkc2NvcGUucHJvcGVydHkuUHJvcGVydHlOYW1lXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldFByb3BlcnR5LlJlZmVyZW5jZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBUYXNrSWQ6ICRzY29wZS5pdGVtRGF0YS5JZCxcclxuICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VkUHJvcGVydHk6ICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eU5hbWVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBzb3VyY2VQcm9wZXJ0eS5SZWZlcmVuY2VzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIFRhc2tJZDogdGFyZ2V0SXRlbS5JZCxcclxuICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VkUHJvcGVydHk6IHRhcmdldFByb3BlcnR5LlByb3BlcnR5TmFtZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBzZXROZXdSZWZlcmVuY2VQb3NpdGlvbiA9IGZ1bmN0aW9uICh4LCB5KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5uZXdSZWZlcmVuY2UgPSB7XHJcbiAgICAgICAgICAgICAgICB4OiAoeCAtICRzY29wZS5kZXNpZ25lci5nZXRPZmZzZXQoKS54KSAqICgxIC8gJHNjb3BlLmRlc2lnbmVyLmdldFNjYWxlKCkueCkgKyAkc2NvcGUuZGVzaWduZXIuZ2V0Vmlld0JveCgpLnggLSAxLFxyXG4gICAgICAgICAgICAgICAgeTogKHkgLSAkc2NvcGUuZGVzaWduZXIuZ2V0T2Zmc2V0KCkueSkgKiAoMSAvICRzY29wZS5kZXNpZ25lci5nZXRTY2FsZSgpLnkpICsgJHNjb3BlLmRlc2lnbmVyLmdldFZpZXdCb3goKS55IC0gMVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIFByaXZhdGUgZnVuY3Rpb25zXHJcblxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy9EaXNwb3NpbmdcclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB9KTtcclxuICAgIH1dKVxyXG47IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDkvOS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0Zsb3dEZXNpZ25lcicpXHJcbiAgICAuZGlyZWN0aXZlKCdjb25uZWN0b3InLCBbJ3R5cGVzJywgJ2RpcmVjdGlvbicsIGZ1bmN0aW9uICgkdHlwZXMsICRkaXJlY3Rpb24pIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdeZGVzaWduZXInLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NyYy90ZW1wbGF0ZXMvY29ubmVjdG9yLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb25uZWN0b3JDdHJsJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGl0ZW1EYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogJz0nLFxyXG4gICAgICAgICAgICAgICAgaW5kZXg6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9mZnNldDogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBkZXNpZ25lckN0cmwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kZXNpZ25lciA9IGRlc2lnbmVyQ3RybDtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3JlZ2lvbiBBZGQgZnVuY3Rpb25zIHRvIHByb3BlcnR5IG9iamVjdFxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9wZXJ0eS5jYWxjdWxhdGVQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcHMgPSAkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0ID8gJHNjb3BlLml0ZW1EYXRhLklucHV0UHJvcGVydGllcyA6ICRzY29wZS5pdGVtRGF0YS5PdXRwdXRQcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogJHNjb3BlLnByb3BlcnR5LkRpcmVjdGlvbiA9PT0gJGRpcmVjdGlvbi5pbnB1dCA/ICRzY29wZS5pdGVtRGF0YS5Qb3NpdGlvbi5YIDogJHNjb3BlLml0ZW1EYXRhLlBvc2l0aW9uLlggKyAyNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6ICRzY29wZS5pdGVtRGF0YS5Qb3NpdGlvbi5ZICsgJHNjb3BlLm9mZnNldCArICgoMTcwIC0gJHNjb3BlLm9mZnNldCkgLyAocHJvcHMubGVuZ3RoICsgMSkpICogKCRzY29wZS5pbmRleCArIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvcGVydHkucmVtb3ZlUmVmZXJlbmNlID0gZnVuY3Rpb24gKGl0ZW1JZCwgcmVmZXJlbmNlZFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlZkl0ZW0gPSAkc2NvcGUuZGVzaWduZXIuZ2V0SXRlbShpdGVtSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZQcm9wID0gJHNjb3BlLmRlc2lnbmVyLmdldFByb3BlcnR5KHJlZkl0ZW0sIHJlZmVyZW5jZWRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wcm9wZXJ0eS5EaXJlY3Rpb24gPT09ICRkaXJlY3Rpb24uaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2UgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5xKCRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2VzKS5yZW1vdmUoZnVuY3Rpb24gKHJlZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZi5UYXNrSWQgPT09IGl0ZW1JZCAmJiByZWYuUmVmZXJlbmNlZFByb3BlcnR5ID09PSByZWZlcmVuY2VkUHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZWZQcm9wLnJlbW92ZVJlZmVyZW5jZSgkc2NvcGUuaXRlbURhdGEuSWQsICRzY29wZS5wcm9wZXJ0eS5Qcm9wZXJ0eU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2VuZHJlZ2lvbiBBZGQgZnVuY3Rpb25zIHRvIHByb3BlcnR5IG9iamVjdFxyXG5cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0l0IG5lZWRzIGZvciBhbmd1bGFyLCByZW1vdmVzIHN2ZyB3cmFwcGVyXHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50LmNoaWxkcmVuKCkpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZXBsYWNlV2l0aChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDkvOS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0Zsb3dEZXNpZ25lcicpXHJcbiAgICAuY29udHJvbGxlcihcImRlc2lnbmVyQ3RybFwiLCBbJyRzY29wZScsICdkaXJlY3Rpb24nLCBmdW5jdGlvbiAoJHNjb3BlLCAkZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnNjYWxlID0ge1xyXG4gICAgICAgICAgICB4OiAxLFxyXG4gICAgICAgICAgICB5OiAxXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUudmlld0JveCA9IHtcclxuICAgICAgICAgICAgeDogMCxcclxuICAgICAgICAgICAgeTogMCxcclxuICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLm1vdmluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAvL3JlZ2lvbiBDb250cm9sbGVyIGZ1bmN0aW9uc1xyXG5cclxuICAgICAgICB0aGlzLmdldFNjYWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNjYWxlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0T2Zmc2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4geyB4OiAkc2NvcGUub2Zmc2V0LngsIHk6ICRzY29wZS5vZmZzZXQueX07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRWaWV3Qm94ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnZpZXdCb3g7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRJdGVtID0gZnVuY3Rpb24gKGl0ZW1JZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbGlucSgkc2NvcGUuaXRlbXMpLmZpcnN0KGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5JZCA9PT0gaXRlbUlkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFByb3BlcnR5ID0gZnVuY3Rpb24gKGl0ZW0sIHByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvcCA9IGxpbnEoaXRlbS5JbnB1dFByb3BlcnRpZXMpLmZpcnN0T3JEZWZhdWx0KGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5LlByb3BlcnR5TmFtZSA9PT0gcHJvcGVydHlOYW1lO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHByb3ApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlucShpdGVtLk91dHB1dFByb3BlcnRpZXMpLmZpcnN0T3JEZWZhdWx0KGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5LlByb3BlcnR5TmFtZSA9PT0gcHJvcGVydHlOYW1lO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFJlZmVyZW5jZWRQcm9wZXJ0eSA9IGZ1bmN0aW9uIChyZWZlcmVuY2UpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLmdldEl0ZW0ocmVmZXJlbmNlLlRhc2tJZCk7XHJcbiAgICAgICAgICAgIHZhciBwcm9wID0gc2VsZi5nZXRQcm9wZXJ0eShpdGVtLCByZWZlcmVuY2UuUmVmZXJlbmNlZFByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwcm9wO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIENvbnRyb2xsZXIgZnVuY3Rpb25zXHJcblxyXG4gICAgICAgIC8vcmVnaW9uIERlc2lnbmVyIGl0ZW0gaGFuZGxpbmdcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RJdGVtID0gZnVuY3Rpb24gKHNlbGVjdGVkSXRlbSkge1xyXG4gICAgICAgICAgICBsaW5xKCRzY29wZS5pdGVtcykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkQ2hhbmdlZCh7aXRlbTogc2VsZWN0ZWRJdGVtfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGxpbnEoaXRlbS5JbnB1dFByb3BlcnRpZXMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9wLlJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3AucmVtb3ZlUmVmZXJlbmNlKHByb3AuUmVmZXJlbmNlLlRhc2tJZCwgcHJvcC5SZWZlcmVuY2UuUmVmZXJlbmNlZFByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsaW5xKGl0ZW0uT3V0cHV0UHJvcGVydGllcykuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgICAgICAgICAgICAgbGlucShwcm9wLlJlZmVyZW5jZXMpLmZvckVhY2goZnVuY3Rpb24gKHJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3AucmVtb3ZlUmVmZXJlbmNlKHJlZmVyZW5jZS5UYXNrSWQsIHJlZmVyZW5jZS5SZWZlcmVuY2VkUHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGlucSgkc2NvcGUuaXRlbXMpLnJlbW92ZShpdGVtKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBEZXNpZ25lciBpdGVtIGhhbmRsaW5nXHJcblxyXG4gICAgICAgIC8vcmVnaW9uIFpvb21pbmdcclxuXHJcbiAgICAgICAgJHNjb3BlLm9uTW91c2VXaGVlbCA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgc3RlcCA9IDAuMTtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudC5kZWx0YVkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNjYWxlLnggLSBzdGVwIDw9IDAgfHwgJHNjb3BlLnNjYWxlLnkgLSBzdGVwIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NhbGUueCAtPSBzdGVwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjYWxlLnkgLT0gc3RlcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGVsdGFZID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NhbGUueCArPSBzdGVwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjYWxlLnkgKz0gc3RlcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF91cGRhdGVWaWV3Qm94U2l6ZSgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnZpZXdCb3gud2lkdGggPSAkc2NvcGUuc2l6ZS53aWR0aCAvICRzY29wZS5zY2FsZS54O1xyXG4gICAgICAgICAgICAkc2NvcGUudmlld0JveC5oZWlnaHQgPSAkc2NvcGUuc2l6ZS5oZWlnaHQgLyAkc2NvcGUuc2NhbGUueTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzaXplV2F0Y2hlciA9ICRzY29wZS4kd2F0Y2goJ3NpemUnLCBfdXBkYXRlVmlld0JveFNpemUsIHRydWUpO1xyXG4gICAgICAgIHZhciBzY2FsZVdhdGNoZXIgPSAkc2NvcGUuJHdhdGNoKCdzY2FsZScsIF91cGRhdGVWaWV3Qm94U2l6ZSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIFpvb21pbmdcclxuXHJcbiAgICAgICAgLy8gcmVnaW9uIFZpZXdib3ggbW92aW5nXHJcblxyXG4gICAgICAgIHZhciBtb3ZlWCwgbW92ZVkgPSAwO1xyXG4gICAgICAgICRzY29wZS5tb3ZlU3RhcnQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIG1vdmVYID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIG1vdmVZID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS5tb3ZpbmcgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5tb3ZlID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgeCA9ICRldmVudC5jbGllbnRYO1xyXG4gICAgICAgICAgICB2YXIgeSA9ICRldmVudC5jbGllbnRZO1xyXG4gICAgICAgICAgICAkc2NvcGUudmlld0JveC54IC09ICh4IC0gbW92ZVgpICogKDEgLyAkc2NvcGUuc2NhbGUueCk7XHJcbiAgICAgICAgICAgICRzY29wZS52aWV3Qm94LnkgLT0gKHkgLSBtb3ZlWSkgKiAoMSAvICRzY29wZS5zY2FsZS55KTtcclxuICAgICAgICAgICAgbW92ZVggPSB4O1xyXG4gICAgICAgICAgICBtb3ZlWSA9IHk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLm1vdmVFbmQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tb3ZpbmcgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBWaWV3Ym94IG1vdmluZ1xyXG5cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNpemVXYXRjaGVyKCk7XHJcbiAgICAgICAgICAgIHNjYWxlV2F0Y2hlcigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pXHJcbjsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5jb250cm9sbGVyKFwiaXRlbUN0cmxcIiwgWyckc2NvcGUnLCAndHlwZXMnLCAnc3RhdHVzJywgZnVuY3Rpb24gKCRzY29wZSwgJHR5cGVzLCAkc3RhdHVzKSB7XHJcbiAgICAgICAgJHNjb3BlLiRzdGF0dXMgPSAkc3RhdHVzO1xyXG4gICAgICAgICRzY29wZS4kdHlwZXMgPSAkdHlwZXM7XHJcbiAgICAgICAgJHNjb3BlLndpZHRoID0gMjUwO1xyXG4gICAgICAgICRzY29wZS5oZWlnaHQgPSAxNzA7XHJcbiAgICAgICAgJHNjb3BlLmRyYWdnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGRyYWdYLCBkcmFnWSA9IDA7XHJcbiAgICAgICAgJHNjb3BlLmRyYWdTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgZHJhZ1ggPSAkZXZlbnQuY2xpZW50WDtcclxuICAgICAgICAgICAgZHJhZ1kgPSAkZXZlbnQuY2xpZW50WTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmRyYWcgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5kcmFnZ2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciB4ID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIHZhciB5ID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhLlBvc2l0aW9uLlggKz0gKHggLSBkcmFnWCkgKiAoMSAvICRzY29wZS5kZXNpZ25lci5nZXRTY2FsZSgpLngpO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0YS5Qb3NpdGlvbi5ZICs9ICh5IC0gZHJhZ1kpICogKDEgLyAkc2NvcGUuZGVzaWduZXIuZ2V0U2NhbGUoKS55KTtcclxuICAgICAgICAgICAgZHJhZ1ggPSB4O1xyXG4gICAgICAgICAgICBkcmFnWSA9IHk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5kcmFnRW5kID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZHJhZ2dpbmcgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUub25JdGVtQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5kZXNpZ25lci5zZWxlY3RJdGVtKCRzY29wZS5kYXRhKTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdkZXNpZ25lckl0ZW0nLCBbICd0eXBlcycsICdzdGF0dXMnLCBmdW5jdGlvbiAoJHR5cGVzLCAkc3RhdHVzKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnXmRlc2lnbmVyJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvdGVtcGxhdGVzL2l0ZW0udG1wbC5odG1sJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9mZnNldFg6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9mZnNldFk6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnaXRlbUN0cmwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycywgZGVzaWduZXJDdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5TdGF0dXMgPSAkc3RhdHVzLm5vdHJ1bjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kZXNpZ25lciA9IGRlc2lnbmVyQ3RybDtcclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0l0IG5lZWRzIGZvciBhbmd1bGFyLCByZW1vdmVzIHN2ZyB3cmFwcGVyXHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50LmNoaWxkcmVuKCkpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZXBsYWNlV2l0aChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2l0ZW1UaXRsZScsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCIsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cImZvbnQtbSBib3gtaGVhZGVyXCIgbmctdHJhbnNjbHVkZT48L2Rpdj4nLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnaXRlbURlc2NyaXB0aW9uJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cImZvbnQteHNcIiBuZy10cmFuc2NsdWRlPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDgvNS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ1N2Zy5EaXJlY3RpdmUnLCBbXSlcclxuICAgIC5kaXJlY3RpdmUoJ25nV2lkdGgnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1dpZHRoLCBmdW5jdGlvbiAod2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nSGVpZ2h0JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdIZWlnaHQsIGZ1bmN0aW9uIChoZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdYJywgWyckY29tcGlsZScsIGZ1bmN0aW9uICgkY29tcGlsZSkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdYLCBmdW5jdGlvbiAoeCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInhcIiwgeCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWScsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGF0dHJzLm5nWSwgZnVuY3Rpb24gKHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5XCIsIHkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ0N4JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdDeCwgZnVuY3Rpb24gKGN4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiY3hcIiwgY3gpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ0N5JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdDeSwgZnVuY3Rpb24gKGN5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiY3lcIiwgY3kpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1gxJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdYMSwgZnVuY3Rpb24gKHgxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieDFcIiwgeDEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1gyJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdYMiwgZnVuY3Rpb24gKHgyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieDJcIiwgeDIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1kxJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdZMSwgZnVuY3Rpb24gKHkxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieTFcIiwgeTEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1kyJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdZMiwgZnVuY3Rpb24gKHkyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieTJcIiwgeTIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdhdXRvU2l6ZScsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpemUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZWxlbWVudC53aWR0aCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nVmlld2JveCcsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGF0dHJzLm5nVmlld2JveCwgZnVuY3Rpb24gKHZpZXdib3gpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZpZXdib3gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB2aWV3Ym94LnggKyBcIiBcIiArIHZpZXdib3gueSArIFwiIFwiICsgdmlld2JveC53aWR0aCArIFwiIFwiICsgdmlld2JveC5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zZXRBdHRyaWJ1dGUoXCJ2aWV3Qm94XCIsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgndGV4dEVsbGlwc2lzJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXhXaWR0aCA9IHBhcnNlRmxvYXQoYXR0cnMubWF4V2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJHNjb3BlLiRldmFsKGF0dHJzLnRleHRFbGxpcHNpcyk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnRleHQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQud2lkdGgoKSA+IG1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGVsZW1lbnQud2lkdGgoKSA+IG1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyaW5nKDAsIHZhbHVlLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRleHQodmFsdWUuc3Vic3RyaW5nKDAsIHZhbHVlLmxlbmd0aCAtIDEpICsgJy4uLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDgvMTUvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdUb3VjaC5EaXJlY3RpdmUnLCBbXSlcclxuICAgIC5kaXJlY3RpdmUoJ3RhcCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRpbWVTdGFtcDtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnbW91c2Vkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGltZVN0YW1wID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnbW91c2V1cCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZSAtIHRpbWVTdGFtcCA8PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMudGFwLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0Rpc3Bvc2luZ1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC51bmJpbmQoJ21vdXNlZG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudW5iaW5kKCdtb3VzZXVwJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KS5kaXJlY3RpdmUoJ2RvdWJsZVRhcCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5oYW1tZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcHM6IDJcclxuICAgICAgICAgICAgICAgIH0pLmJpbmQoJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5nZXN0dXJlLnRhcENvdW50ID09PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLmRvdWJsZVRhcCwgeyAkZXZlbnQ6IGV2ZW50IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy9EaXNwb3NpbmdcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaGFtbWVyKCkudW5iaW5kKCd0YXAnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pLmRpcmVjdGl2ZSgncGFuJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5idXR0b24gIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLnBhbkJlZ2luLCB7ICRldmVudDogZXZlbnR9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdXNlTW92ZUhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy5wYW4sIHsgJGV2ZW50OiBldmVudCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5iaW5kKCdtb3VzZW1vdmUnLCBtb3VzZU1vdmVIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdXNlVXBIYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMucGFuUmVsZWFzZSwgeyAkZXZlbnQ6IGV2ZW50IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLnVuYmluZCgnbW91c2Vtb3ZlJywgbW91c2VNb3ZlSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZXVwJywgbW91c2VVcEhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNldXAnLCBtb3VzZVVwSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAvL0Rpc3Bvc2luZ1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC51bmJpbmQoJ21vdXNlZG93bicpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9