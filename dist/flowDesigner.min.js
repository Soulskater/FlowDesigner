angular.module("Common.Directive",[]).directive("ngMousewheel",[function(){return{restrict:"A",require:"?ngModel",replace:!0,scope:!1,link:function(e,t,n){t.mousewheel(function(t){e.$apply(function(){e.$eval(n.ngMousewheel,{event:t})})})}}}]),angular.module("FlowDesigner").controller("connectorCtrl",["$scope","types","direction",function(e,t,n){e.$direction=n,e.newReference=null,e.selectedReference=null,e.hasReference=function(){return e.property.Direction===n.input?null!==e.property.Reference:0!==e.property.References.length},e.setStyle=function(){return{string:e.property.PropertyValueType===t.string,bool:e.property.PropertyValueType===t.bool,number:e.property.PropertyValueType===t.int,"no-value":!(e.hasReference()||e.property.Value&&""!==e.property.Value)}},e.selectReference=function(t){e.selectedReference=t},e.drag=function(e){i(e.clientX,e.clientY),e.stopPropagation()},e.dragStart=function(e){i(e.clientX,e.clientY),e.stopPropagation()},e.dragEnd=function(t){var n=$(t.target)[0].getAttribute("data-item-id"),i=$(t.target)[0].getAttribute("data-property-name");if(!n||!i)return void(e.newReference=null);var o=e.designer.getItem(n),c=e.designer.getProperty(o,i);r(e.property,c,o),e.newReference=null,t.stopPropagation()};var r=function(t,r,i){t.Direction===n.input?(t.Reference={TaskId:i.Id,ReferencedProperty:r.PropertyName},r.References.push({TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName})):(r.Reference={TaskId:e.itemData.Id,ReferencedProperty:e.property.PropertyName},t.References.push({TaskId:i.Id,ReferencedProperty:r.PropertyName}))},i=function(t,n){e.newReference={x:(t-e.designer.getOffset().x)*(1/e.designer.getScale().x)+e.designer.getViewBox().x-1,y:(n-e.designer.getOffset().y)*(1/e.designer.getScale().y)+e.designer.getViewBox().y-1}};e.$on("$destroy",function(){})}]),angular.module("FlowDesigner").directive("connector",["types","direction",function(e,t){return{restrict:"AE",replace:!0,require:"^designer",templateUrl:"src/templates/connector.tmpl.html",controller:"connectorCtrl",scope:{itemData:"=",property:"=",index:"=",offset:"="},link:function(e,n,r,i){e.designer=i,e.property.calculatePosition=function(){var n=e.property.Direction===t.input?e.itemData.InputProperties:e.itemData.OutputProperties;return{x:e.property.Direction===t.input?e.itemData.Position.X:e.itemData.Position.X+250,y:e.itemData.Position.Y+e.offset+(170-e.offset)/(n.length+1)*(e.index+1)}},e.property.removeReference=function(n,r){var i=e.designer.getItem(n),o=e.designer.getProperty(i,r);if(e.property.Direction===t.input){if(null===e.property.Reference)return;e.property.Reference=null}else{if(0===e.property.References.length)return;linq(e.property.References).remove(function(e){return e.TaskId===n&&e.ReferencedProperty===r})}o.removeReference(e.itemData.Id,e.property.PropertyName)};var o=angular.element(n.children());n.replaceWith(o)}}}]),angular.module("FlowDesigner").controller("designerCtrl",["$scope","direction",function(e){function t(){e.viewBox.width=e.size.width/e.scale.x,e.viewBox.height=e.size.height/e.scale.y}var n=this;e.size={width:0,height:0},e.scale={x:1,y:1},e.viewBox={x:0,y:0,width:0,height:0},e.moving=!1,this.getScale=function(){return e.scale},this.getOffset=function(){return{x:e.offset.x,y:e.offset.y}},this.getViewBox=function(){return e.viewBox},this.getItem=function(t){return linq(e.items).first(function(e){return e.Id===t})},this.getProperty=function(e,t){var n=linq(e.InputProperties).firstOrDefault(function(e){return e.PropertyName===t});return n?n:linq(e.OutputProperties).firstOrDefault(function(e){return e.PropertyName===t})},this.getReferencedProperty=function(e){var t=n.getItem(e.TaskId),r=n.getProperty(t,e.ReferencedProperty);return r},this.selectItem=function(t){linq(e.items).forEach(function(e){e.selected=!1}),t.selected=!0,e.selectedChanged({item:t})},this.removeItem=function(t){linq(t.InputProperties).forEach(function(e){e.Reference&&e.removeReference(e.Reference.TaskId,e.Reference.ReferencedProperty)}),linq(t.OutputProperties).forEach(function(e){linq(e.References).forEach(function(t){e.removeReference(t.TaskId,t.ReferencedProperty)})}),linq(e.items).remove(t)},e.onMouseWheel=function(t){var n=.1;if(-1===t.deltaY){if(e.scale.x-n<=0||e.scale.y-n<=0)return;e.scale.x-=n,e.scale.y-=n}1===t.deltaY&&(e.scale.x+=n,e.scale.y+=n),t.preventDefault()};var r,i=e.$watch("size",t,!0),o=e.$watch("scale",t,!0),c=0;e.moveStart=function(t){r=t.clientX,c=t.clientY,e.moving=!0},e.move=function(t){var n=t.clientX,i=t.clientY;e.viewBox.x-=(n-r)*(1/e.scale.x),e.viewBox.y-=(i-c)*(1/e.scale.y),r=n,c=i},e.moveEnd=function(){e.moving=!1},e.$on("$destroy",function(){i(),o()})}]),angular.module("FlowDesigner",["Svg.Directive","Hammer.Directive","Common.Directive"]).constant("types",{text:"Text",bool:"Bool","int":"Number"}).constant("status",{notrun:"notrun",running:"running",failed:"failed",succeeded:"succeeded"}).constant("direction",{input:"input",output:"output"}).directive("designer",["$timeout",function(){return{restrict:"AE",transclude:!1,replace:!0,templateUrl:"src/templates/designer.tmpl.html",scope:{autoSize:"=",items:"=",selectedChanged:"&"},controller:"designerCtrl",link:function(e,t){e.size={width:t.width(),height:t.height()},e.offset={x:t.offset().left,y:t.offset().top}}}}]),angular.module("Hammer.Directive",[]).directive("tap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.hammer({}).bind("tap",function(t){e.$apply(function(){e.$eval(n.tap,{$event:t})})}),e.$on("$destroy",function(){t.hammer().unbind("tap")})}}}).directive("doubleTap",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.hammer({taps:2}).bind("tap",function(t){2===t.gesture.tapCount&&e.$apply(function(){e.$eval(n.doubleTap,{$event:t})})}),e.$on("$destroy",function(){t.hammer().unbind("tap")})}}}).directive("pan",function(){return{restrict:"A",replace:!0,link:function(e,t,n){t.bind("mousedown",function(t){0===t.button&&e.$apply(function(){e.$eval(n.panBegin,{$event:t}),$(document).bind("mousemove",function(t){e.$apply(function(){e.$eval(n.pan,{$event:t})})}),$(document).bind("mouseup",function(t){e.$apply(function(){e.$eval(n.panRelease,{$event:t}),$(document).unbind("mousemove"),$(document).unbind("mouseup")})})})}),e.$on("$destroy",function(){t.unbind("mousedown")})}}}),angular.module("FlowDesigner").controller("itemCtrl",["$scope","types","status",function(e,t,n){e.$status=n,e.$types=t,e.width=250,e.height=170;var r,i=0;e.dragStart=function(e){r=e.clientX,i=e.clientY,e.stopPropagation()},e.drag=function(t){var n=t.clientX,o=t.clientY;e.data.Position.X+=(n-r)*(1/e.designer.getScale().x),e.data.Position.Y+=(o-i)*(1/e.designer.getScale().y),r=n,i=o,t.stopPropagation()}}]).directive("designerItem",["types","status",function(e,t){return{restrict:"AE",require:"^designer",replace:!0,templateUrl:"src/templates/item.tmpl.html",transclude:!0,scope:{data:"=",offsetX:"=",offsetY:"="},controller:"itemCtrl",link:function(e,n,r,i){e.data.Status=t.notrun,e.designer=i;var o=angular.element(n.children());n.replaceWith(o)}}}]).directive("itemTitle",[function(){return{restrict:"E",replace:!0,template:'<div class="font-m box-header" ng-transclude></div>',transclude:!0,link:function(){}}}]).directive("itemDescription",[function(){return{restrict:"AE",replace:!0,template:'<div class="font-xs" ng-transclude></div>',transclude:!0,link:function(){}}}]),angular.module("Svg.Directive",[]).directive("ngWidth",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngWidth,function(e){t.attr("width",e)})}}}]).directive("ngHeight",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngHeight,function(e){t.attr("height",e)})}}}]).directive("ngX",["$compile",function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.ngX,function(e){t.attr("x",e)})}}}]).directive("ngY",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY,function(e){t.attr("y",e)})}}}]).directive("ngCx",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCx,function(e){t.attr("cx",e)})}}}]).directive("ngCy",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngCy,function(e){t.attr("cy",e)})}}}]).directive("ngX1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX1,function(e){t.attr("x1",e)})}}}]).directive("ngX2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngX2,function(e){t.attr("x2",e)})}}}]).directive("ngY1",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY1,function(e){t.attr("y1",e)})}}}]).directive("ngY2",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngY2,function(e){t.attr("y2",e)})}}}]).directive("autoSize",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t){$(window).resize(function(){e.$apply(function(){e.size={width:t.width(),height:t.height()}})})}}}]).directive("ngViewbox",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){e.$watch(n.ngViewbox,function(e){if(e){var n=e.x+" "+e.y+" "+e.width+" "+e.height;t[0].setAttribute("viewBox",n)}},!0)}}}]).directive("textEllipsis",[function(){return{restrict:"A",replace:!0,scope:!1,link:function(e,t,n){var r=parseFloat(n.maxWidth),i=e.$eval(n.textEllipsis);if(t.text(i),t.width()>r)for(;t.width()>r;)i=i.substring(0,i.length-1),t.text(i.substring(0,i.length-1)+"...")}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbkRpcmVjdGl2ZS5qcyIsImNvbm5lY3RvckN0cmwuanMiLCJjb25uZWN0b3JEaXJlY3RpdmUuanMiLCJkZXNpZ25lckN0cmwuanMiLCJkZXNpZ25lckRpcmVjdGl2ZS5qcyIsImhhbW1lckRpcmVjdGl2ZS5qcyIsIml0ZW1EaXJlY3RpdmUuanMiLCJzdmdEaXJlY3RpdmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsUUFBQSxPQUFBLHVCQUNBLFVBQUEsZ0JBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxRQUFBLFdBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxXQUFBLFNBQUEsR0FDQSxFQUFBLE9BQUEsV0FDQSxFQUFBLE1BQUEsRUFBQSxjQUFBLE1BQUEsYUNWQSxRQUFBLE9BQUEsZ0JBQ0EsV0FBQSxpQkFBQSxTQUFBLFFBQUEsWUFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsV0FBQSxFQUNBLEVBQUEsYUFBQSxLQUNBLEVBQUEsa0JBQUEsS0FDQSxFQUFBLGFBQUEsV0FDQSxNQUFBLEdBQUEsU0FBQSxZQUFBLEVBQUEsTUFDQSxPQUFBLEVBQUEsU0FBQSxVQUVBLElBQUEsRUFBQSxTQUFBLFdBQUEsUUFHQSxFQUFBLFNBQUEsV0FDQSxPQUNBLE9BQUEsRUFBQSxTQUFBLG9CQUFBLEVBQUEsT0FDQSxLQUFBLEVBQUEsU0FBQSxvQkFBQSxFQUFBLEtBQ0EsT0FBQSxFQUFBLFNBQUEsb0JBQUEsRUFBQSxJQUNBLGFBQUEsRUFBQSxnQkFBQSxFQUFBLFNBQUEsT0FBQSxLQUFBLEVBQUEsU0FBQSxTQUlBLEVBQUEsZ0JBQUEsU0FBQSxHQUNBLEVBQUEsa0JBQUEsR0FLQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxRQUFBLEVBQUEsU0FDQSxFQUFBLG1CQUVBLEVBQUEsVUFBQSxTQUFBLEdBQ0EsRUFBQSxFQUFBLFFBQUEsRUFBQSxTQUNBLEVBQUEsbUJBRUEsRUFBQSxRQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxhQUFBLGdCQUNBLEVBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxhQUFBLHFCQUNBLEtBQUEsSUFBQSxFQUVBLFlBREEsRUFBQSxhQUFBLEtBR0EsSUFBQSxHQUFBLEVBQUEsU0FBQSxRQUFBLEdBQ0EsRUFBQSxFQUFBLFNBQUEsWUFBQSxFQUFBLEVBQ0EsR0FBQSxFQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsYUFBQSxLQUNBLEVBQUEsa0JBT0EsSUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxZQUFBLEVBQUEsT0FDQSxFQUFBLFdBQ0EsT0FBQSxFQUFBLEdBQ0EsbUJBQUEsRUFBQSxjQUVBLEVBQUEsV0FBQSxNQUNBLE9BQUEsRUFBQSxTQUFBLEdBQ0EsbUJBQUEsRUFBQSxTQUFBLGlCQUlBLEVBQUEsV0FDQSxPQUFBLEVBQUEsU0FBQSxHQUNBLG1CQUFBLEVBQUEsU0FBQSxjQUVBLEVBQUEsV0FBQSxNQUNBLE9BQUEsRUFBQSxHQUNBLG1CQUFBLEVBQUEsaUJBSUEsRUFBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLGNBQ0EsR0FBQSxFQUFBLEVBQUEsU0FBQSxZQUFBLElBQUEsRUFBQSxFQUFBLFNBQUEsV0FBQSxHQUFBLEVBQUEsU0FBQSxhQUFBLEVBQUEsRUFDQSxHQUFBLEVBQUEsRUFBQSxTQUFBLFlBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQUEsRUFBQSxTQUFBLGFBQUEsRUFBQSxHQVFBLEdBQUEsSUFBQSxXQUFBLGlCQ3RGQSxRQUFBLE9BQUEsZ0JBQ0EsVUFBQSxhQUFBLFFBQUEsWUFBQSxTQUFBLEVBQUEsR0FDQSxPQUNBLFNBQUEsS0FDQSxTQUFBLEVBQ0EsUUFBQSxZQUNBLFlBQUEsb0NBQ0EsV0FBQSxnQkFDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLElBQ0EsTUFBQSxJQUNBLE9BQUEsS0FFQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFNBQUEsRUFJQSxFQUFBLFNBQUEsa0JBQUEsV0FDQSxHQUFBLEdBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxnQkFBQSxFQUFBLFNBQUEsZ0JBQ0EsUUFDQSxFQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsTUFBQSxFQUFBLFNBQUEsU0FBQSxFQUFBLEVBQUEsU0FBQSxTQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsU0FBQSxTQUFBLEVBQUEsRUFBQSxRQUFBLElBQUEsRUFBQSxTQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsTUFBQSxLQUdBLEVBQUEsU0FBQSxnQkFBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxTQUFBLFFBQUEsR0FDQSxFQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsRUFDQSxJQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsTUFBQSxDQUNBLEdBQUEsT0FBQSxFQUFBLFNBQUEsVUFDQSxNQUVBLEdBQUEsU0FBQSxVQUFBLFNBRUEsQ0FDQSxHQUFBLElBQUEsRUFBQSxTQUFBLFdBQUEsT0FDQSxNQUVBLE1BQUEsRUFBQSxTQUFBLFlBQUEsT0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLFNBQUEsR0FBQSxFQUFBLHFCQUFBLElBR0EsRUFBQSxnQkFBQSxFQUFBLFNBQUEsR0FBQSxFQUFBLFNBQUEsY0FPQSxJQUFBLEdBQUEsUUFBQSxRQUFBLEVBQUEsV0FDQSxHQUFBLFlBQUEsUUNuREEsUUFBQSxPQUFBLGdCQUNBLFdBQUEsZ0JBQUEsU0FBQSxZQUFBLFNBQUEsR0FnSEEsUUFBQSxLQUNBLEVBQUEsUUFBQSxNQUFBLEVBQUEsS0FBQSxNQUFBLEVBQUEsTUFBQSxFQUNBLEVBQUEsUUFBQSxPQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsTUFBQSxFQWpIQSxHQUFBLEdBQUEsSUFFQSxHQUFBLE1BQ0EsTUFBQSxFQUNBLE9BQUEsR0FFQSxFQUFBLE9BQ0EsRUFBQSxFQUNBLEVBQUEsR0FFQSxFQUFBLFNBQ0EsRUFBQSxFQUNBLEVBQUEsRUFDQSxNQUFBLEVBQ0EsT0FBQSxHQUVBLEVBQUEsUUFBQSxFQUlBLEtBQUEsU0FBQSxXQUNBLE1BQUEsR0FBQSxPQUdBLEtBQUEsVUFBQSxXQUNBLE9BQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUdBLEtBQUEsV0FBQSxXQUNBLE1BQUEsR0FBQSxTQUdBLEtBQUEsUUFBQSxTQUFBLEdBQ0EsTUFBQSxNQUFBLEVBQUEsT0FBQSxNQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsS0FBQSxLQUlBLEtBQUEsWUFBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsS0FBQSxFQUFBLGlCQUFBLGVBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxlQUFBLEdBRUEsT0FBQSxHQUNBLEVBR0EsS0FBQSxFQUFBLGtCQUFBLGVBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxlQUFBLEtBSUEsS0FBQSxzQkFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsUUFBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLFlBQUEsRUFBQSxFQUFBLG1CQUVBLE9BQUEsSUFPQSxLQUFBLFdBQUEsU0FBQSxHQUNBLEtBQUEsRUFBQSxPQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsVUFBQSxJQUVBLEVBQUEsVUFBQSxFQUNBLEVBQUEsaUJBQUEsS0FBQSxLQUlBLEtBQUEsV0FBQSxTQUFBLEdBQ0EsS0FBQSxFQUFBLGlCQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsV0FDQSxFQUFBLGdCQUFBLEVBQUEsVUFBQSxPQUFBLEVBQUEsVUFBQSxzQkFJQSxLQUFBLEVBQUEsa0JBQUEsUUFBQSxTQUFBLEdBQ0EsS0FBQSxFQUFBLFlBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxnQkFBQSxFQUFBLE9BQUEsRUFBQSx3QkFJQSxLQUFBLEVBQUEsT0FBQSxPQUFBLElBT0EsRUFBQSxhQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFFQSxJQUFBLEtBQUEsRUFBQSxPQUFBLENBQ0EsR0FBQSxFQUFBLE1BQUEsRUFBQSxHQUFBLEdBQUEsRUFBQSxNQUFBLEVBQUEsR0FBQSxFQUNBLE1BRUEsR0FBQSxNQUFBLEdBQUEsRUFDQSxFQUFBLE1BQUEsR0FBQSxFQUVBLElBQUEsRUFBQSxTQUNBLEVBQUEsTUFBQSxHQUFBLEVBQ0EsRUFBQSxNQUFBLEdBQUEsR0FLQSxFQUFBLGlCQVFBLElBT0EsR0FQQSxFQUFBLEVBQUEsT0FBQSxPQUFBLEdBQUEsR0FDQSxFQUFBLEVBQUEsT0FBQSxRQUFBLEdBQUEsR0FNQSxFQUFBLENBQ0EsR0FBQSxVQUFBLFNBQUEsR0FDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLFFBQUEsR0FHQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLE9BQ0EsR0FBQSxRQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxNQUFBLEdBQ0EsRUFBQSxRQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxNQUFBLEdBQ0EsRUFBQSxFQUNBLEVBQUEsR0FHQSxFQUFBLFFBQUEsV0FDQSxFQUFBLFFBQUEsR0FPQSxFQUFBLElBQUEsV0FBQSxXQUNBLElBQ0EsU0N2SkEsUUFBQSxPQUFBLGdCQUFBLGdCQUFBLG1CQUFBLHFCQUNBLFNBQUEsU0FDQSxLQUFBLE9BQ0EsS0FBQSxPQUNBLE1BQUEsV0FFQSxTQUFBLFVBQ0EsT0FBQSxTQUNBLFFBQUEsVUFDQSxPQUFBLFNBQ0EsVUFBQSxjQUVBLFNBQUEsYUFDQSxNQUFBLFFBQ0EsT0FBQSxXQUVBLFVBQUEsWUFBQSxXQUFBLFdBQ0EsT0FDQSxTQUFBLEtBQ0EsWUFBQSxFQUNBLFNBQUEsRUFDQSxZQUFBLG1DQUNBLE9BQ0EsU0FBQSxJQUNBLE1BQUEsSUFDQSxnQkFBQSxLQUVBLFdBQUEsZUFDQSxLQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsTUFDQSxNQUFBLEVBQUEsUUFDQSxPQUFBLEVBQUEsVUFFQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLFNBQUEsS0FDQSxFQUFBLEVBQUEsU0FBQSxVQ25DQSxRQUFBLE9BQUEsdUJBQ0EsVUFBQSxNQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFdBQ0EsS0FBQSxNQUFBLFNBQUEsR0FDQSxFQUFBLE9BQUEsV0FDQSxFQUFBLE1BQUEsRUFBQSxLQUFBLE9BQUEsUUFNQSxFQUFBLElBQUEsV0FBQSxXQUNBLEVBQUEsU0FBQSxPQUFBLGFBSUEsVUFBQSxZQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFFBQ0EsS0FBQSxJQUNBLEtBQUEsTUFBQSxTQUFBLEdBQ0EsSUFBQSxFQUFBLFFBQUEsVUFDQSxFQUFBLE9BQUEsV0FDQSxFQUFBLE1BQUEsRUFBQSxXQUFBLE9BQUEsUUFPQSxFQUFBLElBQUEsV0FBQSxXQUNBLEVBQUEsU0FBQSxPQUFBLGFBSUEsVUFBQSxNQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsWUFBQSxTQUFBLEdBQ0EsSUFBQSxFQUFBLFFBR0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsVUFBQSxPQUFBLElBQ0EsRUFBQSxVQUFBLEtBQUEsWUFBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsS0FBQSxPQUFBLFFBR0EsRUFBQSxVQUFBLEtBQUEsVUFBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLFdBQ0EsRUFBQSxNQUFBLEVBQUEsWUFBQSxPQUFBLElBQ0EsRUFBQSxVQUFBLE9BQUEsYUFDQSxFQUFBLFVBQUEsT0FBQSxtQkFPQSxFQUFBLElBQUEsV0FBQSxXQUNBLEVBQUEsT0FBQSxtQkN0RUEsUUFBQSxPQUFBLGdCQUNBLFdBQUEsWUFBQSxTQUFBLFFBQUEsU0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsUUFBQSxFQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsTUFBQSxJQUNBLEVBQUEsT0FBQSxHQUNBLElBQUEsR0FBQSxFQUFBLENBQ0EsR0FBQSxVQUFBLFNBQUEsR0FDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsUUFDQSxFQUFBLG1CQUVBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsT0FDQSxHQUFBLEtBQUEsU0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsU0FBQSxXQUFBLEdBQ0EsRUFBQSxLQUFBLFNBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLFNBQUEsV0FBQSxHQUNBLEVBQUEsRUFDQSxFQUFBLEVBQ0EsRUFBQSxzQkFHQSxVQUFBLGdCQUFBLFFBQUEsU0FBQSxTQUFBLEVBQUEsR0FDQSxPQUNBLFNBQUEsS0FDQSxRQUFBLFlBQ0EsU0FBQSxFQUNBLFlBQUEsK0JBQ0EsWUFBQSxFQUNBLE9BQ0EsS0FBQSxJQUNBLFFBQUEsSUFDQSxRQUFBLEtBRUEsV0FBQSxXQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsS0FBQSxPQUFBLEVBQUEsT0FDQSxFQUFBLFNBQUEsQ0FHQSxJQUFBLEdBQUEsUUFBQSxRQUFBLEVBQUEsV0FDQSxHQUFBLFlBQUEsUUFJQSxVQUFBLGFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsU0FBQSxzREFDQSxZQUFBLEVBQ0EsS0FBQSxpQkFJQSxVQUFBLG1CQUFBLFdBQ0EsT0FDQSxTQUFBLEtBQ0EsU0FBQSxFQUNBLFNBQUEsNENBQ0EsWUFBQSxFQUNBLEtBQUEsaUJDN0RBLFFBQUEsT0FBQSxvQkFDQSxVQUFBLFdBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxRQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsUUFBQSxVQUtBLFVBQUEsWUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLFNBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxTQUFBLFVBS0EsVUFBQSxPQUFBLFdBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsSUFBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLElBQUEsVUFLQSxVQUFBLE9BQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxJQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsSUFBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsUUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxLQUFBLFVBS0EsVUFBQSxRQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsVUFLQSxVQUFBLFFBQUEsV0FDQSxPQUNBLFNBQUEsSUFDQSxTQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLE9BQUEsRUFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxVQUtBLFVBQUEsWUFBQSxXQUNBLE9BQ0EsU0FBQSxJQUNBLFNBQUEsRUFDQSxPQUFBLEVBQ0EsS0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLFFBQUEsT0FBQSxXQUNBLEVBQUEsT0FBQSxXQUNBLEVBQUEsTUFDQSxNQUFBLEVBQUEsUUFDQSxPQUFBLEVBQUEsbUJBT0EsVUFBQSxhQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxPQUFBLEVBQUEsVUFBQSxTQUFBLEdBQ0EsR0FBQSxFQUFBLENBR0EsR0FBQSxHQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxJQUFBLEVBQUEsTUFDQSxHQUFBLEdBQUEsYUFBQSxVQUFBLE1BQ0EsUUFJQSxVQUFBLGdCQUFBLFdBQ0EsT0FDQSxTQUFBLElBQ0EsU0FBQSxFQUNBLE9BQUEsRUFDQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLFdBQUEsRUFBQSxVQUNBLEVBQUEsRUFBQSxNQUFBLEVBQUEsYUFFQSxJQURBLEVBQUEsS0FBQSxHQUNBLEVBQUEsUUFBQSxFQUNBLEtBQUEsRUFBQSxRQUFBLEdBQ0EsRUFBQSxFQUFBLFVBQUEsRUFBQSxFQUFBLE9BQUEsR0FDQSxFQUFBLEtBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxPQUFBLEdBQUEiLCJmaWxlIjoiZmxvd0Rlc2lnbmVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1DRyBvbiAyMDE0LjA5LjA5Li5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdDb21tb24uRGlyZWN0aXZlJywgW10pXHJcbiAgICAuZGlyZWN0aXZlKCduZ01vdXNld2hlZWwnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJz9uZ01vZGVsJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5tb3VzZXdoZWVsKGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMubmdNb3VzZXdoZWVsLCB7ZXZlbnQ6IGV2ZW50fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ21lc3phcm9zIG9uIDkvOS8yMDE0LlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ0Zsb3dEZXNpZ25lcicpXHJcbiAgICAuY29udHJvbGxlcihcImNvbm5lY3RvckN0cmxcIiwgWyckc2NvcGUnLCAndHlwZXMnLCAnZGlyZWN0aW9uJywgZnVuY3Rpb24gKCRzY29wZSwgJHR5cGVzLCAkZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgJHNjb3BlLiRkaXJlY3Rpb24gPSAkZGlyZWN0aW9uO1xyXG4gICAgICAgICRzY29wZS5uZXdSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICRzY29wZS5zZWxlY3RlZFJlZmVyZW5jZSA9IG51bGw7XHJcbiAgICAgICAgJHNjb3BlLmhhc1JlZmVyZW5jZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5wcm9wZXJ0eS5EaXJlY3Rpb24gPT09ICRkaXJlY3Rpb24uaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlICE9PSBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcm9wZXJ0eS5SZWZlcmVuY2VzLmxlbmd0aCAhPT0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnNldFN0eWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nOiAkc2NvcGUucHJvcGVydHkuUHJvcGVydHlWYWx1ZVR5cGUgPT09ICR0eXBlcy5zdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBib29sOiAkc2NvcGUucHJvcGVydHkuUHJvcGVydHlWYWx1ZVR5cGUgPT09ICR0eXBlcy5ib29sLFxyXG4gICAgICAgICAgICAgICAgbnVtYmVyOiAkc2NvcGUucHJvcGVydHkuUHJvcGVydHlWYWx1ZVR5cGUgPT09ICR0eXBlcy5pbnQsXHJcbiAgICAgICAgICAgICAgICAnbm8tdmFsdWUnOiAhJHNjb3BlLmhhc1JlZmVyZW5jZSgpICYmICghJHNjb3BlLnByb3BlcnR5LlZhbHVlIHx8ICRzY29wZS5wcm9wZXJ0eS5WYWx1ZSA9PT0gXCJcIilcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VsZWN0UmVmZXJlbmNlID0gZnVuY3Rpb24gKHJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRSZWZlcmVuY2UgPSByZWZlcmVuY2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9yZWdpb24gRHJhZ2dpbmcgbmV3IHJlZmVyZW5jZVxyXG5cclxuICAgICAgICAkc2NvcGUuZHJhZyA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgc2V0TmV3UmVmZXJlbmNlUG9zaXRpb24oJGV2ZW50LmNsaWVudFgsICRldmVudC5jbGllbnRZKTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmRyYWdTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgc2V0TmV3UmVmZXJlbmNlUG9zaXRpb24oJGV2ZW50LmNsaWVudFgsICRldmVudC5jbGllbnRZKTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmRyYWdFbmQgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtSWQgPSAkKCRldmVudC50YXJnZXQpWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS1pdGVtLWlkJyk7XHJcbiAgICAgICAgICAgIHZhciBwcm9wZXJ0eU5hbWUgPSAkKCRldmVudC50YXJnZXQpWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9wZXJ0eS1uYW1lJyk7XHJcbiAgICAgICAgICAgIGlmICghaXRlbUlkIHx8ICFwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uZXdSZWZlcmVuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZWZJdGVtID0gJHNjb3BlLmRlc2lnbmVyLmdldEl0ZW0oaXRlbUlkKTtcclxuICAgICAgICAgICAgdmFyIHJlZlByb3AgPSAkc2NvcGUuZGVzaWduZXIuZ2V0UHJvcGVydHkocmVmSXRlbSwgcHJvcGVydHlOYW1lKTtcclxuICAgICAgICAgICAgYWRkUmVmZXJlbmNlcygkc2NvcGUucHJvcGVydHksIHJlZlByb3AsIHJlZkl0ZW0pO1xyXG4gICAgICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIERyYWdnaW5nIG5ldyByZWZlcmVuY2VcclxuXHJcbiAgICAgICAgLy9yZWdpb24gUHJpdmF0ZSBmdW5jdGlvbnNcclxuXHJcbiAgICAgICAgdmFyIGFkZFJlZmVyZW5jZXMgPSBmdW5jdGlvbiAoc291cmNlUHJvcGVydHksIHRhcmdldFByb3BlcnR5LCB0YXJnZXRJdGVtKSB7XHJcbiAgICAgICAgICAgIGlmIChzb3VyY2VQcm9wZXJ0eS5EaXJlY3Rpb24gPT09ICRkaXJlY3Rpb24uaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZVByb3BlcnR5LlJlZmVyZW5jZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBUYXNrSWQ6IHRhcmdldEl0ZW0uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgUmVmZXJlbmNlZFByb3BlcnR5OiB0YXJnZXRQcm9wZXJ0eS5Qcm9wZXJ0eU5hbWVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRQcm9wZXJ0eS5SZWZlcmVuY2VzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIFRhc2tJZDogJHNjb3BlLml0ZW1EYXRhLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZWRQcm9wZXJ0eTogJHNjb3BlLnByb3BlcnR5LlByb3BlcnR5TmFtZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRQcm9wZXJ0eS5SZWZlcmVuY2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGFza0lkOiAkc2NvcGUuaXRlbURhdGEuSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgUmVmZXJlbmNlZFByb3BlcnR5OiAkc2NvcGUucHJvcGVydHkuUHJvcGVydHlOYW1lXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc291cmNlUHJvcGVydHkuUmVmZXJlbmNlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBUYXNrSWQ6IHRhcmdldEl0ZW0uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgUmVmZXJlbmNlZFByb3BlcnR5OiB0YXJnZXRQcm9wZXJ0eS5Qcm9wZXJ0eU5hbWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgc2V0TmV3UmVmZXJlbmNlUG9zaXRpb24gPSBmdW5jdGlvbiAoeCwgeSkge1xyXG4gICAgICAgICAgICAkc2NvcGUubmV3UmVmZXJlbmNlID0ge1xyXG4gICAgICAgICAgICAgICAgeDogKHggLSAkc2NvcGUuZGVzaWduZXIuZ2V0T2Zmc2V0KCkueCkgKiAoMSAvICRzY29wZS5kZXNpZ25lci5nZXRTY2FsZSgpLngpICsgJHNjb3BlLmRlc2lnbmVyLmdldFZpZXdCb3goKS54IC0gMSxcclxuICAgICAgICAgICAgICAgIHk6ICh5IC0gJHNjb3BlLmRlc2lnbmVyLmdldE9mZnNldCgpLnkpICogKDEgLyAkc2NvcGUuZGVzaWduZXIuZ2V0U2NhbGUoKS55KSArICRzY29wZS5kZXNpZ25lci5nZXRWaWV3Qm94KCkueSAtIDFcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBQcml2YXRlIGZ1bmN0aW9uc1xyXG5cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSlcclxuOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA5LzkvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInKVxyXG4gICAgLmRpcmVjdGl2ZSgnY29ubmVjdG9yJywgWyd0eXBlcycsICdkaXJlY3Rpb24nLCBmdW5jdGlvbiAoJHR5cGVzLCAkZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBRVwiLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnXmRlc2lnbmVyJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvdGVtcGxhdGVzL2Nvbm5lY3Rvci50bXBsLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY29ubmVjdG9yQ3RybCcsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtRGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHk6ICc9JyxcclxuICAgICAgICAgICAgICAgIGluZGV4OiAnPScsXHJcbiAgICAgICAgICAgICAgICBvZmZzZXQ6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycywgZGVzaWduZXJDdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVzaWduZXIgPSBkZXNpZ25lckN0cmw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9yZWdpb24gQWRkIGZ1bmN0aW9ucyB0byBwcm9wZXJ0eSBvYmplY3RcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvcGVydHkuY2FsY3VsYXRlUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3BzID0gJHNjb3BlLnByb3BlcnR5LkRpcmVjdGlvbiA9PT0gJGRpcmVjdGlvbi5pbnB1dCA/ICRzY29wZS5pdGVtRGF0YS5JbnB1dFByb3BlcnRpZXMgOiAkc2NvcGUuaXRlbURhdGEuT3V0cHV0UHJvcGVydGllcztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6ICRzY29wZS5wcm9wZXJ0eS5EaXJlY3Rpb24gPT09ICRkaXJlY3Rpb24uaW5wdXQgPyAkc2NvcGUuaXRlbURhdGEuUG9zaXRpb24uWCA6ICRzY29wZS5pdGVtRGF0YS5Qb3NpdGlvbi5YICsgMjUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAkc2NvcGUuaXRlbURhdGEuUG9zaXRpb24uWSArICRzY29wZS5vZmZzZXQgKyAoKDE3MCAtICRzY29wZS5vZmZzZXQpIC8gKHByb3BzLmxlbmd0aCArIDEpKSAqICgkc2NvcGUuaW5kZXggKyAxKVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb3BlcnR5LnJlbW92ZVJlZmVyZW5jZSA9IGZ1bmN0aW9uIChpdGVtSWQsIHJlZmVyZW5jZWRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZJdGVtID0gJHNjb3BlLmRlc2lnbmVyLmdldEl0ZW0oaXRlbUlkKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVmUHJvcCA9ICRzY29wZS5kZXNpZ25lci5nZXRQcm9wZXJ0eShyZWZJdGVtLCByZWZlcmVuY2VkUHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJvcGVydHkuRGlyZWN0aW9uID09PSAkZGlyZWN0aW9uLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnByb3BlcnR5LlJlZmVyZW5jZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlucSgkc2NvcGUucHJvcGVydHkuUmVmZXJlbmNlcykucmVtb3ZlKGZ1bmN0aW9uIChyZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWYuVGFza0lkID09PSBpdGVtSWQgJiYgcmVmLlJlZmVyZW5jZWRQcm9wZXJ0eSA9PT0gcmVmZXJlbmNlZFByb3BlcnR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmVmUHJvcC5yZW1vdmVSZWZlcmVuY2UoJHNjb3BlLml0ZW1EYXRhLklkLCAkc2NvcGUucHJvcGVydHkuUHJvcGVydHlOYW1lKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy9lbmRyZWdpb24gQWRkIGZ1bmN0aW9ucyB0byBwcm9wZXJ0eSBvYmplY3RcclxuXHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy9JdCBuZWVkcyBmb3IgYW5ndWxhciwgcmVtb3ZlcyBzdmcgd3JhcHBlclxyXG4gICAgICAgICAgICAgICAgdmFyIGUgPSBhbmd1bGFyLmVsZW1lbnQoZWxlbWVudC5jaGlsZHJlbigpKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQucmVwbGFjZVdpdGgoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA5LzkvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInKVxyXG4gICAgLmNvbnRyb2xsZXIoXCJkZXNpZ25lckN0cmxcIiwgWyckc2NvcGUnLCAnZGlyZWN0aW9uJywgZnVuY3Rpb24gKCRzY29wZSwgJGRpcmVjdGlvbikge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgJHNjb3BlLnNpemUgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiAwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDBcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5zY2FsZSA9IHtcclxuICAgICAgICAgICAgeDogMSxcclxuICAgICAgICAgICAgeTogMVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnZpZXdCb3ggPSB7XHJcbiAgICAgICAgICAgIHg6IDAsXHJcbiAgICAgICAgICAgIHk6IDAsXHJcbiAgICAgICAgICAgIHdpZHRoOiAwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDBcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5tb3ZpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy9yZWdpb24gQ29udHJvbGxlciBmdW5jdGlvbnNcclxuXHJcbiAgICAgICAgdGhpcy5nZXRTY2FsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zY2FsZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldE9mZnNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgeDogJHNjb3BlLm9mZnNldC54LCB5OiAkc2NvcGUub2Zmc2V0Lnl9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0Vmlld0JveCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzY29wZS52aWV3Qm94O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0SXRlbSA9IGZ1bmN0aW9uIChpdGVtSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxpbnEoJHNjb3BlLml0ZW1zKS5maXJzdChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uSWQgPT09IGl0ZW1JZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRQcm9wZXJ0eSA9IGZ1bmN0aW9uIChpdGVtLCBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIHByb3AgPSBsaW5xKGl0ZW0uSW5wdXRQcm9wZXJ0aWVzKS5maXJzdE9yRGVmYXVsdChmdW5jdGlvbiAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eS5Qcm9wZXJ0eU5hbWUgPT09IHByb3BlcnR5TmFtZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChwcm9wKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxpbnEoaXRlbS5PdXRwdXRQcm9wZXJ0aWVzKS5maXJzdE9yRGVmYXVsdChmdW5jdGlvbiAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eS5Qcm9wZXJ0eU5hbWUgPT09IHByb3BlcnR5TmFtZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRSZWZlcmVuY2VkUHJvcGVydHkgPSBmdW5jdGlvbiAocmVmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gc2VsZi5nZXRJdGVtKHJlZmVyZW5jZS5UYXNrSWQpO1xyXG4gICAgICAgICAgICB2YXIgcHJvcCA9IHNlbGYuZ2V0UHJvcGVydHkoaXRlbSwgcmVmZXJlbmNlLlJlZmVyZW5jZWRQcm9wZXJ0eSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcHJvcDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL2VuZHJlZ2lvbiBDb250cm9sbGVyIGZ1bmN0aW9uc1xyXG5cclxuICAgICAgICAvL3JlZ2lvbiBEZXNpZ25lciBpdGVtIGhhbmRsaW5nXHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChzZWxlY3RlZEl0ZW0pIHtcclxuICAgICAgICAgICAgbGlucSgkc2NvcGUuaXRlbXMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkSXRlbS5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZENoYW5nZWQoe2l0ZW06IHNlbGVjdGVkSXRlbX0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBsaW5xKGl0ZW0uSW5wdXRQcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvcC5SZWZlcmVuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wLnJlbW92ZVJlZmVyZW5jZShwcm9wLlJlZmVyZW5jZS5UYXNrSWQsIHByb3AuUmVmZXJlbmNlLlJlZmVyZW5jZWRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGlucShpdGVtLk91dHB1dFByb3BlcnRpZXMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcclxuICAgICAgICAgICAgICAgIGxpbnEocHJvcC5SZWZlcmVuY2VzKS5mb3JFYWNoKGZ1bmN0aW9uIChyZWZlcmVuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wLnJlbW92ZVJlZmVyZW5jZShyZWZlcmVuY2UuVGFza0lkLCByZWZlcmVuY2UuUmVmZXJlbmNlZFByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxpbnEoJHNjb3BlLml0ZW1zKS5yZW1vdmUoaXRlbSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gRGVzaWduZXIgaXRlbSBoYW5kbGluZ1xyXG5cclxuICAgICAgICAvL3JlZ2lvbiBab29taW5nXHJcblxyXG4gICAgICAgICRzY29wZS5vbk1vdXNlV2hlZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgdmFyIHN0ZXAgPSAwLjE7XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGVsdGFZID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zY2FsZS54IC0gc3RlcCA8PSAwIHx8ICRzY29wZS5zY2FsZS55IC0gc3RlcCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjYWxlLnggLT0gc3RlcDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2FsZS55IC09IHN0ZXA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2ZW50LmRlbHRhWSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjYWxlLnggKz0gc3RlcDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2FsZS55ICs9IHN0ZXA7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUudmlld0JveC54ICs9IGV2ZW50LmNsaWVudFggLSAoJHNjb3BlLnZpZXdCb3gud2lkdGggLyAyKTtcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnZpZXdCb3gueSArPSBldmVudC5jbGllbnRZIC0gKCRzY29wZS52aWV3Qm94LmhlaWdodCAvIDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3VwZGF0ZVZpZXdCb3hTaXplKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUudmlld0JveC53aWR0aCA9ICRzY29wZS5zaXplLndpZHRoIC8gJHNjb3BlLnNjYWxlLng7XHJcbiAgICAgICAgICAgICRzY29wZS52aWV3Qm94LmhlaWdodCA9ICRzY29wZS5zaXplLmhlaWdodCAvICRzY29wZS5zY2FsZS55O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHNpemVXYXRjaGVyID0gJHNjb3BlLiR3YXRjaCgnc2l6ZScsIF91cGRhdGVWaWV3Qm94U2l6ZSwgdHJ1ZSk7XHJcbiAgICAgICAgdmFyIHNjYWxlV2F0Y2hlciA9ICRzY29wZS4kd2F0Y2goJ3NjYWxlJywgX3VwZGF0ZVZpZXdCb3hTaXplLCB0cnVlKTtcclxuXHJcbiAgICAgICAgLy9lbmRyZWdpb24gWm9vbWluZ1xyXG5cclxuICAgICAgICAvLyByZWdpb24gVmlld2JveCBtb3ZpbmdcclxuXHJcbiAgICAgICAgdmFyIG1vdmVYLCBtb3ZlWSA9IDA7XHJcbiAgICAgICAgJHNjb3BlLm1vdmVTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgbW92ZVggPSAkZXZlbnQuY2xpZW50WDtcclxuICAgICAgICAgICAgbW92ZVkgPSAkZXZlbnQuY2xpZW50WTtcclxuICAgICAgICAgICAgJHNjb3BlLm1vdmluZyA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLm1vdmUgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIHZhciB5ID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS52aWV3Qm94LnggLT0gKHggLSBtb3ZlWCkgKiAoMSAvICRzY29wZS5zY2FsZS54KTtcclxuICAgICAgICAgICAgJHNjb3BlLnZpZXdCb3gueSAtPSAoeSAtIG1vdmVZKSAqICgxIC8gJHNjb3BlLnNjYWxlLnkpO1xyXG4gICAgICAgICAgICBtb3ZlWCA9IHg7XHJcbiAgICAgICAgICAgIG1vdmVZID0geTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUubW92ZUVuZCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1vdmluZyA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vZW5kcmVnaW9uIFZpZXdib3ggbW92aW5nXHJcblxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy9EaXNwb3NpbmdcclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2l6ZVdhdGNoZXIoKTtcclxuICAgICAgICAgICAgc2NhbGVXYXRjaGVyKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSlcclxuOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA4LzUvMjAxNC5cclxuICovXHJcbmFuZ3VsYXIubW9kdWxlKCdGbG93RGVzaWduZXInLCBbJ1N2Zy5EaXJlY3RpdmUnLCAnSGFtbWVyLkRpcmVjdGl2ZScsICdDb21tb24uRGlyZWN0aXZlJ10pXHJcbiAgICAuY29uc3RhbnQoXCJ0eXBlc1wiLCB7XHJcbiAgICAgICAgdGV4dDogJ1RleHQnLFxyXG4gICAgICAgIGJvb2w6ICdCb29sJyxcclxuICAgICAgICBpbnQ6ICdOdW1iZXInXHJcbiAgICB9KVxyXG4gICAgLmNvbnN0YW50KFwic3RhdHVzXCIsIHtcclxuICAgICAgICBub3RydW46ICdub3RydW4nLFxyXG4gICAgICAgIHJ1bm5pbmc6ICdydW5uaW5nJyxcclxuICAgICAgICBmYWlsZWQ6ICdmYWlsZWQnLFxyXG4gICAgICAgIHN1Y2NlZWRlZDogJ3N1Y2NlZWRlZCdcclxuICAgIH0pXHJcbiAgICAuY29uc3RhbnQoXCJkaXJlY3Rpb25cIiwge1xyXG4gICAgICAgIGlucHV0OiAnaW5wdXQnLFxyXG4gICAgICAgIG91dHB1dDogJ291dHB1dCdcclxuICAgIH0pXHJcbiAgICAuZGlyZWN0aXZlKCdkZXNpZ25lcicsIFtcIiR0aW1lb3V0XCIsIGZ1bmN0aW9uICgkdGltZW91dCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc3JjL3RlbXBsYXRlcy9kZXNpZ25lci50bXBsLmh0bWwnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgYXV0b1NpemU6ICc9JyxcclxuICAgICAgICAgICAgICAgIGl0ZW1zOiAnPScsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENoYW5nZWQ6ICcmJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZGVzaWduZXJDdHJsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaXplID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlbGVtZW50LndpZHRoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodCgpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9mZnNldCA9IHtcclxuICAgICAgICAgICAgICAgICAgICB4OiBlbGVtZW50Lm9mZnNldCgpLmxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogZWxlbWVudC5vZmZzZXQoKS50b3BcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdtZXN6YXJvcyBvbiA4LzE1LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnSGFtbWVyLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgndGFwJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmhhbW1lcih7XHJcbiAgICAgICAgICAgICAgICB9KS5iaW5kKCd0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLnRhcCwgeyAkZXZlbnQ6IGV2ZW50IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmhhbW1lcigpLnVuYmluZCgndGFwJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KS5kaXJlY3RpdmUoJ2RvdWJsZVRhcCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5oYW1tZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcHM6IDJcclxuICAgICAgICAgICAgICAgIH0pLmJpbmQoJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5nZXN0dXJlLnRhcENvdW50ID09PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLmRvdWJsZVRhcCwgeyAkZXZlbnQ6IGV2ZW50IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy9EaXNwb3NpbmdcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaGFtbWVyKCkudW5iaW5kKCd0YXAnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pLmRpcmVjdGl2ZSgncGFuJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5idXR0b24gIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsKGF0dHJzLnBhbkJlZ2luLCB7ICRldmVudDogZXZlbnR9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkuYmluZCgnbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoYXR0cnMucGFuLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNldXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZXZhbChhdHRycy5wYW5SZWxlYXNlLCB7ICRldmVudDogZXZlbnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkudW5iaW5kKCdtb3VzZW1vdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS51bmJpbmQoJ21vdXNldXAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vRGlzcG9zaW5nXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnbW91c2Vkb3duJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOS85LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnRmxvd0Rlc2lnbmVyJylcclxuICAgIC5jb250cm9sbGVyKFwiaXRlbUN0cmxcIiwgWyckc2NvcGUnLCAndHlwZXMnLCAnc3RhdHVzJywgZnVuY3Rpb24gKCRzY29wZSwgJHR5cGVzLCAkc3RhdHVzKSB7XHJcbiAgICAgICAgJHNjb3BlLiRzdGF0dXMgPSAkc3RhdHVzO1xyXG4gICAgICAgICRzY29wZS4kdHlwZXMgPSAkdHlwZXM7XHJcbiAgICAgICAgJHNjb3BlLndpZHRoID0gMjUwO1xyXG4gICAgICAgICRzY29wZS5oZWlnaHQgPSAxNzA7XHJcbiAgICAgICAgdmFyIGRyYWdYLCBkcmFnWSA9IDA7XHJcbiAgICAgICAgJHNjb3BlLmRyYWdTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgZHJhZ1ggPSAkZXZlbnQuY2xpZW50WDtcclxuICAgICAgICAgICAgZHJhZ1kgPSAkZXZlbnQuY2xpZW50WTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmRyYWcgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gJGV2ZW50LmNsaWVudFg7XHJcbiAgICAgICAgICAgIHZhciB5ID0gJGV2ZW50LmNsaWVudFk7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhLlBvc2l0aW9uLlggKz0gKHggLSBkcmFnWCkgKiAoMS8kc2NvcGUuZGVzaWduZXIuZ2V0U2NhbGUoKS54KTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGEuUG9zaXRpb24uWSArPSAoeSAtIGRyYWdZKSAqICgxLyRzY29wZS5kZXNpZ25lci5nZXRTY2FsZSgpLnkpO1xyXG4gICAgICAgICAgICBkcmFnWCA9IHg7XHJcbiAgICAgICAgICAgIGRyYWdZID0geTtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2Rlc2lnbmVySXRlbScsIFsgJ3R5cGVzJywgJ3N0YXR1cycsIGZ1bmN0aW9uICgkdHlwZXMsICRzdGF0dXMpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFFXCIsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdeZGVzaWduZXInLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NyYy90ZW1wbGF0ZXMvaXRlbS50bXBsLmh0bWwnLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0WDogJz0nLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0WTogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdpdGVtQ3RybCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBkZXNpZ25lckN0cmwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLlN0YXR1cyA9ICRzdGF0dXMubm90cnVuO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRlc2lnbmVyID0gZGVzaWduZXJDdHJsO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vSXQgbmVlZHMgZm9yIGFuZ3VsYXIsIHJlbW92ZXMgc3ZnIHdyYXBwZXJcclxuICAgICAgICAgICAgICAgIHZhciBlID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQuY2hpbGRyZW4oKSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlcGxhY2VXaXRoKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnaXRlbVRpdGxlJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIixcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwiZm9udC1tIGJveC1oZWFkZXJcIiBuZy10cmFuc2NsdWRlPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCdpdGVtRGVzY3JpcHRpb24nLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQUVcIixcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwiZm9udC14c1wiIG5nLXRyYW5zY2x1ZGU+PC9kaXY+JyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSkiLCIvKipcclxuICogQ3JlYXRlZCBieSBnbWVzemFyb3Mgb24gOC81LzIwMTQuXHJcbiAqL1xyXG5hbmd1bGFyLm1vZHVsZSgnU3ZnLkRpcmVjdGl2ZScsIFtdKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdXaWR0aCcsIFtmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBzY29wZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGF0dHJzLm5nV2lkdGgsIGZ1bmN0aW9uICh3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcIndpZHRoXCIsIHdpZHRoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdIZWlnaHQnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0hlaWdodCwgZnVuY3Rpb24gKGhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCduZ1gnLCBbJyRjb21waWxlJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gsIGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwieFwiLCB4KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdZJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdZLCBmdW5jdGlvbiAoeSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInlcIiwgeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nQ3gnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0N4LCBmdW5jdGlvbiAoY3gpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJjeFwiLCBjeCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nQ3knLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ0N5LCBmdW5jdGlvbiAoY3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJjeVwiLCBjeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWDEnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gxLCBmdW5jdGlvbiAoeDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ4MVwiLCB4MSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWDInLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1gyLCBmdW5jdGlvbiAoeDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ4MlwiLCB4Mik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWTEnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1kxLCBmdW5jdGlvbiAoeTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5MVwiLCB5MSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ25nWTInLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChhdHRycy5uZ1kyLCBmdW5jdGlvbiAoeTIpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ5MlwiLCB5Mik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5kaXJlY3RpdmUoJ2F1dG9TaXplJywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlbGVtZW50LndpZHRoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdWaWV3Ym94JywgW2Z1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goYXR0cnMubmdWaWV3Ym94LCBmdW5jdGlvbiAodmlld2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmlld2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHZpZXdib3gueCArIFwiIFwiICsgdmlld2JveC55ICsgXCIgXCIgKyB2aWV3Ym94LndpZHRoICsgXCIgXCIgKyB2aWV3Ym94LmhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIiwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZGlyZWN0aXZlKCd0ZXh0RWxsaXBzaXMnLCBbZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gcGFyc2VGbG9hdChhdHRycy5tYXhXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkc2NvcGUuJGV2YWwoYXR0cnMudGV4dEVsbGlwc2lzKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC53aWR0aCgpID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZWxlbWVudC53aWR0aCgpID4gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSkgKyAnLi4uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=